function mxCoordinateAssignment(e,t,n,i,a,r){this.layout=e,this.intraCellSpacing=t,this.interRankCellSpacing=n,this.orientation=i,this.initialX=a,this.parallelEdgeSpacing=r}mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage,mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment,mxCoordinateAssignment.prototype.layout=null,mxCoordinateAssignment.prototype.intraCellSpacing=30,mxCoordinateAssignment.prototype.interRankCellSpacing=100,mxCoordinateAssignment.prototype.parallelEdgeSpacing=10,mxCoordinateAssignment.prototype.maxIterations=8,mxCoordinateAssignment.prototype.prefHozEdgeSep=5,mxCoordinateAssignment.prototype.prefVertEdgeOff=2,mxCoordinateAssignment.prototype.minEdgeJetty=12,mxCoordinateAssignment.prototype.channelBuffer=4,mxCoordinateAssignment.prototype.jettyPositions=null,mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH,mxCoordinateAssignment.prototype.initialX=null,mxCoordinateAssignment.prototype.limitX=null,mxCoordinateAssignment.prototype.currentXDelta=null,mxCoordinateAssignment.prototype.widestRank=null,mxCoordinateAssignment.prototype.rankTopY=null,mxCoordinateAssignment.prototype.rankBottomY=null,mxCoordinateAssignment.prototype.widestRankValue=null,mxCoordinateAssignment.prototype.rankWidths=null,mxCoordinateAssignment.prototype.rankY=null,mxCoordinateAssignment.prototype.fineTuning=!0,mxCoordinateAssignment.prototype.nextLayerConnectedCache=null,mxCoordinateAssignment.prototype.previousLayerConnectedCache=null,mxCoordinateAssignment.prototype.groupPadding=10,mxCoordinateAssignment.prototype.printStatus=function(){var e=this.layout.getModel();mxLog.show(),mxLog.writeln("======Coord assignment debug=======");for(var t=0;t<e.ranks.length;t++){mxLog.write("Rank ",t," : ");for(var n=e.ranks[t],i=0;i<n.length;i++){var a=n[i];mxLog.write(a.getGeneralPurposeVariable(t),"  ")}mxLog.writeln()}mxLog.writeln("====================================")},mxCoordinateAssignment.prototype.execute=function(e){this.jettyPositions=Object();var t=this.layout.getModel();this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),t),this.fineTuning&&this.minNode(t);var n=1e8;if(this.fineTuning)for(var i=0;i<this.maxIterations;i++){if(0!=i&&(this.medianPos(i,t),this.minNode(t)),this.currentXDelta<n){for(var a=0;a<t.ranks.length;a++)for(var r=t.ranks[a],o=0;o<r.length;o++){(s=r[o]).setX(a,s.getGeneralPurposeVariable(a))}n=this.currentXDelta}else for(a=0;a<t.ranks.length;a++)for(r=t.ranks[a],o=0;o<r.length;o++){var s;(s=r[o]).setGeneralPurposeVariable(a,s.getX(a))}this.minPath(this.layout.getGraph(),t),this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),t)},mxCoordinateAssignment.prototype.minNode=function(e){for(var t=[],n=new mxDictionary,i=[],a=0;a<=e.maxRank;a++){i[a]=e.ranks[a];for(var r=0;r<i[a].length;r++){var o=i[a][r],s=new WeightedCellSorter(o,a);s.rankIndex=r,s.visited=!0,t.push(s),n.put(o,s)}}for(var l=10*t.length,h=0;t.length>0&&h<=l;){var g=t.shift(),m=g.cell,d=g.weightedValue,p=parseInt(g.rankIndex),u=m.getNextLayerConnectedCells(d),x=m.getPreviousLayerConnectedCells(d),C=u.length,c=x.length,f=this.medianXValue(u,d+1),k=this.medianXValue(x,d-1),v=C+c,y=m.getGeneralPurposeVariable(d),R=y;v>0&&(R=(f*C+k*c)/v);var w=!1;if(R<y-1)if(0==p)m.setGeneralPurposeVariable(d,R),w=!0;else{var V=i[d][p-1],P=V.getGeneralPurposeVariable(d);(P=P+V.width/2+this.intraCellSpacing+m.width/2)<R?(m.setGeneralPurposeVariable(d,R),w=!0):P<m.getGeneralPurposeVariable(d)-1&&(m.setGeneralPurposeVariable(d,P),w=!0)}else if(R>y+1){if(p==i[d].length-1)m.setGeneralPurposeVariable(d,R),w=!0;else{var E=i[d][p+1],S=E.getGeneralPurposeVariable(d);(S=S-E.width/2-this.intraCellSpacing-m.width/2)>R?(m.setGeneralPurposeVariable(d,R),w=!0):S>m.getGeneralPurposeVariable(d)+1&&(m.setGeneralPurposeVariable(d,S),w=!0)}}if(w){for(a=0;a<u.length;a++){var A=u[a];null!=(T=n.get(A))&&0==T.visited&&(T.visited=!0,t.push(T))}for(a=0;a<x.length;a++){var T;A=x[a];null!=(T=n.get(A))&&0==T.visited&&(T.visited=!0,t.push(T))}}g.visited=!1,h++}},mxCoordinateAssignment.prototype.medianPos=function(e,t){if(e%2==0)for(var n=t.maxRank;n>0;n--)this.rankMedianPosition(n-1,t,n);else for(n=0;n<t.maxRank-1;n++)this.rankMedianPosition(n+1,t,n)},mxCoordinateAssignment.prototype.rankMedianPosition=function(e,t,n){for(var i=t.ranks[e],a=[],r=new Object,o=0;o<i.length;o++){var s=i[o];a[o]=new WeightedCellSorter,a[o].cell=s,a[o].rankIndex=o,r[s.id]=a[o];var l=null;l=n<e?s.getPreviousLayerConnectedCells(e):s.getNextLayerConnectedCells(e),a[o].weightedValue=this.calculatedWeightedValue(s,l)}a.sort(WeightedCellSorter.prototype.compare);for(o=0;o<a.length;o++){var h=a[o].cell,g=(l=null,0);null!=(l=n<e?h.getPreviousLayerConnectedCells(e).slice():h.getNextLayerConnectedCells(e).slice())&&(g=l.length>0?this.medianXValue(l,n):h.getGeneralPurposeVariable(e));for(var m=0,d=-1e8,p=a[o].rankIndex-1;p>=0;){if(null!=(c=r[i[p].id])){var u=c.cell;c.visited?(d=u.getGeneralPurposeVariable(e)+u.width/2+this.intraCellSpacing+m+h.width/2,p=-1):(m+=u.width+this.intraCellSpacing,p--)}}var x=0,C=1e8;for(p=a[o].rankIndex+1;p<a.length;){var c;if(null!=(c=r[i[p].id])){var f=c.cell;c.visited?(C=f.getGeneralPurposeVariable(e)-f.width/2-this.intraCellSpacing-x-h.width/2,p=a.length):(x+=f.width+this.intraCellSpacing,p++)}}g>=d&&g<=C?h.setGeneralPurposeVariable(e,g):g<d?(h.setGeneralPurposeVariable(e,d),this.currentXDelta+=d-g):g>C&&(h.setGeneralPurposeVariable(e,C),this.currentXDelta+=g-C),a[o].visited=!0}},mxCoordinateAssignment.prototype.calculatedWeightedValue=function(e,t){for(var n=0,i=0;i<t.length;i++){var a=t[i];e.isVertex()&&a.isVertex()?n++:e.isEdge()&&a.isEdge()?n+=8:n+=2}return n},mxCoordinateAssignment.prototype.medianXValue=function(e,t){if(0==e.length)return 0;for(var n=[],i=0;i<e.length;i++)n[i]=e[i].getGeneralPurposeVariable(t);if(n.sort(function(e,t){return e-t}),e.length%2==1)return n[Math.floor(e.length/2)];var a=e.length/2;return(n[a-1]+n[a])/2},mxCoordinateAssignment.prototype.initialCoords=function(e,t){this.calculateWidestRank(e,t);for(var n=this.widestRank;n>=0;n--)n<t.maxRank&&this.rankCoordinates(n,e,t);for(n=this.widestRank+1;n<=t.maxRank;n++)n>0&&this.rankCoordinates(n,e,t)},mxCoordinateAssignment.prototype.rankCoordinates=function(e,t,n){for(var i=n.ranks[e],a=0,r=this.initialX+(this.widestRankValue-this.rankWidths[e])/2,o=!1,s=0;s<i.length;s++){var l=i[s];if(l.isVertex()){var h=this.layout.getVertexBounds(l.cell);null!=h?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(l.width=h.width,l.height=h.height):(l.width=h.height,l.height=h.width):o=!0,a=Math.max(a,l.height)}else if(l.isEdge()){var g=1;null!=l.edges?g=l.edges.length:mxLog.warn("edge.edges is null"),l.width=(g-1)*this.parallelEdgeSpacing}r+=l.width/2,l.setX(e,r),l.setGeneralPurposeVariable(e,r),r+=l.width/2,r+=this.intraCellSpacing}1==o&&mxLog.warn("At least one cell has no bounds")},mxCoordinateAssignment.prototype.calculateWidestRank=function(e,t){var n=-this.interRankCellSpacing,i=0;this.rankWidths=[],this.rankY=[];for(var a=t.maxRank;a>=0;a--){for(var r=0,o=t.ranks[a],s=this.initialX,l=!1,h=0;h<o.length;h++){var g=o[h];if(g.isVertex()){var m=this.layout.getVertexBounds(g.cell);null!=m?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(g.width=m.width,g.height=m.height):(g.width=m.height,g.height=m.width):l=!0,r=Math.max(r,g.height)}else if(g.isEdge()){var d=1;null!=g.edges?d=g.edges.length:mxLog.warn("edge.edges is null"),g.width=(d-1)*this.parallelEdgeSpacing}s+=g.width/2,g.setX(a,s),g.setGeneralPurposeVariable(a,s),s+=g.width/2,(s+=this.intraCellSpacing)>this.widestRankValue&&(this.widestRankValue=s,this.widestRank=a),this.rankWidths[a]=s}1==l&&mxLog.warn("At least one cell has no bounds"),this.rankY[a]=n;var p=r/2+i/2+this.interRankCellSpacing;i=r,this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?n+=p:n-=p;for(h=0;h<o.length;h++){o[h].setY(a,n)}}},mxCoordinateAssignment.prototype.minPath=function(e,t){for(var n=t.edgeMapper.getValues(),i=0;i<n.length;i++){var a=n[i];if(!(a.maxRank-a.minRank-1<1)){for(var r=a.getGeneralPurposeVariable(a.minRank+1),o=!0,s=0,l=a.minRank+2;l<a.maxRank;l++){var h=a.getGeneralPurposeVariable(l);r!=h?(o=!1,r=h):s++}if(!o){var g=0,m=0,d=[],p=[],u=a.getGeneralPurposeVariable(a.minRank+1);for(l=a.minRank+1;l<a.maxRank-1;l++){u==(x=a.getX(l+1))?(d[l-a.minRank-1]=u,g++):this.repositionValid(t,a,l+1,u)?(d[l-a.minRank-1]=u,g++):(d[l-a.minRank-1]=x,u=x)}u=a.getX(l);for(l=a.maxRank-1;l>a.minRank+1;l--){var x;u==(x=a.getX(l-1))?(p[l-a.minRank-2]=u,m++):this.repositionValid(t,a,l-1,u)?(p[l-a.minRank-2]=u,m++):(p[l-a.minRank-2]=a.getX(l-1),u=x)}if(m>s||g>s)if(m>=g)for(l=a.maxRank-2;l>a.minRank;l--)a.setX(l,p[l-a.minRank-1]);else if(g>m)for(l=a.minRank+2;l<a.maxRank;l++)a.setX(l,d[l-a.minRank-2])}}}},mxCoordinateAssignment.prototype.repositionValid=function(e,t,n,i){for(var a=e.ranks[n],r=-1,o=0;o<a.length;o++)if(t==a[o]){r=o;break}if(r<0)return!1;var s=t.getGeneralPurposeVariable(n);if(i<s){if(0==r)return!0;var l=a[r-1],h=l.getGeneralPurposeVariable(n);return(h=h+l.width/2+this.intraCellSpacing+t.width/2)<=i}if(i>s){if(r==a.length-1)return!0;var g=a[r+1],m=g.getGeneralPurposeVariable(n);return(m=m-g.width/2-this.intraCellSpacing-t.width/2)>=i}return!0},mxCoordinateAssignment.prototype.setCellLocations=function(e,t){this.rankTopY=[],this.rankBottomY=[];for(var n=0;n<t.ranks.length;n++)this.rankTopY[n]=Number.MAX_VALUE,this.rankBottomY[n]=-Number.MAX_VALUE;var i=t.vertexMapper.getValues();for(n=0;n<i.length;n++)this.setVertexLocation(i[n]);this.layout.edgeStyle!=mxHierarchicalEdgeStyle.ORTHOGONAL&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.POLYLINE&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.CURVE||this.localEdgeProcessing(t);var a=t.edgeMapper.getValues();for(n=0;n<a.length;n++)this.setEdgePosition(a[n])},mxCoordinateAssignment.prototype.localEdgeProcessing=function(e){for(var t=0;t<e.ranks.length;t++)for(var n=e.ranks[t],i=0;i<n.length;i++){var a=n[i];if(a.isVertex())for(var r=a.getPreviousLayerConnectedCells(t),o=t-1,s=0;s<2;s++){if(o>-1&&o<e.ranks.length&&null!=r&&r.length>0){for(var l=[],h=0;h<r.length;h++){var g=new WeightedCellSorter(r[h],r[h].getX(o));l.push(g)}l.sort(WeightedCellSorter.prototype.compare);var m=a.x[0]-a.width/2,d=m+a.width,p=0,u=[];for(h=0;h<l.length;h++){var x,C=l[h].cell;if(C.isVertex()){x=0==s?a.connectsAsSource:a.connectsAsTarget;for(var c=0;c<x.length;c++)x[c].source!=C&&x[c].target!=C||(p+=x[c].edges.length,0,u.push(x[c]))}else p+=C.edges.length,0,u.push(C)}var f=(p+1)*this.prefHozEdgeSep;a.width>f+2*this.prefHozEdgeSep&&(m+=this.prefHozEdgeSep,d-=this.prefHozEdgeSep);var k=(d-m)/p,v=m+k/2,y=this.minEdgeJetty-this.prefVertEdgeOff,R=0;for(h=0;h<u.length;h++){var w=u[h].edges.length,V=this.jettyPositions[u[h].ids[0]];null==V&&(V=[],this.jettyPositions[u[h].ids[0]]=V),h<p/2?y+=this.prefVertEdgeOff:h>p/2&&(y-=this.prefVertEdgeOff);for(var P=0;P<w;P++)V[4*P+2*s]=v,v+=k,V[4*P+2*s+1]=y;R=Math.max(R,y)}}r=a.getNextLayerConnectedCells(t),o=t+1}}},mxCoordinateAssignment.prototype.setEdgePosition=function(e){var t=0;if(101207!=e.temp[0]){var n=e.maxRank,i=e.minRank;n==i&&(n=e.source.maxRank,i=e.target.minRank);for(var a=0,r=this.jettyPositions[e.ids[0]],o=e.isReversed?e.target.cell:e.source.cell,s=this.layout.graph,l=this.orientation==mxConstants.DIRECTION_EAST||this.orientation==mxConstants.DIRECTION_SOUTH,h=0;h<e.edges.length;h++){var g=e.edges[h],m=this.layout.getVisibleTerminal(g,!0),d=[],p=e.isReversed;if(m!=o&&(p=!p),null!=r){var u=p?2:0,x=p?l?this.rankBottomY[i]:this.rankTopY[i]:l?this.rankTopY[n]:this.rankBottomY[n],C=r[4*a+1+u];p!=l&&(C=-C),x+=C;var c=r[4*a+u],f=s.model.getTerminal(g,!0);if(this.layout.isPort(f)&&s.model.getParent(f)==m)c=null!=(T=s.view.getState(f))?T.x:m.geometry.x+e.source.width*f.geometry.x;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(d.push(new mxPoint(c,x)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&d.push(new mxPoint(c,x+C))):(d.push(new mxPoint(x,c)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&d.push(new mxPoint(x+C,c)))}var k=e.x.length-1,v=-1,y=-1,R=e.maxRank-1;p&&(k=0,v=e.x.length,y=1,R=e.minRank+1);for(var w=k;e.maxRank!=e.minRank&&w!=v;w+=y){var V=e.x[w]+t,P=(this.rankTopY[R]+this.rankBottomY[R+1])/2,E=(this.rankTopY[R-1]+this.rankBottomY[R])/2;if(p){var S=P;P=E,E=S}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(d.push(new mxPoint(V,P)),d.push(new mxPoint(V,E))):(d.push(new mxPoint(P,V)),d.push(new mxPoint(E,V))),this.limitX=Math.max(this.limitX,V),R+=y}if(null!=r){u=p?2:0;var A=p?l?this.rankTopY[n]:this.rankBottomY[n]:l?this.rankBottomY[i]:this.rankTopY[i];C=r[4*a+3-u];p!=l&&(C=-C);x=A-C,c=r[4*a+2-u];var T,I=s.model.getTerminal(g,!1),O=this.layout.getVisibleTerminal(g,!1);if(this.layout.isPort(I)&&s.model.getParent(I)==O)c=null!=(T=s.view.getState(I))?T.x:O.geometry.x+e.target.width*I.geometry.x;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&d.push(new mxPoint(c,x-C)),d.push(new mxPoint(c,x))):(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&d.push(new mxPoint(x-C,c)),d.push(new mxPoint(x,c)))}e.isReversed&&this.processReversedEdge(e,g),this.layout.setEdgePoints(g,d),t=0==t?this.parallelEdgeSpacing:t>0?-t:-t+this.parallelEdgeSpacing,a++}e.temp[0]=101207}},mxCoordinateAssignment.prototype.setVertexLocation=function(e){var t=e.cell,n=e.x[0]-e.width/2,i=e.y[0]-e.height/2;this.rankTopY[e.minRank]=Math.min(this.rankTopY[e.minRank],i),this.rankBottomY[e.minRank]=Math.max(this.rankBottomY[e.minRank],i+e.height),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(t,n,i):this.layout.setVertexLocation(t,i,n),this.limitX=Math.max(this.limitX,n+e.width)},mxCoordinateAssignment.prototype.processReversedEdge=function(e,t){};