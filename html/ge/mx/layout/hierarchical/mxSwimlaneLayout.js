function mxSwimlaneLayout(e,t,i){mxGraphLayout.call(this,e),this.orientation=null!=t?t:mxConstants.DIRECTION_NORTH,this.deterministic=null==i||i}mxSwimlaneLayout.prototype=new mxGraphLayout,mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout,mxSwimlaneLayout.prototype.roots=null,mxSwimlaneLayout.prototype.swimlanes=null,mxSwimlaneLayout.prototype.dummyVertexWidth=50,mxSwimlaneLayout.prototype.resizeParent=!1,mxSwimlaneLayout.prototype.maintainParentLocation=!1,mxSwimlaneLayout.prototype.moveParent=!1,mxSwimlaneLayout.prototype.parentBorder=30,mxSwimlaneLayout.prototype.intraCellSpacing=30,mxSwimlaneLayout.prototype.interRankCellSpacing=100,mxSwimlaneLayout.prototype.interHierarchySpacing=60,mxSwimlaneLayout.prototype.parallelEdgeSpacing=10,mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH,mxSwimlaneLayout.prototype.fineTuning=!0,mxSwimlaneLayout.prototype.tightenToSource=!0,mxSwimlaneLayout.prototype.disableEdgeStyle=!0,mxSwimlaneLayout.prototype.traverseAncestors=!0,mxSwimlaneLayout.prototype.model=null,mxSwimlaneLayout.prototype.edgesCache=null,mxHierarchicalLayout.prototype.edgeSourceTermCache=null,mxHierarchicalLayout.prototype.edgesTargetTermCache=null,mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE,mxSwimlaneLayout.prototype.getModel=function(){return this.model},mxSwimlaneLayout.prototype.execute=function(e,t){this.parent=e;var i=this.graph.model;if(this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,!(null==t||t.length<1)){if(null==e&&(e=i.getParent(t[0])),this.parentX=null,this.parentY=null,e!=this.root&&null!=i.isVertex(e)&&this.maintainParentLocation)null!=(s=this.graph.getCellGeometry(e))&&(this.parentX=s.x,this.parentY=s.y);this.swimlanes=t;for(var r=[],n=0;n<t.length;n++){var a=this.graph.getChildCells(t[n]);if(null==a||0==a.length){var l=this.graph.insertVertex(t[n],null,null,0,0,this.dummyVertexWidth,0);r.push(l)}}i.beginUpdate();try{var s;if(this.run(e),this.resizeParent&&!this.graph.isCellCollapsed(e)&&this.graph.updateGroupBounds([e],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY)null!=(s=this.graph.getCellGeometry(e))&&((s=s.clone()).x=this.parentX,s.y=this.parentY,i.setGeometry(e,s));this.graph.removeCells(r)}finally{i.endUpdate()}}},mxSwimlaneLayout.prototype.updateGroupBounds=function(){var e=[],t=this.model;for(var i in t.edgeMapper)for(var r=t.edgeMapper[i],n=0;n<r.edges.length;n++)e.push(r.edges[n]);var a=this.graph.getBoundingBoxFromGeometry(e,!0),l=[];for(n=0;n<this.swimlanes.length;n++){var s=this.swimlanes[n];if(null!=(y=this.graph.getCellGeometry(s))){var o=this.graph.getChildCells(s),h=this.graph.isSwimlane(s)?this.graph.getStartSize(s):new mxRectangle,g=this.graph.getBoundingBoxFromGeometry(o);l[n]=g;var p=g.y+y.y-h.height-this.parentBorder,m=g.y+y.y+g.height;if(null==a)a=new mxRectangle(0,p,0,m-p);else{a.y=Math.min(a.y,p);var u=Math.max(a.y+a.height,m);a.height=u-a.y}}}for(n=0;n<this.swimlanes.length;n++){var y;s=this.swimlanes[n];if(null!=(y=this.graph.getCellGeometry(s))){o=this.graph.getChildCells(s),h=this.graph.isSwimlane(s)?this.graph.getStartSize(s):new mxRectangle;var c=y.clone(),d=0==n?this.parentBorder:this.interRankCellSpacing/2,x=h.width+d,w=l[n].x-x,S=a.y-this.parentBorder;c.x+=w,c.y=S,c.width=l[n].width+x+this.interRankCellSpacing/2,c.height=a.height+h.height+2*this.parentBorder,this.graph.model.setGeometry(s,c),this.graph.moveCells(o,-w,y.y-S)}}},mxSwimlaneLayout.prototype.findRoots=function(e,t){var i=[];if(null!=e&&null!=t){var r=this.graph.model,n=null,a=-1e5;for(var l in t){var s=t[l];if(null!=s&&r.isVertex(s)&&this.graph.isCellVisible(s)&&r.isAncestor(e,s)){for(var o=this.getEdges(s),h=0,g=0,p=0;p<o.length;p++){var m=this.getVisibleTerminal(o[p],!0);if(m==s){var u=this.getVisibleTerminal(o[p],!1);r.isAncestor(e,u)&&h++}else r.isAncestor(e,m)&&g++}0==g&&h>0&&i.push(s);var y=h-g;y>a&&(a=y,n=s)}}0==i.length&&null!=n&&i.push(n)}return i},mxSwimlaneLayout.prototype.getEdges=function(e){var t=this.edgesCache.get(e);if(null!=t)return t;for(var i=this.graph.model,r=[],n=this.graph.isCellCollapsed(e),a=i.getChildCount(e),l=0;l<a;l++){var s=i.getChildAt(e,l);this.isPort(s)?r=r.concat(i.getEdges(s,!0,!0)):!n&&this.graph.isCellVisible(s)||(r=r.concat(i.getEdges(s,!0,!0)))}r=r.concat(i.getEdges(e,!0,!0));var o=[];for(l=0;l<r.length;l++){var h=this.getVisibleTerminal(r[l],!0),g=this.getVisibleTerminal(r[l],!1);(h==g||h!=g&&(g==e&&(null==this.parent||this.graph.isValidAncestor(h,this.parent,this.traverseAncestors))||h==e&&(null==this.parent||this.graph.isValidAncestor(g,this.parent,this.traverseAncestors))))&&o.push(r[l])}return this.edgesCache.put(e,o),o},mxSwimlaneLayout.prototype.getVisibleTerminal=function(e,t){var i=this.edgesTargetTermCache;t&&(i=this.edgeSourceTermCache);var r=i.get(e);if(null!=r)return r;var n=this.graph.view.getState(e),a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t);return null==a&&(a=null!=n?n.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(e,t)),null!=a&&(this.isPort(a)&&(a=this.graph.model.getParent(a)),i.put(e,a)),a},mxSwimlaneLayout.prototype.run=function(e){var t=[],i=Object();if(null!=this.swimlanes&&this.swimlanes.length>0&&null!=e){for(var r=Object(),n=0;n<this.swimlanes.length;n++)this.filterDescendants(this.swimlanes[n],r);this.roots=[];var a=!0;for(var l in r)if(null!=r[l]){a=!1;break}for(var s=0;!a&&s<this.swimlanes.length;){var o=this.findRoots(this.swimlanes[s],r);if(0!=o.length){for(n=0;n<o.length;n++){var h=Object();t.push(h),this.traverse(o[n],!0,null,i,h,t,r,s)}for(n=0;n<o.length;n++)this.roots.push(o[n]);for(var l in a=!0,r)if(null!=r[l]){a=!1;break}}else s++}}else for(n=0;n<this.roots.length;n++){h=Object();t.push(h),this.traverse(this.roots[n],!0,null,i,h,t,null)}var g=[];for(var l in i)g.push(i[l]);this.model=new mxSwimlaneModel(this,g,this.roots,e,this.tightenToSource),this.cycleStage(e),this.layeringStage(),this.crossingStage(e),this.placementStage(0,e)},mxSwimlaneLayout.prototype.filterDescendants=function(e,t){var i=this.graph.model;if(i.isVertex(e)&&e!=this.parent&&i.getParent(e)!=this.parent&&this.graph.isCellVisible(e)&&(t[mxObjectIdentity.get(e)]=e),this.traverseAncestors||e==this.parent&&this.graph.isCellVisible(e))for(var r=i.getChildCount(e),n=0;n<r;n++){var a=i.getChildAt(e,n);this.isPort(a)||this.filterDescendants(a,t)}},mxSwimlaneLayout.prototype.isPort=function(e){return!!e.geometry.relative},mxSwimlaneLayout.prototype.getEdgesBetween=function(e,t,i){i=null!=i&&i;for(var r=this.getEdges(e),n=[],a=0;a<r.length;a++){var l=this.getVisibleTerminal(r[a],!0),s=this.getVisibleTerminal(r[a],!1);(l==e&&s==t||!i&&l==t&&s==e)&&n.push(r[a])}return n},mxSwimlaneLayout.prototype.traverse=function(e,t,i,r,n,a,l,s){if(null!=e&&null!=r){var o=mxObjectIdentity.get(e);if(null!=r[o]||null!=l&&null==l[o]){if(null==n[o])for(u=0;u<a.length;u++){var h=a[u];if(null!=h[o]){for(var g in h)n[g]=h[g];return a.splice(u,1),n}}}else{null==n[o]&&(n[o]=e),null==r[o]&&(r[o]=e),null!==l&&delete l[o];for(var p=this.getEdges(e),m=this.graph.model,u=0;u<p.length;u++){var y=this.getVisibleTerminal(p[u],!0),c=y==e;c&&(y=this.getVisibleTerminal(p[u],!1));var d=0;for(d=0;d<this.swimlanes.length&&!m.isAncestor(this.swimlanes[d],y);d++);d>=this.swimlanes.length||(d>s||(!t||c)&&d==s)&&(n=this.traverse(y,t,p[u],r,n,a,l,d))}}}return n},mxSwimlaneLayout.prototype.cycleStage=function(e){new mxSwimlaneOrdering(this).execute(e)},mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank(),this.model.fixRanks()},mxSwimlaneLayout.prototype.crossingStage=function(e){new mxMedianHybridCrossingReduction(this).execute(e)},mxSwimlaneLayout.prototype.placementStage=function(e,t){var i=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,e,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(t),i.limitX+this.interHierarchySpacing};