function mxDefaultToolbar(t,e){this.editor=e,null!=t&&null!=e&&this.init(t)}mxDefaultToolbar.prototype.editor=null,mxDefaultToolbar.prototype.toolbar=null,mxDefaultToolbar.prototype.resetHandler=null,mxDefaultToolbar.prototype.spacing=4,mxDefaultToolbar.prototype.connectOnDrop=!1,mxDefaultToolbar.prototype.init=function(t){null!=t&&(this.toolbar=new mxToolbar(t),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(t,e){var o=e.getProperty("function");this.editor.insertFunction=null!=o?mxUtils.bind(this,function(){o.apply(this,arguments),this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,this.resetHandler))},mxDefaultToolbar.prototype.addItem=function(t,e,o,i){var r=mxUtils.bind(this,function(){null!=o&&o.length>0&&this.editor.execute(o)});return this.toolbar.addItem(t,e,r,i)},mxDefaultToolbar.prototype.addSeparator=function(t){t=t||GE.imageBasePath+"/separator.gif",this.toolbar.addSeparator(t)},mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()},mxDefaultToolbar.prototype.addActionCombo=function(t){return this.toolbar.addActionCombo(t)},mxDefaultToolbar.prototype.addActionOption=function(t,e,o){var i=mxUtils.bind(this,function(){this.editor.execute(o)});this.addOption(t,e,i)},mxDefaultToolbar.prototype.addOption=function(t,e,o){return this.toolbar.addOption(t,e,o)},mxDefaultToolbar.prototype.addMode=function(t,e,o,i,r){var l=mxUtils.bind(this,function(){this.editor.setMode(o),null!=r&&r(this.editor)});return this.toolbar.addSwitchMode(t,e,l,i)},mxDefaultToolbar.prototype.addPrototype=function(t,e,o,i,r,l){var n=mxUtils.bind(this,function(){return"function"==typeof o?o():null!=o?this.editor.graph.cloneCell(o):null}),a=mxUtils.bind(this,function(t,e){"function"==typeof r?r(this.editor,n(),t,e):this.drop(n(),t,e),this.toolbar.resetMode(),mxEvent.consume(t)}),s=this.toolbar.addMode(t,e,a,i,null,l);return this.installDropHandler(s,function(t,e,o){a(e,o)}),s},mxDefaultToolbar.prototype.drop=function(t,e,o){var i=this.editor.graph,r=i.getModel();if(null!=o&&!r.isEdge(o)&&this.connectOnDrop&&i.isCellConnectable(o))this.connect(t,e,o);else{for(;null!=o&&!i.isValidDropTarget(o,[t],e);)o=r.getParent(o);this.insert(t,e,o)}},mxDefaultToolbar.prototype.insert=function(t,e,o){var i=this.editor.graph;if(i.canImportCell(t)){var r=mxEvent.getClientX(e),l=mxEvent.getClientY(e),n=mxUtils.convertPoint(i.container,r,l);return i.isSplitEnabled()&&i.isSplitTarget(o,[t],e)?i.splitEdge(o,[t],null,n.x,n.y):this.editor.addVertex(o,t,n.x,n.y)}return null},mxDefaultToolbar.prototype.connect=function(t,e,o){var i=this.editor.graph,r=i.getModel();if(null!=o&&i.isCellConnectable(t)&&i.isEdgeValid(null,o,t)){var l=null;r.beginUpdate();try{var n=r.getGeometry(o),a=r.getGeometry(t).clone();a.x=n.x+(n.width-a.width)/2,a.y=n.y+(n.height-a.height)/2;var s=this.spacing*i.gridSize,d=20*r.getDirectedEdgeCount(o,!0);this.editor.horizontalFlow?a.x+=(a.width+n.width)/2+s+d:a.y+=(a.height+n.height)/2+s+d,t.setGeometry(a);var u=r.getParent(o);if(i.addCell(t,u),i.constrainChild(t),l=this.editor.createEdge(o,t),null==r.getGeometry(l)){var h=new mxGeometry;h.relative=!0,r.setGeometry(l,h)}i.addEdge(l,u,o,t)}finally{r.endUpdate()}i.setSelectionCells([t,l]),i.scrollCellToVisible(t)}},mxDefaultToolbar.prototype.installDropHandler=function(t,e){var o=document.createElement("img");o.setAttribute("src",t.getAttribute("src"));var i=mxUtils.bind(this,function(r){o.style.width=2*t.offsetWidth+"px",o.style.height=2*t.offsetHeight+"px",mxUtils.makeDraggable(t,this.editor.graph,e,o),mxEvent.removeListener(o,"load",i)});mxEvent.addListener(o,"load",i)},mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)};