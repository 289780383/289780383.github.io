function mxText(t,i,s,e,n,o,l,h,a,r,x,d,p,u,m,g,T,c,f,C,y){mxShape.call(this),this.value=t,this.bounds=i,this.color=null!=n?n:"black",this.align=null!=s?s:mxConstants.ALIGN_CENTER,this.valign=null!=e?e:mxConstants.ALIGN_MIDDLE,this.family=null!=o?o:mxConstants.DEFAULT_FONTFAMILY,this.size=null!=l?l:mxConstants.DEFAULT_FONTSIZE,this.fontStyle=null!=h?h:mxConstants.DEFAULT_FONTSTYLE,this.spacing=parseInt(a||2),this.spacingTop=this.spacing+parseInt(r||0),this.spacingRight=this.spacing+parseInt(x||0),this.spacingBottom=this.spacing+parseInt(d||0),this.spacingLeft=this.spacing+parseInt(p||0),this.horizontal=null==u||u,this.background=m,this.border=g,this.wrap=null!=T&&T,this.clipped=null!=c&&c,this.overflow=null!=f?f:"visible",this.labelPadding=null!=C?C:0,this.textDirection=y,this.rotation=0,this.updateMargin()}mxUtils.extend(mxText,mxShape),mxText.prototype.baseSpacingTop=0,mxText.prototype.baseSpacingBottom=0,mxText.prototype.baseSpacingLeft=0,mxText.prototype.baseSpacingRight=0,mxText.prototype.replaceLinefeeds=!0,mxText.prototype.verticalTextRotation=-90,mxText.prototype.ignoreClippedStringSize=!0,mxText.prototype.ignoreStringSize=!1,mxText.prototype.textWidthPadding=3,mxText.prototype.lastValue=null,mxText.prototype.cacheEnabled=!0,mxText.prototype.isParseVml=function(){return!1},mxText.prototype.isHtmlAllowed=function(){return!0},mxText.prototype.getSvgScreenOffset=function(){return 0},mxText.prototype.checkBounds=function(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)},mxText.prototype.svgCellManager={JAID:0},mxText.prototype.paint=function(t,i){var s=this.scale,e=this.bounds.x/s,n=this.bounds.y/s,o=this.bounds.width/s,l=this.bounds.height/s;if(this.updateTransform(t,e,n,o,l),this.configureCanvas(t,e,n,o,l),i){switch(t.updateText(e,n,o,l,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node),this.state.cell.type1){case"外部扩展":this.state.container.style.pointerEvents="auto"}}else{const i=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML;var h=i||t instanceof mxVmlCanvas2D?"html":"",a=null;if(this.style.svg){const t=this.style.svg;let i=this.svgCellManager[t];if(!i){var r=GE.CELL_ROOT+"svg/"+t+".svg";try{var x=mxUtils.load(r);i=this.svgCellManager[t]=x.request.response}catch(t){mxUtils.alert("无法加载"+r+"，原因: "+t)}}if(i){let t=i;this.state.JAID||(this.state.JAID="JAID"+this.svgCellManager.JAID,this.svgCellManager.JAID++),a=t=t.replace(/JAID/g,this.state.JAID)}else a=this.value}else a=this.value,i||"html"!=h||(a=mxUtils.htmlEntities(a,!1)),"html"!=h||mxUtils.isNode(this.value)||(a=mxUtils.replaceTrailingNewlines(a,"<div><br></div>")),a=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&"html"==h?a.replace(/\n/g,"<br/>"):a;var d=this.textDirection;d!=mxConstants.TEXT_DIRECTION_AUTO||i||(d=this.getAutoDirection()),d!=mxConstants.TEXT_DIRECTION_LTR&&d!=mxConstants.TEXT_DIRECTION_RTL&&(d=null);const s=t.text(e,n,o,l,a,this.align,this.valign,this.wrap,h,this.overflow,this.clipped,this.getTextRotation(),d),p=this.state.cell,u=p.bindProperties;switch(p.type1){case"变量":switch(p.type2){case"指针表1":this.state.disableText=!0;{const t=document.getElementById(this.state.JAID+"_V");t&&(t.innerHTML=u.mr0);const i=document.getElementById(this.state.JAID+"_MR0");i&&(i.innerHTML=u.mr0);const s=document.getElementById(this.state.JAID+"_MR1");s&&(s.innerHTML=u.mr1)}}break;case"外部扩展":if(this.state.disableText=!0,s)if(this.state.container=s.children[0].children[0],this.state.container.style.pointerEvents="auto",0===u.name.length)this.state.container.innerHTML="外部扩展图元容器";else{const t=this.state.view.graph;t.extCellProcess?t.extCellProcess(this.state.container,u)||(this.state.container.innerHTML="外部扩展图元容器<br>绑定图元名：<b>"+u.name+"</b><br>未实现该图元名对应的功能"):this.state.container.innerHTML="外部扩展图元容器<br>绑定图元名：<b>"+u.name+"</b>"}else console.log("外部扩展图元出错了！")}}},mxText.prototype.redraw=function(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue==this.value&&(mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML))if("DIV"!=this.node.nodeName||!this.isHtmlAllowed()&&GE.IS_VML){var t=this.createCanvas();null!=t&&null!=t.updateText?(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox()):mxShape.prototype.redraw.apply(this,arguments)}else GE.IS_SVG?this.redrawHtmlShapeWithCss3():(this.updateSize(this.node,null==this.state||null==this.state.view.textDiv),this.updateHtmlTransform()),this.updateBoundingBox();else mxShape.prototype.redraw.apply(this,arguments),mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML?this.lastValue=this.value:this.lastValue=null},mxText.prototype.resetStyles=function(){mxShape.prototype.resetStyles.apply(this,arguments),this.color="black",this.align=mxConstants.ALIGN_CENTER,this.valign=mxConstants.ALIGN_MIDDLE,this.family=mxConstants.DEFAULT_FONTFAMILY,this.size=mxConstants.DEFAULT_FONTSIZE,this.fontStyle=mxConstants.DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,delete this.background,delete this.border,this.textDirection=mxConstants.DEFAULT_TEXT_DIRECTION,delete this.margin},mxText.prototype.apply=function(t){var i=this.spacing;mxShape.prototype.apply.apply(this,arguments),null!=this.style&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacing=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing)),this.spacingTop=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop-i))+this.spacing,this.spacingRight=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight-i))+this.spacing,this.spacingBottom=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom-i))+this.spacing,this.spacingLeft=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft-i))+this.spacing,this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_OPACITY,100),this.updateMargin()),this.flipV=null,this.flipH=null},mxText.prototype.getAutoDirection=function(){var t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return null!=t&&t.length>0&&t[0]>"z"?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR},mxText.prototype.updateBoundingBox=function(){var t=this.node;this.boundingBox=this.bounds.clone();var i=this.getTextRotation(),s=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null,e=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(!(this.ignoreStringSize||null==t||"fill"==this.overflow||this.clipped&&this.ignoreClippedStringSize&&s==mxConstants.ALIGN_CENTER&&e==mxConstants.ALIGN_MIDDLE)){var n=null,o=null;if(null!=t.ownerSVGElement)if(null!=t.firstChild&&null!=t.firstChild.firstChild&&"foreignObject"==t.firstChild.firstChild.nodeName)o=(t=t.firstChild.firstChild.firstChild.firstChild).offsetHeight*this.scale,n="width"==this.overflow?this.boundingBox.width:t.offsetWidth*this.scale;else try{var l=t.getBBox();return void("string"==typeof this.value&&0==mxUtils.trim(this.value)?this.boundingBox=null:0==l.width&&0==l.height?this.boundingBox=null:this.boundingBox=new mxRectangle(l.x,l.y,l.width,l.height))}catch(t){}else{var h=null!=this.state?this.state.view.textDiv:null;if(null!=this.offsetWidth&&null!=this.offsetHeight)n=this.offsetWidth*this.scale,o=this.offsetHeight*this.scale;else{null!=h&&(this.updateFont(h),this.updateSize(h,!1),this.updateInnerHtml(h),t=h);var a=t;null!=a.firstChild&&"DIV"==a.firstChild.nodeName&&(a=a.firstChild),this.offsetWidth=a.offsetWidth+this.textWidthPadding,this.offsetHeight=a.offsetHeight,n=this.offsetWidth*this.scale,o=this.offsetHeight*this.scale}}null!=n&&null!=o&&(this.boundingBox=new mxRectangle(this.bounds.x,this.bounds.y,n,o))}if(null!=this.boundingBox)if(0!=i){var r=mxUtils.getBoundingBox(new mxRectangle(this.margin.x*this.boundingBox.width,this.margin.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),i,new mxPoint(0,0));this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=this.margin.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=this.margin.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=r.x,this.boundingBox.y+=r.y,this.boundingBox.width=r.width,this.boundingBox.height=r.height}else this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height,this.unrotatedBoundingBox=null},mxText.prototype.getShapeRotation=function(){return 0},mxText.prototype.getTextRotation=function(){return null!=this.state&&null!=this.state.shape?this.state.shape.getTextRotation():0},mxText.prototype.isPaintBoundsInverted=function(){return!this.horizontal&&null!=this.state&&this.state.view.graph.model.isVertex(this.state.cell)},mxText.prototype.configureCanvas=function(t,i,s,e,n){mxShape.prototype.configureCanvas.apply(this,arguments),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)},mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px",this.node.style.width="1px",this.node.style.height="1px",this.node.style.overflow="visible"},mxText.prototype.getHtmlValue=function(){var t=this.value;return this.dialect!=mxConstants.DIALECT_STRICTHTML&&(t=mxUtils.htmlEntities(t,!1)),t=mxUtils.replaceTrailingNewlines(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t},mxText.prototype.getTextCss=function(){var t=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,i="display: inline-block; font-size: "+this.size+"px; font-family: "+this.family+"; color: "+this.color+"; line-height: "+t+"; pointer-events: "+(this.pointerEvents?"all":"none")+"; ";(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(i+="font-weight: bold; "),(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(i+="font-style: italic; ");var s=[];return(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&s.push("underline"),(this.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&s.push("line-through"),s.length>0&&(i+="text-decoration: "+s.join(" ")+"; "),i},mxText.prototype.redrawHtmlShape=function(){if(GE.IS_SVG)this.redrawHtmlShapeWithCss3();else{var t=this.node.style;t.whiteSpace="normal",t.overflow="",t.width="",t.height="",this.updateValue(),this.updateFont(this.node),this.updateSize(this.node,null==this.state||null==this.state.view.textDiv),this.offsetWidth=null,this.offsetHeight=null,this.updateHtmlTransform()}},mxText.prototype.redrawHtmlShapeWithCss3=function(){var t=Math.max(0,Math.round(this.bounds.width/this.scale)),i=Math.max(0,Math.round(this.bounds.height/this.scale)),s="position: absolute; left: "+Math.round(this.bounds.x)+"px; top: "+Math.round(this.bounds.y)+"px; pointer-events: none; ",e=this.getTextCss();mxSvgCanvas2D.createCss(t+2,i,this.align,this.valign,this.wrap,this.overflow,this.clipped,null!=this.background?mxUtils.htmlEntities(this.background):null,null!=this.border?mxUtils.htmlEntities(this.border):null,s,e,this.scale,mxUtils.bind(this,function(t,i,s,e,n,o){var l=this.getTextRotation(),h=(1!=this.scale?"scale("+this.scale+") ":"")+(0!=l?"rotate("+l+"deg) ":"")+(0!=this.margin.x||0!=this.margin.y?"translate("+100*this.margin.x+"%,"+100*this.margin.y+"%)":"");""!=h&&(h="transform-origin: 0 0; transform: "+h+"; "),""==o?(s+=e,e="display:inline-block; min-width: 100%; "+h):e+=h,this.opacity<100&&(n+="opacity: "+this.opacity/100+"; "),this.node.setAttribute("style",s);var a=mxUtils.isNode(this.value)?this.value.outerHTML:this.getHtmlValue();null==this.node.firstChild&&(this.node.innerHTML="<div><div>"+a+"</div></div>"),this.node.firstChild.firstChild.setAttribute("style",n),this.node.firstChild.setAttribute("style",e)}))},mxText.prototype.updateHtmlTransform=function(){var t=this.getTextRotation(),i=this.node.style,s=this.margin.x,e=this.margin.y;0!=t?(mxUtils.setPrefixedStyle(i,"transformOrigin",100*-s+"% "+100*-e+"%"),mxUtils.setPrefixedStyle(i,"transform","translate("+100*s+"%,"+100*e+"%) scale("+this.scale+") rotate("+t+"deg)")):(mxUtils.setPrefixedStyle(i,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(i,"transform","scale("+this.scale+") translate("+100*s+"%,"+100*e+"%)")),i.left=Math.round(this.bounds.x-Math.ceil(s*("fill"!=this.overflow&&"width"!=this.overflow?3:1)))+"px",i.top=Math.round(this.bounds.y-e*("fill"!=this.overflow?3:1))+"px",this.opacity<100?i.opacity=this.opacity/100:i.opacity=""},mxText.prototype.updateInnerHtml=function(t){if(mxUtils.isNode(this.value))t.innerHTML=this.value.outerHTML;else{var i=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(i=mxUtils.htmlEntities(i,!1)),i=mxUtils.replaceTrailingNewlines(i,"<div>&nbsp;</div>"),i='<div style="display:inline-block;_display:inline;">'+(i=this.replaceLinefeeds?i.replace(/\n/g,"<br/>"):i)+"</div>",t.innerHTML=i}},mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value))this.node.innerHTML="",this.node.appendChild(this.value);else{var t=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(t=mxUtils.htmlEntities(t,!1)),t=mxUtils.replaceTrailingNewlines(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t;var i=null!=this.background&&this.background!=mxConstants.NONE?this.background:null,s=null!=this.border&&this.border!=mxConstants.NONE?this.border:null;if("fill"==this.overflow||"width"==this.overflow)null!=i&&(this.node.style.backgroundColor=i),null!=s&&(this.node.style.border="1px solid "+s);else{var e="";null!=i&&(e+="background-color:"+mxUtils.htmlEntities(i)+";"),null!=s&&(e+="border:1px solid "+mxUtils.htmlEntities(s)+";"),t='<div style="zoom:1;'+e+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+(mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT)+'">'+t+"</div>"}this.node.innerHTML=t;var n=this.node.getElementsByTagName("div");if(n.length>0){var o=this.textDirection;o==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML&&(o=this.getAutoDirection()),o==mxConstants.TEXT_DIRECTION_LTR||o==mxConstants.TEXT_DIRECTION_RTL?n[n.length-1].setAttribute("dir",o):n[n.length-1].removeAttribute("dir")}}},mxText.prototype.updateFont=function(t){var i=t.style;i.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,i.fontSize=this.size+"px",i.fontFamily=this.family,i.verticalAlign="top",i.color=this.color,(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?i.fontWeight="bold":i.fontWeight="",(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?i.fontStyle="italic":i.fontStyle="";var s=[];(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&s.push("underline"),(this.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&s.push("line-through"),i.textDecoration=s.join(" "),this.align==mxConstants.ALIGN_CENTER?i.textAlign="center":this.align==mxConstants.ALIGN_RIGHT?i.textAlign="right":i.textAlign="left"},mxText.prototype.updateSize=function(t,i){var s=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),n=t.style;if(this.clipped?(n.overflow="hidden",n.maxHeight=e+"px",n.maxWidth=s+"px"):"fill"==this.overflow?(n.width=s+1+"px",n.height=e+1+"px",n.overflow="hidden"):"width"==this.overflow&&(n.width=s+1+"px",n.maxHeight=e+1+"px",n.overflow="hidden"),this.wrap&&s>0){if(n.wordWrap=mxConstants.WORD_WRAP,n.whiteSpace="normal",n.width=s+"px",i&&"fill"!=this.overflow&&"width"!=this.overflow){var o=t;null!=o.firstChild&&"DIV"==o.firstChild.nodeName&&(o=o.firstChild,"break-word"==t.style.wordWrap&&(o.style.width="100%"));var l=o.offsetWidth;if(0==l){var h=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),l=o.offsetWidth,t.style.visibility="",h.appendChild(t)}l+=3,this.clipped&&(l=Math.min(l,s)),n.width=l+"px"}}else n.whiteSpace="nowrap"},mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)},mxText.prototype.getSpacing=function(){var t=0,i=0;return t=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,i=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new mxPoint(t,i)};