function ChangePageSetup(t,e,i,n,o){this.ui=t,this.color=e,this.previousColor=e,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.pageScale=o,this.previousPageScale=o,this.ignoreColor=!1,this.ignoreImage=!1}GE.EditorUi=function(t,e,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=new GE.Editor,this.container=t||document.body,GE.container=this.container;var n=this.editor.graph;const o=n.getTooltipForCell;if(n.getTooltipForCell=(t=>this.tooltip?this.tooltip(t):o(t)),n.useCssTransforms&&(this.lazyZoomDelay=0),GE.IS_SVG?mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs=":(new Image).src=mxPopupMenu.prototype.submenuImage,GE.IS_SVG||null==mxConnectionHandler.prototype.connectImage||((new Image).src=mxConnectionHandler.prototype.connectImage.src),this.actions=new GE.Actions(this),this.menus=this.createMenus(),!n.standalone){this.createDivs(),this.createUi(e,i),this.refresh();var r=mxUtils.bind(this,function(t){return null==t&&(t=window.event),n.isEditing()||null!=t&&this.isSelectionAllowed(t)});if(this.container==document.body&&(this.menubarContainer.onselectstart=r,this.menubarContainer.onmousedown=r,this.toolbarContainer.onselectstart=r,this.toolbarContainer.onmousedown=r,this.diagramContainer.onselectstart=r,this.diagramContainer.onmousedown=r,this.sidebarContainer.onselectstart=r,this.sidebarContainer.onmousedown=r,this.formatContainer.onselectstart=r,this.formatContainer.onmousedown=r,this.footerContainer.onselectstart=r,this.footerContainer.onmousedown=r,null!=this.tabContainer&&(this.tabContainer.onselectstart=r)),this.editor.editable){this.diagramContainer.oncontextmenu=function(t){if(null!=t){var e=mxEvent.getSource(t);if("A"==e.nodeName)for(;null!=e;){if("geHint"==e.className)return!0;e=e.parentNode}}return r(t)}}else n.panningHandler.usePopupTrigger=!1;if(n.init(this.diagramContainer),mxEvent.addListener(this.diagramContainer,"dragover",mxUtils.bind(this,function(t){t.stopPropagation(),t.preventDefault()})),mxEvent.addListener(this.diagramContainer,"drop",mxUtils.bind(this,function(t){t.stopPropagation(),t.preventDefault();for(var e=mxUtils.convertPoint(this.diagramContainer,mxEvent.getClientX(t),mxEvent.getClientY(t)),i=this.editor.graph.view.translate,n=this.editor.graph.view.scale,o=e.x/n-i.x,r=e.y/n-i.y,a=event.dataTransfer.files,l=function(t,e,i,n){if("image"==e.type.substring(0,5)){var o=new FileReader;o.onload=function(o){var r=o.target.result;if("image/svg"==e.type.substring(0,9)){var a=r.indexOf(","),l=atob(r.substring(a+1)),s=mxUtils.parseXml(l);if(null!=s){var d=s.getElementsByTagName("svg");if(d.length>0){var h=d[0],c=parseFloat(h.getAttribute("width")),u=parseFloat(h.getAttribute("height")),g=h.getAttribute("viewBox");if(null==g||0==g.length)h.setAttribute("viewBox","0 0 "+c+" "+u);else if(isNaN(c)||isNaN(u)){var p=g.split(" ");p.length>3&&(c=parseFloat(p[2]),u=parseFloat(p[3]))}c=Math.max(1,Math.round(c)),u=Math.max(1,Math.round(u)),r="data:image/svg+xml,"+btoa(mxUtils.getXml(d[0],"\n")),t.insertVertex(null,null,"",i,n,c,u,"shape=image;imageAspect=0;image="+r+";")}}}else{var m=new Image;m.onload=function(){var e=Math.max(1,m.width),o=Math.max(1,m.height),a=r.indexOf(";");a>0&&(r=r.substring(0,a)+r.substring(r.indexOf(",",a+1))),t.insertVertex(null,null,"",i,n,e,o,"shape=image;imageAspect=0;image="+r+";")},m.src=r}},o.readAsDataURL(e)}},s=0;s<a.length;s++)l(this.editor.graph,a[s],o+10*s,r+10*s)})),GE.IS_SVG&&null!=n.view.getDrawPane()){var a=n.view.getDrawPane().ownerSVGElement;null!=a&&(a.style.position="absolute")}if(this.hoverIcons=this.createHoverIcons(),null!=n.graphHandler){var l=n.graphHandler.start;n.graphHandler.start=function(){null!=v.hoverIcons&&v.hoverIcons.reset(),l.apply(this,arguments)}}mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(t){var e=mxUtils.getOffset(this.diagramContainer);mxEvent.getClientX(t)-e.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(t)-e.y-this.diagramContainer.clientHeight>0?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")}));var s=!1,d=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(t,e){return s||d.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,function(t){32!=t.which||n.isEditing()?mxEvent.isConsumed(t)||27!=t.keyCode||this.hideDialog(null,!0):(s=!0,this.hoverIcons.reset(),n.container.style.cursor="move",n.isEditing()||mxEvent.getSource(t)!=n.container||mxEvent.consume(t))}),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,function(t){n.container.style.cursor="",s=!1}),mxEvent.addListener(document,"keyup",this.keyupHandler);var h=n.panningHandler.isForcePanningEvent;n.panningHandler.isForcePanningEvent=function(t){return h.apply(this,arguments)||s||mxEvent.isMouseEvent(t.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(t.getEvent()))&&(!mxEvent.isControlDown(t.getEvent())&&mxEvent.isRightMouseButton(t.getEvent())||mxEvent.isMiddleMouseButton(t.getEvent()))};var c=n.cellEditor.isStopEditingEvent;n.cellEditor.isStopEditingEvent=function(t){return c.apply(this,arguments)||13==t.keyCode&&(!GE.IS_SF&&mxEvent.isControlDown(t)||GE.IS_MAC&&mxEvent.isMetaDown(t)||GE.IS_SF&&mxEvent.isShiftDown(t))};var u=n.isZoomWheelEvent;n.isZoomWheelEvent=function(){return s||u.apply(this,arguments)};var g=!1,p=null,m=null,E=null,f=mxUtils.bind(this,function(){if(null!=this.toolbar&&g!=n.cellEditor.isContentEditing()){for(var t=this.toolbar.container.firstChild,e=[];null!=t;){var i=t.nextSibling;mxUtils.indexOf(this.toolbar.staticElements,t)<0&&(t.parentNode.removeChild(t),e.push(t)),t=i}var o=this.toolbar.fontMenu,r=this.toolbar.sizeMenu;if(null==E)this.toolbar.createTextToolbar();else{for(var a=0;a<E.length;a++)this.toolbar.container.appendChild(E[a]);this.toolbar.fontMenu=p,this.toolbar.sizeMenu=m}g=n.cellEditor.isContentEditing(),p=o,m=r,E=e}}),v=this,y=n.cellEditor.startEditing;n.cellEditor.startEditing=function(){if(y.apply(this,arguments),f(),n.cellEditor.isContentEditing()){var t=!1,e=function(){t||(t=!0,window.setTimeout(function(){for(var e=n.getSelectedElement();null!=e&&e.nodeType!=mxConstants.NODETYPE_ELEMENT;)e=e.parentNode;if(null!=e){var i=mxUtils.getCurrentStyle(e);if(null!=i&&null!=v.toolbar){var o=i.fontFamily;"'"==o.charAt(0)&&(o=o.substring(1)),"'"==o.charAt(o.length-1)&&(o=o.substring(0,o.length-1)),v.toolbar.setFontName(o),v.toolbar.setFontSize(parseInt(i.fontSize))}}t=!1},0))};mxEvent.addListener(n.cellEditor.textarea,"input",e),mxEvent.addListener(n.cellEditor.textarea,"touchend",e),mxEvent.addListener(n.cellEditor.textarea,"mouseup",e),mxEvent.addListener(n.cellEditor.textarea,"keyup",e),e()}};var x=n.cellEditor.stopEditing;if(n.cellEditor.stopEditing=function(t,e){try{x.apply(this,arguments),f()}catch(t){v.handleError(t)}},n.container.setAttribute("tabindex","0"),n.container.style.cursor="default",window.self===window.top&&null!=n.container.parentNode)try{n.container.focus()}catch(t){}var b=n.fireMouseEvent;n.fireMouseEvent=function(t,e,i){t==mxEvent.MOUSE_DOWN&&this.container.focus(),b.apply(this,arguments)},n.popupMenuHandler.autoExpand=!0,null!=this.menus&&(n.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(t,e,i){this.menus.createPopupMenu(t,e,i)})),mxEvent.addGestureListeners(document,mxUtils.bind(this,function(t){n.popupMenuHandler.hideMenu()})),this.keyHandler=this.createKeyHandler(this.editor),this.getKeyHandler=function(){return keyHandler};var C=["rounded","shadow","glass","dashed","dashPattern","comic","labelBackgroundColor"],S=["shape","edgeStyle","curved","rounded","elbow","comic","jumpStyle","jumpSize"];this.setDefaultStyle=function(t){try{var e=n.view.getState(t);if(null!=e){var i=t.clone();i.style="";var o=n.getCellStyle(i),r=[],a=[];for(var l in e.style)o[l]!=e.style[l]&&(r.push(e.style[l]),a.push(l));for(var s=n.getModel().getStyle(e.cell),d=null!=s?s.split(";"):[],h=0;h<d.length;h++){var c=d[h],u=c.indexOf("=");if(u>=0){l=c.substring(0,u);var g=c.substring(u+1);null!=o[l]&&"none"==g&&(r.push(g),a.push(l))}}n.getModel().isEdge(e.cell)?n.currentEdgeStyle={}:n.currentVertexStyle={},this.fireEvent(new mxEventObject("styleChanged","keys",a,"values",r,"cells",[e.cell]))}}catch(t){this.handleError(t)}},this.clearDefaultStyle=function(){n.currentEdgeStyle=mxUtils.clone(n.defaultEdgeStyle),n.currentVertexStyle=mxUtils.clone(n.defaultVertexStyle),this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};for(var w=["fontFamily","fontSize","fontColor"],U=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize"],G=[["startArrow","startFill","startSize","sourcePerimeterSpacing","endArrow","endFill","endSize","targetPerimeterSpacing"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],w,["opacity"],["align"],["html"]],A=0;A<G.length;A++)for(var M=0;M<G[A].length;M++)C.push(G[A][M]);for(A=0;A<S.length;A++)mxUtils.indexOf(C,S[A])<0&&C.push(S[A]);var F=function(t,e){var i=n.getModel();i.beginUpdate();try{for(var o=0;o<t.length;o++){var r,a=t[o];if(e)r=["fontSize","fontFamily","fontColor"];else{var l=i.getStyle(a),s=null!=l?l.split(";"):[];r=C.slice();for(var d=0;d<s.length;d++){var h=s[d],c=h.indexOf("=");if(c>=0){var u=h.substring(0,c),g=mxUtils.indexOf(r,u);g>=0&&r.splice(g,1);for(var p=0;p<G.length;p++){var m=G[p];if(mxUtils.indexOf(m,u)>=0)for(var E=0;E<m.length;E++){var f=mxUtils.indexOf(r,m[E]);f>=0&&r.splice(f,1)}}}}}var v=i.isEdge(a),y=v?n.currentEdgeStyle:n.currentVertexStyle,x=i.getStyle(a);for(d=0;d<r.length;d++){var b=y[u=r[d]];null==b||"shape"==u&&!v||(!v||mxUtils.indexOf(S,u)<0)&&(x=mxUtils.setStyle(x,u,b))}i.setStyle(a,x)}}finally{i.endUpdate()}};if(n.addListener("cellsInserted",function(t,e){F(e.getProperty("cells"))}),n.addListener("textInserted",function(t,e){F(e.getProperty("cells"),!0)}),n.connectionHandler.addListener(mxEvent.CONNECT,function(t,e){var i=[e.getProperty("cell")];e.getProperty("terminalInserted")&&i.push(e.getProperty("terminal")),F(i)}),this.addListener("styleChanged",mxUtils.bind(this,function(t,e){var i=e.getProperty("cells"),o=!1,r=!1;if(i.length>0)for(var a=0;a<i.length&&(o=n.getModel().isVertex(i[a])||o,!(r=n.getModel().isEdge(i[a])||r)||!o);a++);else o=!0,r=!0;var l=e.getProperty("keys"),s=e.getProperty("values");for(a=0;a<l.length;a++){var d=mxUtils.indexOf(w,l[a])>=0;("strokeColor"!=l[a]||null!=s[a]&&"none"!=s[a])&&(mxUtils.indexOf(S,l[a])>=0?r||mxUtils.indexOf(U,l[a])>=0?null==s[a]?delete n.currentEdgeStyle[l[a]]:n.currentEdgeStyle[l[a]]=s[a]:o&&mxUtils.indexOf(C,l[a])>=0&&(null==s[a]?delete n.currentVertexStyle[l[a]]:n.currentVertexStyle[l[a]]=s[a]):mxUtils.indexOf(C,l[a])>=0&&((o||d)&&(null==s[a]?delete n.currentVertexStyle[l[a]]:n.currentVertexStyle[l[a]]=s[a]),(r||d||mxUtils.indexOf(U,l[a])>=0)&&(null==s[a]?delete n.currentEdgeStyle[l[a]]:n.currentEdgeStyle[l[a]]=s[a])))}if(null!=this.toolbar){if(this.toolbar.setFontName(n.currentVertexStyle.fontFamily||GE.Menus.prototype.defaultFont),this.toolbar.setFontSize(n.currentVertexStyle.fontSize||GE.Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu){var h=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];"orthogonalEdgeStyle"==n.currentEdgeStyle.edgeStyle&&"1"==n.currentEdgeStyle.curved?h.className="geSprite geSprite-curved":"straight"==n.currentEdgeStyle.edgeStyle||"none"==n.currentEdgeStyle.edgeStyle||null==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-entity":"elbowEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==n.currentEdgeStyle.edgeStyle?h.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):h.className="geSprite geSprite-orthogonal"}if(null!=this.toolbar.edgeShapeMenu){var c=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];"link"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-linkedge":"flexArrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-arrow":"arrow"==n.currentEdgeStyle.shape?c.className="geSprite geSprite-simplearrow":c.className="geSprite geSprite-connection"}if(null!=this.toolbar.lineStartMenu)this.toolbar.lineStartMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("start",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(n.currentEdgeStyle,"startFill","1"));if(null!=this.toolbar.lineEndMenu)this.toolbar.lineEndMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("end",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(n.currentEdgeStyle,"endFill","1"))}})),null!=this.toolbar){var D=mxUtils.bind(this,function(){var t=n.currentVertexStyle.fontFamily||"宋体",e=String(n.currentVertexStyle.fontSize||"12"),i=n.getView().getState(n.getSelectionCell());null!=i&&(t=i.style[mxConstants.STYLE_FONTFAMILY]||t,e=i.style[mxConstants.STYLE_FONTSIZE]||e,t.length>10&&(t=t.substring(0,8)+"...")),this.toolbar.setFontName(t),this.toolbar.setFontSize(e)});n.getSelectionModel().addListener(mxEvent.CHANGE,D),n.getModel().addListener(mxEvent.CHANGE,D)}n.addListener(mxEvent.CELLS_ADDED,function(t,e){var i=e.getProperty("cells"),o=e.getProperty("parent");n.getModel().isLayer(o)&&!n.isCellVisible(o)&&null!=i&&i.length>0&&n.getModel().setVisible(o,!0)}),this.gestureHandler=mxUtils.bind(this,function(t){null!=this.currentMenu&&mxEvent.getSource(t)!=this.currentMenu.div&&this.hideCurrentMenu()}),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){null!=this.editor.graph&&this.refresh()}),0)}),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()}),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),GE.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)}),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()})),this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){n.view.validateBackground()})),n.addListener("gridSizeChanged",mxUtils.bind(this,function(){n.isGridEnabled()&&n.view.validateBackground()})),this.editor.resetGraph()}this.init(),n.standalone||this.open()},mxUtils.extend(GE.EditorUi,mxEventSource),GE.EditorUi.compactUi=!0,GE.EditorUi.prototype.splitSize=GE.IS_POINTER?12:8,GE.EditorUi.prototype.menubarHeight=30,GE.EditorUi.prototype.formatEnabled=!0,GE.EditorUi.prototype.formatWidth=240,GE.EditorUi.prototype.toolbarHeight=38,GE.EditorUi.prototype.footerHeight=28,GE.EditorUi.prototype.sidebarFooterHeight=34,GE.EditorUi.prototype.hsplitPosition=screen.width<=640?118:212,GE.EditorUi.prototype.allowAnimation=!0,GE.EditorUi.prototype.lightboxMaxFitScale=2,GE.EditorUi.prototype.lightboxVerticalDivider=4,GE.EditorUi.prototype.hsplitClickEnabled=!1,GE.EditorUi.prototype.updateBindProperties=function(t,e,i){const n=this.editor.graph;n.getModel().beginUpdate();try{var o=n.view.getState(t);n.cellEditor.applyBindProperties(o,e),i&&i(o)}finally{n.getModel().endUpdate()}},GE.EditorUi.prototype.init=function(){var t=this.editor.graph;if(!t.standalone){mxEvent.addListener(t.container,"scroll",mxUtils.bind(this,function(){t.tooltipHandler.hide(),null!=t.connectionHandler&&null!=t.connectionHandler.constraintHandler&&t.connectionHandler.constraintHandler.reset()})),t.addListener(mxEvent.ESCAPE,mxUtils.bind(this,function(){t.tooltipHandler.hide();var e=t.getRubberband();null!=e&&e.cancel()})),mxEvent.addListener(t.container,"keydown",mxUtils.bind(this,function(t){this.onKeyDown(t)})),mxEvent.addListener(t.container,"keypress",mxUtils.bind(this,function(t){this.onKeyPress(t)})),this.addUndoListener(),this.addBeforeUnloadListener(),t.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),t.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var e=t.setDefaultParent,i=this;this.editor.graph.setDefaultParent=function(){e.apply(this,arguments),i.updateActionStates()},this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init()}},GE.EditorUi.prototype.onKeyDown=function(t){var e=this.editor.graph;9!=t.which||!e.isEnabled()||mxEvent.isAltDown(t)||e.isEditing()&&mxEvent.isShiftDown(t)||(e.isEditing()?e.stopEditing(!1):e.selectCell(!mxEvent.isShiftDown(t)),mxEvent.consume(t))},GE.EditorUi.prototype.onKeyPress=function(t){var e=this.editor.graph;if(this.isImmediateEditingEvent(t)&&!e.isEditing()&&!e.isSelectionEmpty()&&0!==t.which&&27!==t.which&&!mxEvent.isAltDown(t)&&!mxEvent.isControlDown(t)&&!mxEvent.isMetaDown(t)&&(e.escape(),e.startEditing(),GE.IS_FF)){var i=e.cellEditor;if(null!=i.textarea){i.textarea.innerHTML=String.fromCharCode(t.which);var n=document.createRange();n.selectNodeContents(i.textarea),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}}},GE.EditorUi.prototype.isImmediateEditingEvent=function(t){return!0},GE.EditorUi.prototype.getCssClassForMarker=function(t,e,i,n){return"flexArrow"==e?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+t+"blocktrans":"geSprite geSprite-noarrow":"box"==i||"halfCircle"==i?"geSprite geSvgSprite geSprite-"+i+("end"==t?" geFlipSprite":""):i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+t+"classic":"geSprite geSprite-"+t+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+t+"classicthin":"geSprite geSprite-"+t+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+t+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+t+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+t+"block":"geSprite geSprite-"+t+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+t+"blockthin":"geSprite geSprite-"+t+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+t+"oval":"geSprite geSprite-"+t+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+t+"diamond":"geSprite geSprite-"+t+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+t+"thindiamond":"geSprite geSprite-"+t+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+t+"openasync":"dash"==i?"geSprite geSprite-"+t+"dash":"cross"==i?"geSprite geSprite-"+t+"cross":"async"==i?"1"==n?"geSprite geSprite-"+t+"async":"geSprite geSprite-"+t+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+t+"circle":"geSprite geSprite-"+t+"circleplus":"ERone"==i?"geSprite geSprite-"+t+"erone":"ERmandOne"==i?"geSprite geSprite-"+t+"eronetoone":"ERmany"==i?"geSprite geSprite-"+t+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+t+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+t+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+t+"ermanyopt":"geSprite geSprite-noarrow"},GE.EditorUi.prototype.createMenus=function(){return null},GE.EditorUi.prototype.updatePasteActionStates=function(){var t=this.editor.graph,e=this.actions.get("paste"),i=this.actions.get("pasteHere");e.setEnabled(this.editor.graph.cellEditor.isContentEditing()||!mxClipboard.isEmpty()&&t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())),i.setEnabled(e.isEnabled())},GE.EditorUi.prototype.initClipboard=function(){var t=this,e=mxClipboard.cut;mxClipboard.cut=function(i){i.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):e.apply(this,arguments),t.updatePasteActionStates()};mxClipboard.copy;mxClipboard.copy=function(e){var i=null;if(e.cellEditor.isContentEditing())document.execCommand("copy",!1,null);else{i=i||e.getSelectionCells(),i=e.getExportableCells(e.model.getTopmostCells(i));for(var n=new Object,o=e.createCellLookup(i),r=e.cloneCells(i,null,n),a=new mxGraphModel,l=a.getChildAt(a.getRoot(),0),s=0;s<r.length;s++){a.add(l,r[s]);var d=e.view.getState(i[s]);if(null!=d){var h=e.getCellGeometry(r[s]);null!=h&&h.relative&&!a.isEdge(i[s])&&null==o[mxObjectIdentity.get(a.getParent(i[s]))]&&(h.offset=null,h.relative=!1,h.x=d.x/d.view.scale-d.view.translate.x,h.y=d.y/d.view.scale-d.view.translate.y)}}e.updateCustomLinks(e.createCellMapping(n,o),r),mxClipboard.insertCount=1,mxClipboard.setCells(r)}return t.updatePasteActionStates(),i};var i=mxClipboard.paste;mxClipboard.paste=function(e){var n=null;return e.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):n=i.apply(this,arguments),t.updatePasteActionStates(),n};var n=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){n.apply(this,arguments),t.updatePasteActionStates()};var o=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(e,i){o.apply(this,arguments),t.updatePasteActionStates()},this.updatePasteActionStates()},GE.EditorUi.prototype.lazyZoomDelay=20,GE.EditorUi.prototype.wheelZoomDelay=400,GE.EditorUi.prototype.buttonZoomDelay=600,GE.EditorUi.prototype.initCanvas=function(){var t=this.editor.graph;t.timerAutoScroll=!0,t.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((t.container.offsetWidth-34)/t.view.scale)),Math.max(0,Math.round((t.container.offsetHeight-34)/t.view.scale)))},t.view.getBackgroundPageBounds=function(){var t=this.graph.getPageSize();return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,this.scale*t.width,this.scale*t.height)},t.getPreferredPageSize=function(t,e,i){var n=this.getPageSize();return new mxRectangle(0,0,n.width,n.height)};var e=this;if(this.editor.extendCanvas){var i=t.view.validate;t.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var t=this.graph.getPagePadding(),e=this.graph.getPageSize();this.translate.x,this.translate.y;this.translate.x=t.x-(this.x0||0)*e.width,this.translate.y=t.y-(this.y0||0)*e.height}i.apply(this,arguments)};var n=t.sizeDidChange;t.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var e=this.getPagePadding(),i=this.getPageSize(),o=Math.ceil(2*e.x+i.width),r=Math.ceil(2*e.y+i.height),a=t.minimumGraphSize;null!=a&&a.width==o&&a.height==r||(t.minimumGraphSize=new mxRectangle(0,0,o,r));var l=e.x,s=e.y;if(!this.autoTranslate&&(this.view.translate.x!=l||this.view.translate.y!=s)){this.autoTranslate=!0,this.view.x0=0,this.view.y0=0;var d=t.view.translate.x,h=t.view.translate.y;return t.view.setTranslate(l,s),t.container.scrollLeft+=Math.round((l-d)*t.view.scale),t.container.scrollTop+=Math.round((s-h)*t.view.scale),void(this.autoTranslate=!1)}n.apply(this,arguments)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}}var o=t.view.getBackgroundPane(),r=t.view.getDrawPane();t.cumulativeZoomFactor=1;var a=null,l=null,s=null,d=null,h=function(i){null!=a&&window.clearTimeout(a),window.setTimeout(function(){t.isMouseDown||(a=window.setTimeout(mxUtils.bind(this,function(){t.isFastZoomEnabled()&&(null!=t.view.backgroundPageShape&&null!=t.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(t.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(t.view.backgroundPageShape.node.style,"transform",null)),r.style.transformOrigin="",o.style.transformOrigin="",GE.IS_SF?(r.style.transform="scale(1)",o.style.transform="scale(1)",window.setTimeout(function(){r.style.transform="",o.style.transform=""},0)):(r.style.transform="",o.style.transform=""),t.view.getDecoratorPane().style.opacity="",t.view.getOverlayPane().style.opacity="");var e=new mxPoint(t.container.scrollLeft,t.container.scrollTop),i=mxUtils.getOffset(t.container),n=t.view.scale,h=0,c=0;null!=l&&(h=t.container.offsetWidth/2-l.x+i.x,c=t.container.offsetHeight/2-l.y+i.y),t.zoom(t.cumulativeZoomFactor),t.view.scale!=n&&(null!=s&&(h+=e.x-s.x,c+=e.y-s.y),!mxUtils.hasScrollbars(t.container)||0==h&&0==c||(t.container.scrollLeft-=h*(t.cumulativeZoomFactor-1),t.container.scrollTop-=c*(t.cumulativeZoomFactor-1))),null!=d&&r.setAttribute("filter",d),t.cumulativeZoomFactor=1,a=null,s=null,l=null,d=null}),null!=i?i:t.isFastZoomEnabled()?e.wheelZoomDelay:e.lazyZoomDelay))},0)};t.lazyZoom=function(i,n,a){if((n=n||!t.scrollbars)&&(l=new mxPoint(t.container.offsetLeft+t.container.clientWidth/2,t.container.offsetTop+t.container.clientHeight/2)),i?this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale),this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale,t.isFastZoomEnabled()){null==d&&""!=r.getAttribute("filter")&&(d=r.getAttribute("filter"),r.removeAttribute("filter")),s=new mxPoint(t.container.scrollLeft,t.container.scrollTop);var c=n?t.container.scrollLeft+t.container.clientWidth/2:l.x+t.container.scrollLeft-t.container.offsetLeft,u=n?t.container.scrollTop+t.container.clientHeight/2:l.y+t.container.scrollTop-t.container.offsetTop;if(r.style.transformOrigin=c+"px "+u+"px",r.style.transform="scale("+this.cumulativeZoomFactor+")",o.style.transformOrigin=c+"px "+u+"px",o.style.transform="scale("+this.cumulativeZoomFactor+")",null!=t.view.backgroundPageShape&&null!=t.view.backgroundPageShape.node){var g=t.view.backgroundPageShape.node;mxUtils.setPrefixedStyle(g.style,"transform-origin",(n?t.container.clientWidth/2+t.container.scrollLeft-g.offsetLeft+"px":l.x+t.container.scrollLeft-g.offsetLeft-t.container.offsetLeft+"px")+" "+(n?t.container.clientHeight/2+t.container.scrollTop-g.offsetTop+"px":l.y+t.container.scrollTop-g.offsetTop-t.container.offsetTop+"px")),mxUtils.setPrefixedStyle(g.style,"transform","scale("+this.cumulativeZoomFactor+")")}t.view.getDecoratorPane().style.opacity="0",t.view.getOverlayPane().style.opacity="0",null!=e.hoverIcons&&e.hoverIcons.reset()}h(a)},mxEvent.addGestureListeners(t.container,function(t){null!=a&&window.clearTimeout(a)},null,function(e){1!=t.cumulativeZoomFactor&&h(0)}),mxEvent.addListener(t.container,"scroll",function(){a&&!t.isMouseDown&&1!=t.cumulativeZoomFactor&&h(0)}),mxEvent.addMouseWheelListener(mxUtils.bind(this,function(e,i,n){if(null==this.dialogs||0==this.dialogs.length)if(!t.scrollbars&&t.isScrollWheelEvent(e)){var o=t.view.getTranslate(),r=40/t.view.scale;mxEvent.isShiftDown(e)?t.view.setTranslate(o.x+(i?-r:r),o.y):t.view.setTranslate(o.x,o.y+(i?r:-r))}else if(n||t.isZoomWheelEvent(e))for(var a=mxEvent.getSource(e);null!=a;){if(a==t.container)return t.tooltipHandler.hideTooltip(),l=new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e)),t.lazyZoom(i),mxEvent.consume(e),!1;a=a.parentNode}}),t.container),t.panningHandler.zoomGraph=function(e){t.cumulativeZoomFactor=e.scale,t.lazyZoom(e.scale>0,!0),mxEvent.consume(e)}},GE.EditorUi.prototype.addChromelessToolbarItems=function(t){t(mxUtils.bind(this,function(t){this.actions.get("print").funct(),mxEvent.consume(t)}),GE.Editor.printLargeImage,mxResources.get("print"))},GE.EditorUi.prototype.createTemporaryGraph=function(t){var e=new GE.Graph(document.createElement("div"),null,null,t);return e.resetViewOnRootChange=!1,e.setConnectable(!1),e.gridEnabled=!1,e.autoScroll=!1,e.setTooltips(!1),e.setEnabled(!1),e.container.style.visibility="hidden",e.container.style.position="absolute",e.container.style.overflow="hidden",e.container.style.height="1px",e.container.style.width="1px",e},GE.EditorUi.prototype.toggleFormatPanel=function(t){t=null!=t?t:0==this.formatWidth,null!=this.format&&(this.formatWidth=t?240:0,this.formatContainer.style.display=t?"":"none",this.refresh(),this.format.refresh(),this.fireEvent(new mxEventObject("formatWidthChanged")))},GE.EditorUi.prototype.lightboxFit=function(t){if(this.isDiagramEmpty())this.editor.graph.view.setScale(1);else{this.editor.graph.maxFitScale=this.lightboxMaxFitScale,this.editor.graph.fit(60,null,null,null,null,null,t),this.editor.graph.maxFitScale=null}},GE.EditorUi.prototype.isDiagramEmpty=function(){var t=this.editor.graph.getModel();return 1==t.getChildCount(t.root)&&0==t.getChildCount(t.getChildAt(t.root,0))},GE.EditorUi.prototype.isSelectionAllowed=function(t){return"SELECT"==mxEvent.getSource(t).nodeName||"INPUT"==mxEvent.getSource(t).nodeName&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(t))},GE.EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){return this.onBeforeUnload()})},GE.EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified)return mxResources.get("allChangesLost")},GE.EditorUi.prototype.open=function(){try{null!=window.opener&&null!=window.opener.openFile&&window.opener.openFile.setConsumer(mxUtils.bind(this,function(t,e){try{var i=mxUtils.parseXml(t);return this.editor.setGraphXml(i.documentElement),this.editor.setModified(!1),this.editor.undoManager.clear(),void(null!=e&&(this.editor.setFilename(e),this.updateDocumentTitle()))}catch(t){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+t.message)}}))}catch(t){}this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},GE.EditorUi.prototype.setGraphXml=function(t){const e=this.editor.graph;if(!t||0==t.length)return e.background=GE.BACKGROUND||null,e.backgroundImage=null,void e.model.clear();try{var i=mxUtils.parseXml(t);this.editor.setGraphXml(i.documentElement),this.editor.setModified(!1),this.editor.undoManager.clear()}catch(t){mxUtils.alert("错误的XML字符串: "+t.message)}},GE.EditorUi.prototype.setCurrentMenu=function(t,e){this.currentMenuElt=e,this.currentMenu=t},GE.EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},GE.EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},GE.EditorUi.prototype.updateDocumentTitle=function(){var t=this.editor.getOrCreateFilename();null!=this.editor.appName&&(t+=" - "+this.editor.appName),document.title=t},GE.EditorUi.prototype.createHoverIcons=function(){return new GE.HoverIcons(this.editor.graph)},GE.EditorUi.prototype.redo=function(){try{this.editor.graph.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(t){}},GE.EditorUi.prototype.undo=function(){try{var t=this.editor.graph;if(t.isEditing()){var e=t.cellEditor.textarea.innerHTML;document.execCommand("undo",!1,null),e==t.cellEditor.textarea.innerHTML&&(t.stopEditing(!0),this.editor.undoManager.undo())}else this.editor.undoManager.undo()}catch(t){}},GE.EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},GE.EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},GE.EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},GE.EditorUi.prototype.getUrl=function(t){return null!=t?t:window.location.pathname},GE.EditorUi.prototype.setScrollbars=function(t){var e=this.editor.graph,i=e.container.style.overflow;e.scrollbars=t,this.editor.updateGraphComponents(),i!=e.container.style.overflow&&(e.container.scrollTop=0,e.container.scrollLeft=0,e.view.scaleAndTranslate(1,0,0),this.resetScrollbars()),this.fireEvent(new mxEventObject("scrollbarsChanged"))},GE.EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},GE.EditorUi.prototype.resetScrollbars=function(){var t=this.editor.graph;if(this.editor.extendCanvas)if(mxUtils.hasScrollbars(t.container)){var e=t.getPagePadding();t.container.scrollTop=Math.floor(e.y-this.editor.initialTopSpacing)-1,t.container.scrollLeft=Math.floor(Math.min(e.x,(t.container.scrollWidth-t.container.clientWidth)/2))-1;var i=t.getGraphBounds();i.width>0&&i.height>0&&(i.x>t.container.scrollLeft+.9*t.container.clientWidth&&(t.container.scrollLeft=Math.min(i.x+i.width-t.container.clientWidth,i.x-10)),i.y>t.container.scrollTop+.9*t.container.clientHeight&&(t.container.scrollTop=Math.min(i.y+i.height-t.container.clientHeight,i.y-10)))}else{var n=mxRectangle.fromRectangle(t.view.getBackgroundPageBounds()),o=t.view.translate,r=t.view.scale;n.x=n.x/r-o.x,n.y=n.y/r-o.y,n.width/=r,n.height/=r,t.view.setTranslate(Math.floor(Math.max(0,(t.container.clientWidth-n.width)/2)-n.x+2),Math.floor(0-n.y+1))}else t.container.scrollTop=0,t.container.scrollLeft=0,mxUtils.hasScrollbars(t.container)||t.view.setTranslate(0,0)},ChangePageSetup.prototype.execute=function(){var t=this.ui.editor.graph;if(!this.ignoreColor){this.color=this.previousColor;var e=t.background;this.ui.setBackgroundColor(this.previousColor),this.previousColor=e}if(!this.ignoreImage){this.image=this.previousImage;e=t.backgroundImage;this.ui.setBackgroundImage(this.previousImage),this.previousImage=e}if(null!=this.previousFormat){this.format=this.previousFormat;e=t.pageFormat;this.previousFormat.width==e.width&&this.previousFormat.height==e.height||(this.ui.setPageFormat(this.previousFormat),this.previousFormat=e)}if(null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled),null!=this.previousPageScale){var i=this.ui.editor.graph.pageScale;this.previousPageScale!=i&&(this.ui.setPageScale(this.previousPageScale),this.previousPageScale=i)}},function(){var t=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat","previousPageScale"]);t.afterDecode=function(t,e,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,i.previousPageScale=i.pageScale,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(t)}(),GE.EditorUi.prototype.setBackgroundColor=function(t){this.editor.graph.background=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},GE.EditorUi.prototype.setFoldingEnabled=function(t){this.editor.graph.foldingEnabled=t,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},GE.EditorUi.prototype.setPageFormat=function(t){this.editor.graph.pageFormat=t,this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange(),this.fireEvent(new mxEventObject("pageFormatChanged"))},GE.EditorUi.prototype.setPageScale=function(t){this.editor.graph.pageScale=t,this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange(),this.fireEvent(new mxEventObject("pageScaleChanged"))},GE.EditorUi.prototype.setGridColor=function(t){this.editor.graph.view.gridColor=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},GE.EditorUi.prototype.addUndoListener=function(){var t=this.actions.get("undo"),e=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,function(){t.setEnabled(this.canUndo()),e.setEnabled(this.canRedo())});i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var o=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){o.apply(this,arguments),n()};var r=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,e){r.apply(this,arguments),n()},n()},GE.EditorUi.prototype.updateActionStates=function(){var t=this.editor.graph,e=!t.isSelectionEmpty(),i=!1,n=!1,o=t.getSelectionCells();if(null!=o)for(var r=0;r<o.length;r++){const e=o[r];if(t.getModel().isEdge(e)&&(n=!0),t.getModel().isVertex(e)&&(i=!0),n&&i)break}var a=["bold","italic","underline","editStyle","backgroundColor","borderColor","edit","toFront","toBack","lockUnlock","solid","dashed","pasteSize","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"];for(let t=0;t<a.length;t++)this.actions.get(a[t]).setEnabled(e);var l=t.getSelectionCell(),s=t.getSelectionCount(),d=["cut","copy","delete","duplicate"];{let t;if(1===s)t=!l.isSub;else if(s>1){t=!1;for(let e=0;e<o.length;e++)if(!o[e].isSub){t=!0;break}}for(let e=0;e<d.length;e++)this.actions.get(d[e]).setEnabled(t)}this.actions.get("setAsDefaultStyle").setEnabled(1===s),this.actions.get("clearWaypoints").setEnabled(!t.isSelectionEmpty()),this.actions.get("copySize").setEnabled(1===s),this.actions.get("turn").setEnabled(!t.isSelectionEmpty()),this.actions.get("curved").setEnabled(n),this.actions.get("rotation").setEnabled(i),this.actions.get("wordWrap").setEnabled(i),this.actions.get("autosize").setEnabled(i);var h=i&&1===s;this.actions.get("group").setEnabled(s>1||h&&!t.isContainer(l)),this.actions.get("ungroup").setEnabled(1===s&&!l.type1&&(t.getModel().getChildCount(l)>0||h&&t.isContainer(l))),this.actions.get("removeFromGroup").setEnabled(h&&t.getModel().isVertex(t.getModel().getParent(l))),this.menus.get("navigation").setEnabled(e||null!=t.view.currentRoot),this.actions.get("collapsible").setEnabled(i&&(t.isContainer(l)||t.model.getChildCount(l)>0)),this.actions.get("home").setEnabled(null!=t.view.currentRoot),this.actions.get("exitGroup").setEnabled(null!=t.view.currentRoot),this.actions.get("enterGroup").setEnabled(1===s&&!l.isSub&&t.isValidRoot(l));var c=1===s&&t.isCellFoldable(l);this.actions.get("expand").setEnabled(c),this.actions.get("collapse").setEnabled(c),this.actions.get("bindProperties").setEnabled(1===s),this.actions.get("guides").setEnabled(t.isEnabled()),this.actions.get("grid").setEnabled(this.editor.editable);var u=t.isEnabled()&&!t.isCellLocked(t.getDefaultParent());this.menus.get("layout").setEnabled(u),this.menus.get("insert").setEnabled(u),this.menus.get("direction").setEnabled(u&&i),this.menus.get("align").setEnabled(u&&i&&s>1),this.menus.get("distribute").setEnabled(u&&i&&s>1),this.actions.get("selectVertices").setEnabled(u),this.actions.get("selectEdges").setEnabled(u),this.actions.get("selectAll").setEnabled(u),this.actions.get("selectNone").setEnabled(u),this.updatePasteActionStates()},GE.EditorUi.prototype.zeroOffset=new mxPoint(0,0),GE.EditorUi.prototype.getDiagramContainerOffset=function(){return this.zeroOffset},GE.EditorUi.prototype.refresh=function(t){t=null==t||t;var e=this.container.clientWidth,i=this.container.clientHeight;this.container==document.body&&(e=document.body.clientWidth||document.documentElement.clientWidth,i=document.documentElement.clientHeight);var n=0;GE.IS_IOS&&!window.navigator.standalone&&window.innerHeight!=document.documentElement.clientHeight&&(n=document.documentElement.clientHeight-window.innerHeight,window.scrollTo(0,0));var o=Math.max(0,Math.min(this.hsplitPosition,e-this.splitSize-20)),r=0;null!=this.menubar&&(this.menubarContainer.style.height=this.menubarHeight+"px",r+=this.menubarHeight),null!=this.toolbar&&(this.toolbarContainer.style.top=this.menubarHeight+"px",this.toolbarContainer.style.height=this.toolbarHeight+"px",r+=this.toolbarHeight),r>0&&(r+=1);var a=0;if(null!=this.sidebarFooterContainer){var l=this.footerHeight+n;a=Math.max(0,Math.min(i-r-l,this.sidebarFooterHeight)),this.sidebarFooterContainer.style.width=o+"px",this.sidebarFooterContainer.style.height=a+"px",this.sidebarFooterContainer.style.bottom=l+"px"}var s=null!=this.format?this.formatWidth:0;this.sidebarContainer.style.top=r+"px",this.sidebarContainer.style.width=o+"px",this.formatContainer.style.top=r+"px",this.formatContainer.style.width=s+"px",this.formatContainer.style.display=null!=this.format?"":"none";var d=this.getDiagramContainerOffset(),h=null!=this.hsplit.parentNode?o+this.splitSize:0;this.diagramContainer.style.left=h+d.x+"px",this.diagramContainer.style.top=r+d.y+"px",this.footerContainer.style.height=this.footerHeight+"px",this.hsplit.style.top=this.sidebarContainer.style.top,this.hsplit.style.bottom=this.footerHeight+n+"px",this.hsplit.style.left=o+"px",this.footerContainer.style.display=0==this.footerHeight?"none":"",null!=this.tabContainer&&(this.tabContainer.style.left=h+"px"),this.footerHeight>0&&(this.footerContainer.style.bottom=n+"px"),this.diagramContainer.style.right=s+"px";var c=0;null!=this.tabContainer&&(this.tabContainer.style.bottom=this.footerHeight+n+"px",this.tabContainer.style.right=this.diagramContainer.style.right,c=this.tabContainer.clientHeight),this.sidebarContainer.style.bottom=this.footerHeight+a+n+"px",this.formatContainer.style.bottom=this.footerHeight+n+"px",this.diagramContainer.style.bottom=this.footerHeight+n+c+"px",t&&this.editor.graph.sizeDidChange()},GE.EditorUi.prototype.createTabContainer=function(){return null},GE.EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer"),this.toolbarContainer=this.createDiv("geToolbarContainer"),this.sidebarContainer=this.createDiv("geSidebarContainer"),this.formatContainer=this.createDiv("geSidebarContainer geFormatContainer"),this.diagramContainer=this.createDiv("geDiagramContainer"),this.footerContainer=this.createDiv("geFooterContainer"),this.hsplit=this.createDiv("geHsplit"),this.hsplit.setAttribute("title",mxResources.get("collapseExpand")),this.menubarContainer.style.top="0px",this.menubarContainer.style.left="0px",this.menubarContainer.style.right="0px",this.toolbarContainer.style.left="0px",this.toolbarContainer.style.right="0px",this.sidebarContainer.style.left="0px",this.formatContainer.style.right="0px",this.formatContainer.style.zIndex="1",this.diagramContainer.style.right=(null!=this.format?this.formatWidth:0)+"px",this.footerContainer.style.left="0px",this.footerContainer.style.right="0px",this.footerContainer.style.bottom="0px",this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-2,this.hsplit.style.width=this.splitSize+"px",this.sidebarFooterContainer=this.createSidebarFooterContainer(),this.sidebarFooterContainer&&(this.sidebarFooterContainer.style.left="0px"),this.tabContainer=this.createTabContainer()},GE.EditorUi.prototype.createSidebarFooterContainer=function(){return null},GE.EditorUi.prototype.createUi=function(t,e){this.menubar=this.menus.createMenubar(this.createDiv("geMenubar")),null!=this.menubar&&this.menubarContainer.appendChild(this.menubar.container),null!=this.menubar&&(this.statusContainer=this.createStatusContainer(),this.editor.addListener("statusChanged",mxUtils.bind(this,function(){this.setStatusText(this.editor.getStatus())})),this.setStatusText(this.editor.getStatus()),this.menubar.container.appendChild(this.statusContainer),this.container.appendChild(this.menubarContainer)),this.sidebar=this.createSidebar(this.sidebarContainer,t,e),null!=this.sidebar&&this.container.appendChild(this.sidebarContainer),this.format=this.formatEnabled?this.createFormat(this.formatContainer):null,null!=this.format&&this.container.appendChild(this.formatContainer);var i=this.createFooter();null!=i&&(this.footerContainer.appendChild(i),this.container.appendChild(this.footerContainer)),null!=this.sidebar&&this.sidebarFooterContainer&&this.container.appendChild(this.sidebarFooterContainer),this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),this.toolbar=this.createToolbar(this.createDiv("geToolbar")),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.sidebar&&(this.container.appendChild(this.hsplit),this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,function(t){this.hsplitPosition=t,this.refresh()})))},GE.EditorUi.prototype.createStatusContainer=function(){var t=document.createElement("a");return t.className="geItem geStatus",screen.width<420&&(t.style.maxWidth=Math.max(20,screen.width-320)+"px",t.style.overflow="hidden"),t},GE.EditorUi.prototype.setStatusText=function(t){this.statusContainer.innerHTML=t},GE.EditorUi.prototype.createToolbar=function(t){return new GE.Toolbar(this,t)},GE.EditorUi.prototype.createSidebar=function(t,e,i){return new GE.Sidebar(this,t,e,i)},GE.EditorUi.prototype.createFormat=function(t){return new GE.Format(this,t)},GE.EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")},GE.EditorUi.prototype.createDiv=function(t){var e=document.createElement("div");return e.className=t,e},GE.EditorUi.prototype.addSplitHandler=function(t,e,i,n){var o=null,r=null,a=!0,l=null;GE.IS_POINTER&&(t.style.touchAction="none");var s=mxUtils.bind(this,function(){var n=parseInt(e?t.style.left:t.style.bottom);return e||(n=n+i-this.footerHeight),n});function d(t){if(null!=o){var d=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t));n(Math.max(0,r+(e?d.x-o.x:o.y-d.y)-i)),mxEvent.consume(t),r!=s()&&(a=!0,l=null)}}function h(t){d(t),r=null,o=null}mxEvent.addGestureListeners(t,function(t){o=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),r=s(),a=!1,mxEvent.consume(t)}),mxEvent.addListener(t,"click",mxUtils.bind(this,function(t){if(!a&&this.hsplitClickEnabled){var e=null!=l?l-i:0;l=s(),n(e),mxEvent.consume(t)}})),mxEvent.addGestureListeners(document,null,d,h),this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,d,h)})},GE.EditorUi.prototype.handleError=function(t,e,i,n,o){var r=null!=t&&null!=t.error?t.error:t;if(null!=r||null!=e){var a=mxUtils.htmlEntities(mxResources.get("unknownError")),l=mxResources.get("ok");e=null!=e?e:mxResources.get("error"),null!=r&&null!=r.message&&(a=mxUtils.htmlEntities(r.message)),this.showError(e,a,l,i,null,null,null,null,null,null,null,null,n?i:null)}else null!=i&&i()},GE.EditorUi.prototype.showError=function(t,e,i,n,o,r,a,l,s,d,h,c,u){var g=new GE.ErrorDialog(this,t,e,i||mxResources.get("ok"),n,o,r,a,c,l,s),p=Math.ceil(null!=e?e.length/50:1);this.showDialog(g.container,d||340,h||100+20*p,!0,!1,u),g.init()},GE.EditorUi.prototype.showDialog=function(t,e,i,n,o,r,a,l,s,d){this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new GE.Dialog(this,t,e,i,n,o,r,a,l,s,d),this.dialogs.push(this.dialog)},GE.EditorUi.prototype.hideDialog=function(t,e){if(null!=this.dialogs&&this.dialogs.length>0){var i=this.dialogs.pop();if(0==i.close(t,e))return void this.dialogs.push(i);this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null,this.editor.fireEvent(new mxEventObject("hideDialog")),null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&window.setTimeout(mxUtils.bind(this,function(){this.editor.graph.isEditing()&&null!=this.editor.graph.cellEditor.textarea?this.editor.graph.cellEditor.textarea.focus():(mxUtils.clearSelection(),this.editor.graph.container.focus())}),0)}},GE.EditorUi.prototype.ctrlEnter=function(){var t=this.editor.graph;if(t.isEnabled())try{for(var e=t.getSelectionCells(),i=new mxDictionary,n=[],o=0;o<e.length;o++){var r=t.isTableCell(e[o])?t.model.getParent(e[o]):e[o];null==r||i.get(r)||(i.put(r,!0),n.push(r))}t.setSelectionCells(t.duplicateCells(n,!1))}catch(t){this.handleError(t)}},GE.EditorUi.prototype.pickColor=function(t,e){var i=this.editor.graph,n=i.cellEditor.saveSelection(),o=226+17*(Math.ceil(GE.ColorDialog.prototype.presetColors.length/12)+Math.ceil(GE.ColorDialog.prototype.defaultColors.length/12)),r=new GE.ColorDialog(this,t||"none",function(t){i.cellEditor.restoreSelection(n),e(t)},function(){i.cellEditor.restoreSelection(n)});this.showDialog(r.container,230,o,!0,!1),r.init()},GE.EditorUi.prototype.openFile=function(){window.openFile=new GE.OpenFile(mxUtils.bind(this,function(t){this.hideDialog(t)})),this.showDialog(new GE.OpenDialog(this).container,GE.Editor.useLocalStorage?640:320,GE.Editor.useLocalStorage?480:220,!0,!0,function(){window.openFile=null})},GE.EditorUi.prototype.extractGraphModelFromHtml=function(t){var e=null;try{var i=t.indexOf("&lt;mxGraphModel ");if(i>=0){var n=t.lastIndexOf("&lt;/mxGraphModel&gt;");n>i&&(e=t.substring(i,n+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,""))}}catch(t){}return e},GE.EditorUi.prototype.extractGraphModelFromEvent=function(t){var e=null,i=null;if(null!=t){var n=null!=t.dataTransfer?t.dataTransfer:t.clipboardData;if(null!=n&&(11==document.documentMode?i=n.getData("Text"):(i=mxUtils.indexOf(n.types,"text/html")>=0?n.getData("text/html"):null,mxUtils.indexOf(n.types,null==i||0==i.length)&&(i=n.getData("text/plain"))),null!=i)){i=GE.Graph.zapGremlins(mxUtils.trim(i));var o=this.extractGraphModelFromHtml(i);null!=o&&(i=o)}}return null!=i&&this.isCompatibleString(i)&&(e=i),e},GE.EditorUi.prototype.isCompatibleString=function(t){return!1},GE.EditorUi.prototype.executeLayout=function(t,e,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{t()}catch(t){throw t}finally{if(this.allowAnimation&&e&&(null==navigator.userAgent||navigator.userAgent.indexOf("Camino")<0)){var o=new mxMorphing(n);o.addListener(mxEvent.DONE,mxUtils.bind(this,function(){n.getModel().endUpdate(),null!=i&&i()})),o.startAnimation()}else n.getModel().endUpdate(),null!=i&&i()}}},GE.EditorUi.prototype.showImageDialog=function(t,e,i){if(this.insertImage){var n=this.editor.graph.cellEditor,o=n.saveSelection();this.insertImage(t,t=>{if(n.restoreSelection(o),null!=t&&t.length>0){var i=new Image;i.onload=function(){e(t,i.width,i.height)},i.onerror=function(){e(null),mxUtils.alert(mxResources.get("fileNotFound"))},i.src=t}else e(null)})}},GE.EditorUi.prototype.showGraphThemesDialog=function(t,e){if(this.selectGraphThemes){t=null!=t?t:mxUtils.bind(this,function(t){var e=new ChangePageSetup(this,null,t);e.ignoreColor=!0,this.editor.graph.model.execute(e)});const i=null!=e?e.src:"";this.selectGraphThemes(i,mxUtils.bind(this,function(e){if(i!==e)if(null!=e&&e.length>0){var n=new Image;n.onload=function(){t(new mxImage(e,n.width,n.height),!1)},n.onerror=function(){t(null,!0),mxUtils.alert(mxResources.get("fileNotFound"))},n.src=e}else t(null)}))}},GE.EditorUi.prototype.setBackgroundImage=function(t){this.editor.graph.setBackgroundImage(t),this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},GE.EditorUi.prototype.confirm=function(t,e,i){mxUtils.confirm(t)?null!=e&&e():null!=i&&i()},GE.EditorUi.prototype.createOutline=function(t){var e=new mxOutline(this.editor.graph);return e.border=20,mxEvent.addListener(window,"resize",function(){e.update()}),this.addListener("pageFormatChanged",function(){e.update()}),e},GE.EditorUi.prototype.altShiftActions={67:"clearWaypoints",65:"connectionArrows",80:"connectionPoints",86:"pasteSize",88:"copySize"},GE.EditorUi.prototype.createKeyHandler=function(t){var e=this,i=this.editor.graph,n=new mxKeyHandler(i),o=n.isEventIgnored;n.isEventIgnored=function(t){return!(mxEvent.isShiftDown(t)&&9==t.keyCode)&&(!this.isControlDown(t)||mxEvent.isShiftDown(t)||90!=t.keyCode&&89!=t.keyCode&&188!=t.keyCode&&190!=t.keyCode&&85!=t.keyCode)&&(66!=t.keyCode&&73!=t.keyCode||!this.isControlDown(t)||this.graph.cellEditor.isContentEditing()&&!GE.IS_FF&&!GE.IS_SF)&&o.apply(this,arguments)},n.isEnabledForEvent=function(t){return!mxEvent.isConsumed(t)&&this.isGraphEvent(t)&&this.isEnabled()&&(null==e.dialogs||0==e.dialogs.length)},n.isControlDown=function(t){return mxEvent.isControlDown(t)||GE.IS_MAC&&t.metaKey};var r=[],a=null;function l(t,e,n){r.push(function(){if(!i.isSelectionEmpty()&&i.isEnabled())if(e=null!=e?e:1,n){i.getModel().beginUpdate();try{for(var o=i.getSelectionCells(),r=0;r<o.length;r++)if(i.getModel().isVertex(o[r])&&i.isCellResizable(o[r])){var a=i.getCellGeometry(o[r]);null!=a&&(a=a.clone(),37==t?a.width=Math.max(0,a.width-e):38==t?a.height=Math.max(0,a.height-e):39==t?a.width+=e:40==t&&(a.height+=e),i.getModel().setGeometry(o[r],a))}}finally{i.getModel().endUpdate()}}else{var l=i.getSelectionCell(),s=i.model.getParent(l),d=null;if(1==i.getSelectionCount()&&i.model.isVertex(l)&&null!=i.layoutManager&&!i.isCellLocked(l)&&(d=i.layoutManager.getLayout(s)),null!=d&&d.constructor==mxStackLayout){var h=s.getIndex(l);37==t||38==t?i.model.add(s,l,Math.max(0,h-1)):39!=t&&40!=t||i.model.add(s,l,Math.min(i.model.getChildCount(s),h+1))}else{o=i.getMovableCells(i.getSelectionCells());var c=[];for(r=0;r<o.length;r++){var u=i.getCurrentCellStyle(o[r]);if("1"==mxUtils.getValue(u,"part","0")){s=i.model.getParent(o[r]);i.model.isVertex(s)&&mxUtils.indexOf(o,s)<0&&c.push(s)}else c.push(o[r])}if(c.length>0){o=c;var g=0,p=0;37==t?g=-e:38==t?p=-e:39==t?g=e:40==t&&(p=e),i.moveCells(o,g,p)}}}}),null!=a&&window.clearTimeout(a),a=window.setTimeout(function(){if(r.length>0){i.getModel().beginUpdate();try{for(var t=0;t<r.length;t++)r[t]();r=[]}finally{i.getModel().endUpdate()}}},200)}var s={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},d=n.getFunction;mxKeyHandler.prototype.getFunction=function(t){if(i.isEnabled()){if(mxEvent.isShiftDown(t)&&mxEvent.isAltDown(t)){var n=e.actions.get(e.altShiftActions[t.keyCode]);if(null!=n)return n.funct}if(9==t.keyCode&&mxEvent.isAltDown(t))return i.cellEditor.isContentEditing()?function(){document.execCommand("outdent",!1,null)}:mxEvent.isShiftDown(t)?function(){i.selectParentCell()}:function(){i.selectChildCell()};if(null!=s[t.keyCode]&&!i.isSelectionEmpty()){if(this.isControlDown(t)||!mxEvent.isShiftDown(t)||!mxEvent.isAltDown(t))return this.isControlDown(t)?function(){l(t.keyCode,mxEvent.isShiftDown(t)?i.gridSize:null,!0)}:function(){l(t.keyCode,mxEvent.isShiftDown(t)?i.gridSize:null)};if(i.model.isVertex(i.getSelectionCell()))return function(){var n=i.connectVertex(i.getSelectionCell(),s[t.keyCode],i.defaultEdgeLength,t,!0);null!=n&&n.length>0&&(1==n.length&&i.model.isEdge(n[0])?i.setSelectionCell(i.model.getTerminal(n[0],!1)):i.setSelectionCell(n[n.length-1]),i.scrollCellToVisible(i.getSelectionCell()),null!=e.hoverIcons&&e.hoverIcons.update(i.view.getState(i.getSelectionCell())))}}}return d.apply(this,arguments)},n.bindAction=mxUtils.bind(this,function(t,e,i,o){var r=this.actions.get(i);if(null!=r){var a=function(){r.isEnabled()&&r.funct()};e?o?n.bindControlShiftKey(t,a):n.bindControlKey(t,a):o?n.bindShiftKey(t,a):n.bindKey(t,a)}});var h=this,c=n.escape;return n.escape=function(t){c.apply(this,arguments)},n.enter=function(){},n.bindControlShiftKey(36,function(){i.exitGroup()}),n.bindControlShiftKey(35,function(){i.enterGroup()}),n.bindShiftKey(36,function(){i.home()}),n.bindKey(35,function(){i.refresh()}),n.bindAction(107,!0,"zoomIn"),n.bindAction(109,!0,"zoomOut"),n.bindAction(80,!0,"print"),n.bindAction(79,!0,"outline",!0),this.editor.editable&&(n.bindControlKey(36,function(){i.isEnabled()&&i.foldCells(!0)}),n.bindControlKey(35,function(){i.isEnabled()&&i.foldCells(!1)}),n.bindControlKey(13,function(){h.ctrlEnter()}),n.bindAction(8,!1,"delete"),n.bindAction(8,!0,"deleteAll"),n.bindAction(46,!1,"delete"),n.bindAction(46,!0,"deleteAll"),n.bindAction(36,!1,"resetView"),n.bindAction(72,!0,"fitWindow",!0),n.bindAction(74,!0,"fitPage"),n.bindAction(74,!0,"fitTwoPages",!0),n.bindAction(48,!0,"customZoom"),n.bindAction(82,!0,"turn"),n.bindAction(82,!0,"clearDefaultStyle",!0),n.bindAction(83,!0,"save"),n.bindAction(83,!0,"saveAndReturn",!0),n.bindAction(81,!0,"nosaveAndReturn"),n.bindAction(65,!0,"selectAll"),n.bindAction(65,!0,"selectNone",!0),n.bindAction(73,!0,"selectVertices",!0),n.bindAction(69,!0,"selectEdges",!0),n.bindAction(69,!0,"editStyle"),n.bindAction(66,!0,"bold"),n.bindAction(66,!0,"toBack",!0),n.bindAction(70,!0,"toFront",!0),n.bindAction(68,!0,"duplicate"),n.bindAction(68,!0,"setAsDefaultStyle",!0),n.bindAction(90,!0,"undo"),n.bindAction(89,!0,"autosize",!0),n.bindAction(88,!0,"cut"),n.bindAction(67,!0,"copy"),n.bindAction(86,!0,"paste"),n.bindAction(71,!0,"group"),n.bindAction(77,!0,"bindProperties"),n.bindAction(71,!0,"grid",!0),n.bindAction(73,!0,"italic"),n.bindAction(76,!0,"lockUnlock"),n.bindAction(76,!0,"layers",!0),n.bindAction(80,!0,"formatPanel",!0),n.bindAction(85,!0,"underline"),n.bindAction(85,!0,"ungroup",!0),n.bindAction(190,!0,"superscript"),n.bindAction(188,!0,"subscript"),n.bindAction(9,!1,"indent",!0),n.bindKey(13,function(){i.isEnabled()&&i.startEditingAtCell()}),n.bindKey(113,function(){i.isEnabled()&&i.startEditingAtCell()})),GE.IS_WIN?n.bindAction(89,!0,"redo"):n.bindAction(90,!0,"redo",!0),n},GE.EditorUi.prototype.destroy=function(){if(null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.menubar&&(this.menubar.destroy(),this.menubar=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var t=0;t<this.destroyFunctions.length;t++)this.destroyFunctions[t]();this.destroyFunctions=null}var e=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog];for(t=0;t<e.length;t++)null!=e[t]&&null!=e[t].parentNode&&e[t].parentNode.removeChild(e[t])};