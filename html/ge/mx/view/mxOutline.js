function mxOutline(e,t){this.source=e,null!=t&&this.init(t)}mxOutline.prototype.source=null,mxOutline.prototype.outline=null,mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER,mxOutline.prototype.enabled=!0,mxOutline.prototype.showViewport=!0,mxOutline.prototype.border=10,mxOutline.prototype.sizerSize=8,mxOutline.prototype.labelsVisible=!1,mxOutline.prototype.updateOnPan=!1,mxOutline.prototype.sizerImage=null,mxOutline.prototype.minScale=1e-4,mxOutline.prototype.suspended=!1,mxOutline.prototype.createGraph=function(e){var t=new mxGraph(e,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());return t.foldingEnabled=!1,t.autoScroll=!1,t},mxOutline.prototype.init=function(e){this.outline=this.createGraph(e);var t=this.outline.graphModelChanged;if(this.outline.graphModelChanged=mxUtils.bind(this,function(e){this.suspended||null==this.outline||t.apply(this.outline,arguments)}),GE.IS_SVG){var i=this.outline.getView().getCanvas().parentNode;i.setAttribute("shape-rendering","optimizeSpeed"),i.setAttribute("image-rendering","optimizeSpeed")}this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=mxUtils.bind(this,function(e,t){this.suspended||this.active||this.update()}),this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler),this.outline.addMouseListener(this);var s=this.source.getView();s.addListener(mxEvent.SCALE,this.updateHandler),s.addListener(mxEvent.TRANSLATE,this.updateHandler),s.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler),s.addListener(mxEvent.DOWN,this.updateHandler),s.addListener(mxEvent.UP,this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=mxUtils.bind(this,function(e){this.updateOnPan&&this.updateHandler.apply(this,arguments)}),this.source.addListener(mxEvent.PAN,this.panHandler),this.refreshHandler=mxUtils.bind(this,function(e){this.outline.setStylesheet(this.source.getStylesheet()),this.outline.refresh()}),this.source.addListener(mxEvent.REFRESH,this.refreshHandler),this.bounds=new mxRectangle(0,0,0,0),this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH),this.selectionBorder.dialect=this.outline.dialect,this.selectionBorder.init(this.outline.getView().getOverlayPane());var n=mxUtils.bind(this,function(e){var t=mxEvent.getSource(e),i=mxUtils.bind(this,function(e){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(e))}),s=mxUtils.bind(this,function(e){mxEvent.removeGestureListeners(t,null,i,s),this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(e))});mxEvent.addGestureListeners(t,null,i,s),this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(e))});mxEvent.addGestureListeners(this.selectionBorder.node,n),this.sizer=this.createSizer(),this.sizer.init(this.outline.getView().getOverlayPane()),this.enabled&&(this.sizer.node.style.cursor="nwse-resize"),mxEvent.addGestureListeners(this.sizer.node,n),this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display,this.selectionBorder.node.style.cursor="move",this.update(!1)},mxOutline.prototype.isEnabled=function(){return this.enabled},mxOutline.prototype.setEnabled=function(e){this.enabled=e},mxOutline.prototype.setZoomEnabled=function(e){this.sizer.node.style.visibility=e?"visible":"hidden"},mxOutline.prototype.refresh=function(){this.update(!0)},mxOutline.prototype.createSizer=function(){var e;return null!=this.sizerImage?((e=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src)).dialect=this.outline.dialect,e):((e=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR)).dialect=this.outline.dialect,e)},mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)},mxOutline.prototype.getOutlineOffset=function(e){return null},mxOutline.prototype.getSourceGraphBounds=function(){return this.source.getGraphBounds()},mxOutline.prototype.update=function(e){if(null!=this.source&&null!=this.source.container&&null!=this.outline&&null!=this.outline.container){var t=this.source.view.scale,i=this.getSourceGraphBounds(),s=new mxRectangle(i.x/t+this.source.panDx,i.y/t+this.source.panDy,i.width/t,i.height/t),n=new mxRectangle(0,0,this.source.container.clientWidth/t,this.source.container.clientHeight/t),o=s.clone();o.add(n);var r=this.getSourceContainerSize(),h=Math.max(r.width/t,o.width),l=Math.max(r.height/t,o.height),a=Math.max(0,this.outline.container.clientWidth-this.border),u=Math.max(0,this.outline.container.clientHeight-this.border),d=Math.min(a/h,u/l),c=isNaN(d)?this.minScale:Math.max(this.minScale,d);if(c>0){this.outline.getView().scale!=c&&(this.outline.getView().scale=c,e=!0);var p=this.outline.getView();p.currentRoot!=this.source.getView().currentRoot&&p.setCurrentRoot(this.source.getView().currentRoot);var m=this.source.view.translate,x=m.x+this.source.panDx,g=m.y+this.source.panDy,y=this.getOutlineOffset(c);null!=y&&(x+=y.x,g+=y.y),s.x<0&&(x-=s.x),s.y<0&&(g-=s.y),p.translate.x==x&&p.translate.y==g||(p.translate.x=x,p.translate.y=g,e=!0);var v=p.translate,w=(c=this.source.getView().scale)/p.scale,b=1/p.scale,E=this.source.container;this.bounds=new mxRectangle((v.x-m.x-this.source.panDx)/b,(v.y-m.y-this.source.panDy)/b,E.clientWidth/w,E.clientHeight/w),this.bounds.x+=this.source.container.scrollLeft*p.scale/c,this.bounds.y+=this.source.container.scrollTop*p.scale/c,(O=this.selectionBorder.bounds).x==this.bounds.x&&O.y==this.bounds.y&&O.width==this.bounds.width&&O.height==this.bounds.height||(this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw());var O=this.sizer.bounds,f=new mxRectangle(this.bounds.x+this.bounds.width-O.width/2,this.bounds.y+this.bounds.height-O.height/2,O.width,O.height);O.x==f.x&&O.y==f.y&&O.width==f.width&&O.height==f.height||(this.sizer.bounds=f,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw()),e&&this.outline.view.revalidate()}}},mxOutline.prototype.mouseDown=function(e,t){if(this.enabled&&this.showViewport){var i=mxEvent.isMouseEvent(t.getEvent())?0:this.source.tolerance,s=this.source.allowHandleBoundsCheck&&i>0?new mxRectangle(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;this.zoom=t.isSource(this.sizer)||null!=s&&mxUtils.intersects(shape.bounds,s),this.startX=t.getX(),this.startY=t.getY(),this.active=!0,this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):(this.dx0=0,this.dy0=0)}t.consume()},mxOutline.prototype.mouseMove=function(e,t){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display;var i=this.getTranslateForEvent(t),s=i.x,n=i.y,o=null;if(this.zoom){var r=this.source.container;n=s/(r.clientWidth/r.clientHeight),o=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+s),Math.max(1,this.bounds.height+n)),this.selectionBorder.bounds=o,this.selectionBorder.redraw()}else{var h=this.outline.getView().scale;o=new mxRectangle(this.bounds.x+s,this.bounds.y+n,this.bounds.width,this.bounds.height),this.selectionBorder.bounds=o,this.selectionBorder.redraw(),s/=h,s*=this.source.getView().scale,n/=h,n*=this.source.getView().scale,this.source.panGraph(-s-this.dx0,-n-this.dy0)}var l=this.sizer.bounds;this.sizer.bounds=new mxRectangle(o.x+o.width-l.width/2,o.y+o.height-l.height/2,l.width,l.height),"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw(),t.consume()}},mxOutline.prototype.getTranslateForEvent=function(e){return new mxPoint(e.getX()-this.startX,e.getY()-this.startY)},mxOutline.prototype.mouseUp=function(e,t){if(this.active){var i=this.getTranslateForEvent(t),s=i.x,n=i.y;if(Math.abs(s)>0||Math.abs(n)>0){if(this.zoom){var o=this.selectionBorder.bounds.width,r=this.source.getView().scale;this.source.zoomTo(Math.max(this.minScale,r-s*r/o),!1)}else if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container)){this.source.panGraph(0,0),s/=this.outline.getView().scale,n/=this.outline.getView().scale;var h=this.source.getView().translate;this.source.getView().setTranslate(h.x-s,h.y-n)}this.update(),t.consume()}this.index=null,this.active=!1}},mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.removeListener(this.source.container,"scroll",this.updateHandler),this.source=null),null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)};