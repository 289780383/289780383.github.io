function mxGraphView(t){this.graph=t,this.translate=new mxPoint,this.graphBounds=new mxRectangle,this.states=new mxDictionary}function mxCurrentRootChange(t,e){if(this.view=t,this.root=e,this.previous=e,this.isUp=null==e,!this.isUp)for(var n=this.view.currentRoot,i=this.view.graph.getModel();null!=n;){if(n==e){this.isUp=!0;break}n=i.getParent(n)}}mxGraphView.prototype=new mxEventSource,mxGraphView.prototype.constructor=mxGraphView,mxGraphView.prototype.EMPTY_POINT=new mxPoint,mxGraphView.prototype.doneResource="none"!=GE.language?"done":"",mxGraphView.prototype.updatingDocumentResource="none"!=GE.language?"updatingDocument":"",mxGraphView.prototype.allowEval=!1,mxGraphView.prototype.captureDocumentGesture=!0,mxGraphView.prototype.optimizeVmlReflows=!0,mxGraphView.prototype.rendering=!0,mxGraphView.prototype.graph=null,mxGraphView.prototype.currentRoot=null,mxGraphView.prototype.graphBounds=null,mxGraphView.prototype.scale=1,mxGraphView.prototype.translate=null,mxGraphView.prototype.states=null,mxGraphView.prototype.updateStyle=!1,mxGraphView.prototype.lastNode=null,mxGraphView.prototype.lastHtmlNode=null,mxGraphView.prototype.lastForegroundNode=null,mxGraphView.prototype.lastForegroundHtmlNode=null,mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds},mxGraphView.prototype.setGraphBounds=function(t){this.graphBounds=t},mxGraphView.prototype.getBounds=function(t){var e=null;if(null!=t&&t.length>0)for(var n=this.graph.getModel(),i=0;i<t.length;i++)if(n.isVertex(t[i])||n.isEdge(t[i])){var a=this.getState(t[i]);null!=a&&(null==e?e=mxRectangle.fromRectangle(a):e.add(a))}return e},mxGraphView.prototype.setCurrentRoot=function(t){if(this.currentRoot!=t){var e=new mxCurrentRootChange(this,t);e.execute();var n=new mxUndoableEdit(this,!0);n.add(e),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",n)),this.graph.sizeDidChange()}return t},mxGraphView.prototype.scaleAndTranslate=function(t,e,n){var i=this.scale,a=new mxPoint(this.translate.x,this.translate.y);this.scale==t&&this.translate.x==e&&this.translate.y==n||(this.scale=t,this.translate.x=e,this.translate.y=n,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",t,"previousScale",i,"translate",this.translate,"previousTranslate",a))},mxGraphView.prototype.getScale=function(){return this.scale},mxGraphView.prototype.setScale=function(t){var e=this.scale;this.scale!=t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",t,"previousScale",e))},mxGraphView.prototype.getTranslate=function(){return this.translate},mxGraphView.prototype.setTranslate=function(t,e){var n=new mxPoint(this.translate.x,this.translate.y);this.translate.x==t&&this.translate.y==e||(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",n))},mxGraphView.prototype.viewStateChanged=function(){this.revalidate(),this.graph.sizeDidChange()},mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear(),this.revalidate()},mxGraphView.prototype.revalidate=function(){this.invalidate(),this.validate()},mxGraphView.prototype.clear=function(t,e,n){var i=this.graph.getModel();if(t=t||i.getRoot(),e=null!=e&&e,n=null==n||n,this.removeState(t),n&&(e||t!=this.currentRoot))for(var a=i.getChildCount(t),l=0;l<a;l++)this.clear(i.getChildAt(t,l),e);else this.invalidate(t)},mxGraphView.prototype.invalidate=function(t,e,n){var i=this.graph.getModel();t=t||i.getRoot(),e=null==e||e,n=null==n||n;var a=this.getState(t);if(null!=a&&(a.invalid=!0),!t.invalidating){if(t.invalidating=!0,e)for(var l=i.getChildCount(t),s=0;s<l;s++){var r=i.getChildAt(t,s);this.invalidate(r,e,n)}if(n){var o=i.getEdgeCount(t);for(s=0;s<o;s++)this.invalidate(i.getEdgeAt(t,s),e,n)}delete t.invalidating}},mxGraphView.prototype.validate=function(t){var e=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource,this.resetValidationState();var n=null;this.optimizeVmlReflows&&null!=this.canvas&&null==this.textDiv&&(n=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display="inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv));var i=this.getBoundingBox(this.validateCellState(this.validateCell(t||(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds(null!=i?i:this.getEmptyBounds()),this.validateBackground(),null!=n&&(this.canvas.style.display=n,this.textDiv.parentNode.removeChild(this.textDiv),this.textDiv=null),this.resetValidationState(),window.status=mxResources.get(this.doneResource)||this.doneResource,mxLog.leave("mxGraphView.validate",e)},mxGraphView.prototype.getEmptyBounds=function(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)},mxGraphView.prototype.getBoundingBox=function(t,e){e=null==e||e;var n=null;if(null!=t&&(null!=t.shape&&null!=t.shape.boundingBox&&(n=t.shape.boundingBox.clone()),null!=t.text&&null!=t.text.boundingBox&&(null!=n?n.add(t.text.boundingBox):n=t.text.boundingBox.clone()),e))for(var i=this.graph.getModel(),a=i.getChildCount(t.cell),l=0;l<a;l++){var s=this.getBoundingBox(this.getState(i.getChildAt(t.cell,l)));null!=s&&(null==n?n=s:n.add(s))}return n},mxGraphView.prototype.validateBackground=function(){},mxGraphView.prototype.validateCell=function(t,e){if(e=null==e||e,null!=t)if(e=e&&this.graph.isCellVisible(t),null==this.getState(t,e)||e)for(var n=this.graph.getModel(),i=n.getChildCount(t),a=0;a<i;a++)this.validateCell(n.getChildAt(t,a),e&&(!this.isCellCollapsed(t)||t==this.currentRoot));else this.removeState(t);return t},mxGraphView.prototype.validateCellState=function(t,e){e=null==e||e;var n=null;if(null!=t&&null!=(n=this.getState(t))){var i=this.graph.getModel();if(n.invalid&&(n.invalid=!1,(null==n.style||n.invalidStyle)&&(n.style=this.graph.getCellStyle(n.cell),n.invalidStyle=!1),t!=this.currentRoot&&this.validateCellState(i.getParent(t),!1),n.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),n.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(n),t==this.currentRoot||n.invalid||(this.graph.cellRenderer.redraw(n,!1,this.isRendering()),n.updateCachedBounds())),e&&!n.invalid){null!=n.shape&&this.stateValidated(n);for(var a=i.getChildCount(t),l=0;l<a;l++)this.validateCellState(i.getChildAt(t,l))}}return n},mxGraphView.prototype.updateCellState=function(t){if(t.absoluteOffset.x=0,t.absoluteOffset.y=0,t.origin.x=0,t.origin.y=0,t.length=0,t.cell!=this.currentRoot){var e=this.graph.getModel(),n=this.getState(e.getParent(t.cell));null!=n&&n.cell!=this.currentRoot&&(t.origin.x+=n.origin.x,t.origin.y+=n.origin.y);var i=this.graph.getChildOffsetForCell(t.cell);null!=i&&(t.origin.x+=i.x,t.origin.y+=i.y);var a=this.graph.getCellGeometry(t.cell);if(null!=a){if(!e.isEdge(t.cell))if(i=null!=a.offset?a.offset:this.EMPTY_POINT,a.relative&&null!=n)if(e.isEdge(n.cell)){var l=this.getPoint(n,a);null!=l&&(t.origin.x+=l.x/this.scale-n.origin.x-this.translate.x,t.origin.y+=l.y/this.scale-n.origin.y-this.translate.y)}else t.origin.x+=a.x*n.unscaledWidth+i.x,t.origin.y+=a.y*n.unscaledHeight+i.y;else t.absoluteOffset.x=this.scale*i.x,t.absoluteOffset.y=this.scale*i.y,t.origin.x+=a.x,t.origin.y+=a.y;t.x=this.scale*(this.translate.x+t.origin.x),t.y=this.scale*(this.translate.y+t.origin.y),t.width=this.scale*a.width,t.unscaledWidth=a.width,t.height=this.scale*a.height,t.unscaledHeight=a.height,e.isVertex(t.cell)&&this.updateVertexState(t,a),e.isEdge(t.cell)&&this.updateEdgeState(t,a)}}t.updateCachedBounds()},mxGraphView.prototype.isCellCollapsed=function(t){return this.graph.isCellCollapsed(t)},mxGraphView.prototype.updateVertexState=function(t,e){var n=this.graph.getModel(),i=this.getState(n.getParent(t.cell));if(e.relative&&null!=i&&!n.isEdge(i.cell)){var a=mxUtils.toRadians(i.style[mxConstants.STYLE_ROTATION]||"0");if(0!=a){var l=Math.cos(a),s=Math.sin(a),r=new mxPoint(t.getCenterX(),t.getCenterY()),o=new mxPoint(i.getCenterX(),i.getCenterY()),h=mxUtils.getRotatedPoint(r,l,s,o);t.x=h.x-t.width/2,t.y=h.y-t.height/2}}this.updateVertexLabelOffset(t)},mxGraphView.prototype.updateEdgeState=function(t,e){var n=t.getVisibleTerminalState(!0),i=t.getVisibleTerminalState(!1);if(null!=this.graph.model.getTerminal(t.cell,!0)&&null==n||null==n&&null==e.getTerminalPoint(!0)||null!=this.graph.model.getTerminal(t.cell,!1)&&null==i||null==i&&null==e.getTerminalPoint(!1))this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,n,i),this.updatePoints(t,e.points,n,i),this.updateFloatingTerminalPoints(t,n,i);var a=t.absolutePoints;t.cell!=this.currentRoot&&(null==a||a.length<2||null==a[0]||null==a[a.length-1])?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}},mxGraphView.prototype.updateVertexLabelOffset=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(e==mxConstants.ALIGN_LEFT)null!=(n=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_WIDTH,null))?n*=this.scale:n=t.width,t.absoluteOffset.x-=n;else if(e==mxConstants.ALIGN_RIGHT)t.absoluteOffset.x+=t.width;else if(e==mxConstants.ALIGN_CENTER){var n;if(null!=(n=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_WIDTH,null))){var i=mxUtils.getValue(t.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),a=0;i==mxConstants.ALIGN_CENTER?a=.5:i==mxConstants.ALIGN_RIGHT&&(a=1),0!=a&&(t.absoluteOffset.x-=(n*this.scale-t.width)*a)}}var l=mxUtils.getValue(t.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);l==mxConstants.ALIGN_TOP?t.absoluteOffset.y-=t.height:l==mxConstants.ALIGN_BOTTOM&&(t.absoluteOffset.y+=t.height)},mxGraphView.prototype.resetValidationState=function(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null},mxGraphView.prototype.stateValidated=function(t){var e=this.graph.getModel().isEdge(t.cell)&&this.graph.keepEdgesInForeground||this.graph.getModel().isVertex(t.cell)&&this.graph.keepEdgesInBackground,n=e&&this.lastForegroundHtmlNode||this.lastHtmlNode,i=e&&this.lastForegroundNode||this.lastNode,a=this.graph.cellRenderer.insertStateAfter(t,i,n);e?(this.lastForegroundHtmlNode=a[1],this.lastForegroundNode=a[0]):(this.lastHtmlNode=a[1],this.lastNode=a[0])},mxGraphView.prototype.updateFixedTerminalPoints=function(t,e,n){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,n,!1,this.graph.getConnectionConstraint(t,n,!1))},mxGraphView.prototype.updateFixedTerminalPoint=function(t,e,n,i){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,n,i),n)},mxGraphView.prototype.getFixedTerminalPoint=function(t,e,n,i){var a=null;if(null!=i&&(a=this.graph.getConnectionPoint(e,i,!1)),null==a&&null==e){var l=this.scale,s=this.translate,r=t.origin;null!=(a=this.graph.getCellGeometry(t.cell).getTerminalPoint(n))&&(a=new mxPoint(l*(s.x+a.x+r.x),l*(s.y+a.y+r.y)))}return a},mxGraphView.prototype.updateBoundsFromStencil=function(t){var e=null;if(null!=t&&null!=t.shape&&null!=t.shape.stencil&&"fixed"==t.shape.stencil.aspect){e=mxRectangle.fromRectangle(t);var n=t.shape.stencil.computeAspect(t.style,t.x,t.y,t.width,t.height);t.setRect(n.x,n.y,t.shape.stencil.w0*n.width,t.shape.stencil.h0*n.height)}return e},mxGraphView.prototype.updatePoints=function(t,e,n,i){if(null!=t){var a=[];a.push(t.absolutePoints[0]);var l=this.getEdgeStyle(t,e,n,i);if(null!=l){var s=this.getTerminalPort(t,n,!0),r=this.getTerminalPort(t,i,!1),o=this.updateBoundsFromStencil(s),h=this.updateBoundsFromStencil(r);l(t,s,r,e,a),null!=o&&s.setRect(o.x,o.y,o.width,o.height),null!=h&&r.setRect(h.x,h.y,h.width,h.height)}else if(null!=e)for(var u=0;u<e.length;u++)if(null!=e[u]){var p=mxUtils.clone(e[u]);a.push(this.transformControlPoint(t,p))}var d=t.absolutePoints;a.push(d[d.length-1]),t.absolutePoints=a}},mxGraphView.prototype.transformControlPoint=function(t,e,n){if(null!=t&&null!=e){var i=t.origin,a=n?1:this.scale;return new mxPoint(a*(e.x+this.translate.x+i.x),a*(e.y+this.translate.y+i.y))}return null},mxGraphView.prototype.isLoopStyleEnabled=function(t,e,n,i){var a=this.graph.getConnectionConstraint(t,n,!0),l=this.graph.getConnectionConstraint(t,i,!1);return!(!(null==e||e.length<2)||mxUtils.getValue(t.style,mxConstants.STYLE_ORTHOGONAL_LOOP,!1)&&(null!=a&&null!=a.point||null!=l&&null!=l.point))&&(null!=n&&n==i)},mxGraphView.prototype.getEdgeStyle=function(t,e,n,i){var a=this.isLoopStyleEnabled(t,e,n,i)?mxUtils.getValue(t.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):mxUtils.getValue(t.style,mxConstants.STYLE_NOEDGESTYLE,!1)?null:t.style[mxConstants.STYLE_EDGE];if("string"==typeof a){var l=mxStyleRegistry.getValue(a);null==l&&this.isAllowEval()&&(l=mxUtils.eval(a)),a=l}return"function"==typeof a?a:null},mxGraphView.prototype.updateFloatingTerminalPoints=function(t,e,n){var i=t.absolutePoints,a=i[0];null==i[i.length-1]&&null!=n&&this.updateFloatingTerminalPoint(t,n,e,!1),null==a&&null!=e&&this.updateFloatingTerminalPoint(t,e,n,!0)},mxGraphView.prototype.updateFloatingTerminalPoint=function(t,e,n,i){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,n,i),i)},mxGraphView.prototype.getFloatingTerminalPoint=function(t,e,n,i){e=this.getTerminalPort(t,e,i);var a=this.getNextPoint(t,n,i),l=this.graph.isOrthogonal(t),s=mxUtils.toRadians(Number(e.style[mxConstants.STYLE_ROTATION]||"0")),r=new mxPoint(e.getCenterX(),e.getCenterY());if(0!=s){var o=Math.cos(-s),h=Math.sin(-s);a=mxUtils.getRotatedPoint(a,o,h,r)}var u=parseFloat(t.style[mxConstants.STYLE_PERIMETER_SPACING]||0);u+=parseFloat(t.style[i?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);var p=this.getPerimeterPoint(e,a,0==s&&l,u);if(0!=s){o=Math.cos(s),h=Math.sin(s);p=mxUtils.getRotatedPoint(p,o,h,r)}return p},mxGraphView.prototype.getTerminalPort=function(t,e,n){var i=n?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,a=mxUtils.getValue(t.style,i);if(null!=a){var l=this.getState(this.graph.getModel().getCell(a));null!=l&&(e=l)}return e},mxGraphView.prototype.getPerimeterPoint=function(t,e,n,i){var a=null;if(null!=t){var l=this.getPerimeterFunction(t);if(null!=l&&null!=e){var s=this.getPerimeterBounds(t,i);if(s.width>0||s.height>0){a=new mxPoint(e.x,e.y);var r=!1,o=!1;this.graph.model.isVertex(t.cell)&&(r=1==mxUtils.getValue(t.style,mxConstants.STYLE_FLIPH,0),o=1==mxUtils.getValue(t.style,mxConstants.STYLE_FLIPV,0),null!=t.shape&&null!=t.shape.stencil&&(r=1==mxUtils.getValue(t.style,"stencilFlipH",0)||r,o=1==mxUtils.getValue(t.style,"stencilFlipV",0)||o),r&&(a.x=2*s.getCenterX()-a.x),o&&(a.y=2*s.getCenterY()-a.y)),null!=(a=l(s,t,a,n))&&(r&&(a.x=2*s.getCenterX()-a.x),o&&(a.y=2*s.getCenterY()-a.y))}}null==a&&(a=this.getPoint(t))}return a},mxGraphView.prototype.getRoutingCenterX=function(t){var e=null!=t.style&&parseFloat(t.style[mxConstants.STYLE_ROUTING_CENTER_X])||0;return t.getCenterX()+e*t.width},mxGraphView.prototype.getRoutingCenterY=function(t){var e=null!=t.style&&parseFloat(t.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0;return t.getCenterY()+e*t.height},mxGraphView.prototype.getPerimeterBounds=function(t,e){return e=null!=e?e:0,null!=t&&(e+=parseFloat(t.style[mxConstants.STYLE_PERIMETER_SPACING]||0)),t.getPerimeterBounds(e*this.scale)},mxGraphView.prototype.getPerimeterFunction=function(t){var e=t.style[mxConstants.STYLE_PERIMETER];if("string"==typeof e){var n=mxStyleRegistry.getValue(e);null==n&&this.isAllowEval()&&(n=mxUtils.eval(e)),e=n}return"function"==typeof e?e:null},mxGraphView.prototype.getNextPoint=function(t,e,n){var i=t.absolutePoints,a=null;if(null!=i&&i.length>=2){var l=i.length;a=i[n?Math.min(1,l-1):Math.max(0,l-2)]}return null==a&&null!=e&&(a=new mxPoint(e.getCenterX(),e.getCenterY())),a},mxGraphView.prototype.getVisibleTerminal=function(t,e){for(var n=this.graph.getModel(),i=n.getTerminal(t,e),a=i;null!=i&&i!=this.currentRoot;)this.graph.isCellVisible(a)&&!this.isCellCollapsed(i)||(a=i),i=n.getParent(i);return null==a||n.contains(a)&&n.getParent(a)!=n.getRoot()&&a!=this.currentRoot||(a=null),a},mxGraphView.prototype.updateEdgeBounds=function(t){var e=t.absolutePoints,n=e[0],i=e[e.length-1];if(n.x!=i.x||n.y!=i.y){var a=i.x-n.x,l=i.y-n.y;t.terminalDistance=Math.sqrt(a*a+l*l)}else t.terminalDistance=0;var s=0,r=[],o=n;if(null!=o){for(var h=o.x,u=o.y,p=h,d=u,g=1;g<e.length;g++){var c=e[g];if(null!=c){a=o.x-c.x,l=o.y-c.y;var x=Math.sqrt(a*a+l*l);r.push(x),s+=x,o=c,h=Math.min(o.x,h),u=Math.min(o.y,u),p=Math.max(o.x,p),d=Math.max(o.y,d)}}t.length=s,t.segments=r;t.x=h,t.y=u,t.width=Math.max(1,p-h),t.height=Math.max(1,d-u)}},mxGraphView.prototype.getPoint=function(t,e){var n=t.getCenterX(),i=t.getCenterY();if(null==t.segments||null!=e&&!e.relative){if(null!=e){null!=(g=e.offset)&&(n+=g.x,i+=g.y)}}else{for(var a=null!=e?e.x/2:0,l=t.absolutePoints.length,s=Math.round((a+.5)*t.length),r=t.segments[0],o=0,h=1;s>=Math.round(o+r)&&h<l-1;)o+=r,r=t.segments[h++];var u=0==r?0:(s-o)/r,p=t.absolutePoints[h-1],d=t.absolutePoints[h];if(null!=p&&null!=d){var g,c=0,x=0,m=0;if(null!=e)c=e.y,null!=(g=e.offset)&&(x=g.x,m=g.y);var v=d.x-p.x,y=d.y-p.y,f=0==r?0:y/r,w=0==r?0:v/r;n=p.x+v*u+(f*c+x)*this.scale,i=p.y+y*u-(w*c-m)*this.scale}}return new mxPoint(n,i)},mxGraphView.prototype.getRelativePoint=function(t,e,n){var i=this.graph.getModel().getGeometry(t.cell);if(null!=i){var a=t.absolutePoints.length;if(i.relative&&a>1){for(var l=t.length,s=t.segments,r=t.absolutePoints[0],o=t.absolutePoints[1],h=mxUtils.ptSegDistSq(r.x,r.y,o.x,o.y,e,n),u=0,p=0,d=0,g=2;g<a;g++){p+=s[g-2],o=t.absolutePoints[g];var c=mxUtils.ptSegDistSq(r.x,r.y,o.x,o.y,e,n);c<=h&&(h=c,u=g-1,d=p),r=o}var x=s[u];r=t.absolutePoints[u],o=t.absolutePoints[u+1];var m=r.x,v=r.y,y=o.x,f=o.y,w=e,C=n,E=m-y,P=v-f,V=0,G=(w=E-(w-=y))*E+(C=P-(C-=f))*P;V=G<=0?0:G*G/(E*E+P*P);var S=Math.sqrt(V);S>x&&(S=x);var T=Math.sqrt(mxUtils.ptSegDistSq(r.x,r.y,o.x,o.y,e,n));return-1==mxUtils.relativeCcw(r.x,r.y,o.x,o.y,e,n)&&(T=-T),new mxPoint((l/2-d-S)/l*-2,T/this.scale)}}return new mxPoint},mxGraphView.prototype.updateEdgeLabelOffset=function(t){var e=t.absolutePoints;if(t.absoluteOffset.x=t.getCenterX(),t.absoluteOffset.y=t.getCenterY(),null!=e&&e.length>0&&null!=t.segments){var n=this.graph.getCellGeometry(t.cell);if(n.relative){var i=this.getPoint(t,n);null!=i&&(t.absoluteOffset=i)}else{var a=e[0],l=e[e.length-1];if(null!=a&&null!=l){var s=l.x-a.x,r=l.y-a.y,o=0,h=0,u=n.offset;null!=u&&(o=u.x,h=u.y);var p=a.x+s/2+o*this.scale,d=a.y+r/2+h*this.scale;t.absoluteOffset.x=p,t.absoluteOffset.y=d}}}},mxGraphView.prototype.getState=function(t,e){e=e||!1;var n=null;return null!=t&&(n=this.states.get(t),e&&(null==n||this.updateStyle)&&this.graph.isCellVisible(t)&&(null==n?(n=this.createState(t),this.states.put(t,n)):n.style=this.graph.getCellStyle(t))),n},mxGraphView.prototype.isRendering=function(){return this.rendering},mxGraphView.prototype.setRendering=function(t){this.rendering=t},mxGraphView.prototype.isAllowEval=function(){return this.allowEval},mxGraphView.prototype.setAllowEval=function(t){this.allowEval=t},mxGraphView.prototype.getStates=function(){return this.states},mxGraphView.prototype.setStates=function(t){this.states=t},mxGraphView.prototype.getCellStates=function(t){if(null==t)return this.states;for(var e=[],n=0;n<t.length;n++){var i=this.getState(t[n]);null!=i&&e.push(i)}return e},mxGraphView.prototype.removeState=function(t){var e=null;return null!=t&&null!=(e=this.states.remove(t))&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy()),e},mxGraphView.prototype.createState=function(t){return new mxCellState(this,t,this.graph.getCellStyle(t))},mxGraphView.prototype.getCanvas=function(){return this.canvas},mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane},mxGraphView.prototype.getDrawPane=function(){return this.drawPane},mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane},mxGraphView.prototype.getDecoratorPane=function(){return this.decoratorPane},mxGraphView.prototype.isContainerEvent=function(t){var e=mxEvent.getSource(t);return e==this.graph.container||e.parentNode==this.backgroundPane||null!=e.parentNode&&e.parentNode.parentNode==this.backgroundPane||e==this.canvas.parentNode||e==this.canvas||e==this.backgroundPane||e==this.drawPane||e==this.overlayPane||e==this.decoratorPane},mxGraphView.prototype.isScrollEvent=function(t){var e=mxUtils.getOffset(this.graph.container),n=new mxPoint(t.clientX-e.x,t.clientY-e.y),i=this.graph.container.offsetWidth,a=this.graph.container.clientWidth;if(i>a&&n.x>a+2&&n.x<=i)return!0;var l=this.graph.container.offsetHeight,s=this.graph.container.clientHeight;return l>s&&n.y>s+2&&n.y<=l},mxGraphView.prototype.init=function(){this.installListeners();var t=this.graph;t.dialect==mxConstants.DIALECT_SVG?this.createSvg():t.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()},mxGraphView.prototype.installListeners=function(){var t=this.graph,e=t.container;null!=e&&(mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){!this.isContainerEvent(e)||(GE.IS_IE11||GE.IS_GC||GE.IS_OP||GE.IS_SF)&&this.isScrollEvent(e)||t.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(e))}),mxUtils.bind(this,function(e){this.isContainerEvent(e)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(e))}),mxUtils.bind(this,function(e){this.isContainerEvent(e)&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(e))})),mxEvent.addListener(e,"dblclick",mxUtils.bind(this,function(e){this.isContainerEvent(e)&&t.dblClick(e)})),t.addMouseListener({mouseDown:function(e,n){t.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}}),this.moveHandler=mxUtils.bind(this,function(e){null!=t.tooltipHandler&&t.tooltipHandler.isHideOnHover()&&t.tooltipHandler.hide(),this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!=t.container.style.display&&"hidden"!=t.container.style.visibility&&!mxEvent.isConsumed(e)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(e))}),this.endHandler=mxUtils.bind(this,function(e){this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!=t.container.style.display&&"hidden"!=t.container.style.visibility&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(e))}),mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler))},mxGraphView.prototype.createHtml=function(){var t=this.graph.container;null!=t&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t))},mxGraphView.prototype.updateHtmlCanvasSize=function(t,e){if(null!=this.graph.container){var n=this.graph.container.offsetWidth,i=this.graph.container.offsetHeight;this.canvas.style.width=n<t?t+"px":"100%",this.canvas.style.height=i<e?e+"px":"100%"}},mxGraphView.prototype.createHtmlPane=function(t,e){var n=document.createElement("DIV");return null!=t&&null!=e?(n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.width=t,n.style.height=e):n.style.position="relative",n},mxGraphView.prototype.createVml=function(){var t=this.graph.container;if(null!=t){var e=t.offsetWidth,n=t.offsetHeight;this.canvas=this.createVmlPane(e,n),this.canvas.style.overflow="hidden",this.backgroundPane=this.createVmlPane(e,n),this.drawPane=this.createVmlPane(e,n),this.overlayPane=this.createVmlPane(e,n),this.decoratorPane=this.createVmlPane(e,n),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas)}},mxGraphView.prototype.createVmlPane=function(t,e){var n=document.createElement(GE.VML_PREFIX+":group");return n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.width=t+"px",n.style.height=e+"px",n.setAttribute("coordsize",t+","+e),n.setAttribute("coordorigin","0,0"),n},mxGraphView.prototype.createSvg=function(){var t=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g"),this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.drawPane),this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.decoratorPane);var e=document.createElementNS(mxConstants.NS_SVG,"svg");e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%",e.style.display="block",e.appendChild(this.canvas),GE.IS_IE11&&(e.style.overflow="hidden"),null!=t&&(t.appendChild(e),this.updateContainerStyle(t))},mxGraphView.prototype.updateContainerStyle=function(t){var e=mxUtils.getCurrentStyle(t);null!=e&&"static"==e.position&&(t.style.position="relative"),GE.IS_POINTER&&(t.style.touchAction="none")},mxGraphView.prototype.destroy=function(){var t=null!=this.canvas?this.canvas.ownerSVGElement:null;null==t&&(t=this.canvas),null!=t&&null!=t.parentNode&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)},mxCurrentRootChange.prototype.execute=function(){var t=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=t;var e=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=e&&(this.view.translate=new mxPoint(-e.x,-e.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();var n=this.isUp?mxEvent.UP:mxEvent.DOWN;this.view.fireEvent(new mxEventObject(n,"root",this.view.currentRoot,"previous",this.previous)),this.isUp=!this.isUp};