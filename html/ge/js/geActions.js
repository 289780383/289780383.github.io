GE.Actions=function(t){this.editorUi=t,this.actions=new Object,this.init()},GE.Actions.prototype.init=function(){var t=this.editorUi,e=t.editor,n=e.graph,l=function(){return GE.Action.prototype.isEnabled.apply(this,arguments)&&n.isEnabled()};function i(t){n.escape();var e=n.deleteCells(n.getDeletableCells(n.getSelectionCells()),t);null!=e&&n.setSelectionCells(e)}this.addAction("import...",function(){window.openNew=!1,window.openKey="import",window.openFile=new GE.OpenFile(mxUtils.bind(this,function(){t.hideDialog()})),window.openFile.setConsumer(mxUtils.bind(this,function(t,n){try{var l=mxUtils.parseXml(t).documentElement,i=l.getAttribute("background");null!=i&&i.length>0?e.graph.background=i:e.graph.background=null,e.graph.getModel().clear(),e.graph.setSelectionCells(e.graph.importGraphModel(l))}catch(t){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+t.message)}})),t.showDialog(new GE.OpenDialog(this).container,320,220,!0,!0,function(){window.openFile=null})}).isEnabled=l,this.addAction("save",function(){if(t.save){var n=mxUtils.getXml(e.getGraphXml());t.save(n,!1)}},null,null,GE.Editor.ctrlKey+"+S").isEnabled=l,this.addAction("saveAndReturn",function(){if(t.save){var n=mxUtils.getXml(e.getGraphXml());t.save(n,!0)}},null,null,GE.Editor.ctrlKey+"+Shift+S").isEnabled=l,this.addAction("export...",function(){t.showDialog(new GE.ExportDialog(t).container,300,100,!0,!0)}),this.addAction("editDiagram...",function(){var e=new GE.EditDiagramDialog(t);t.showDialog(e.container,620,420,!0,!1),e.init()}),this.addAction("version...",function(){var e=new GE.VersionDialog(t);t.showDialog(e.container,620,420,!0,!1),e.init()}),this.addAction("nosaveAndReturn",function(){t.save&&t.save(null,!0)},null,null,GE.Editor.ctrlKey+"+Q"),this.addAction("undo",function(){t.undo()},null,"sprite-undo",GE.Editor.ctrlKey+"+Z"),this.addAction("redo",function(){t.redo()},null,"sprite-redo",GE.IS_WIN?GE.Editor.ctrlKey+"+Y":GE.Editor.ctrlKey+"+Shift+Z"),this.addAction("cut",function(){mxClipboard.cut(n)},null,"sprite-cut",GE.Editor.ctrlKey+"+X"),this.addAction("copy",function(){try{mxClipboard.copy(n)}catch(e){t.handleError(e)}},null,"sprite-copy",GE.Editor.ctrlKey+"+C"),this.addAction("paste",function(){n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())&&mxClipboard.paste(n)},!1,"sprite-paste",GE.Editor.ctrlKey+"+V"),this.addAction("pasteHere",function(t){if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){n.getModel().beginUpdate();try{var e=mxClipboard.paste(n);if(null!=e){for(var l=!0,i=0;i<e.length&&l;i++)l=l&&n.model.isEdge(e[i]);var o=n.view.translate,s=n.view.scale,a=o.x,d=o.y,c=null;if(1==e.length&&l){var r=n.getCellGeometry(e[0]);null!=r&&(c=r.getTerminalPoint(!0))}if(null!=(c=null!=c?c:n.getBoundingBoxFromGeometry(e,l))){var u=Math.round(n.snap(n.popupMenuHandler.triggerX/s-a)),g=Math.round(n.snap(n.popupMenuHandler.triggerY/s-d));n.cellsMoved(e,u-c.x,g-c.y)}}}finally{n.getModel().endUpdate()}}}),this.addAction("copySize",function(e){var l=n.getSelectionCell();if(n.isEnabled()&&null!=l&&n.getModel().isVertex(l)){var i=n.getCellGeometry(l);null!=i&&(t.copiedSize=new mxRectangle(i.x,i.y,i.width,i.height))}},null,null,"Alt+Shift+X"),this.addAction("pasteSize",function(e){if(n.isEnabled()&&!n.isSelectionEmpty()&&null!=t.copiedSize){n.getModel().beginUpdate();try{for(var l=n.getSelectionCells(),i=0;i<l.length;i++)if(n.getModel().isVertex(l[i])){var o=n.getCellGeometry(l[i]);null!=o&&((o=o.clone()).width=t.copiedSize.width,o.height=t.copiedSize.height,n.getModel().setGeometry(l[i],o))}}finally{n.getModel().endUpdate()}}},null,null,"Alt+Shift+V"),this.addAction("delete",function(t){i(null!=t&&mxEvent.isShiftDown(t))},null,null,"Delete"),this.addAction("deleteAll",function(){i(!0)},null,null,GE.Editor.ctrlKey+"+Delete"),this.addAction("duplicate",function(){try{n.setSelectionCells(n.duplicateCells())}catch(e){t.handleError(e)}},null,null,GE.Editor.ctrlKey+"+D"),this.put("turn",new GE.Action(mxResources.get("turn")+" / "+mxResources.get("reverse"),function(t){n.turnShapes(n.getSelectionCells(),null!=t&&mxEvent.isShiftDown(t))},null,null,GE.Editor.ctrlKey+"+R")),this.addAction("selectVertices",function(){n.selectVertices(null,!0)},null,null,GE.Editor.ctrlKey+"+Shift+I"),this.addAction("selectEdges",function(){n.selectEdges()},null,null,GE.Editor.ctrlKey+"+Shift+E"),this.addAction("selectAll",function(){n.selectAll(null,!0)},null,null,GE.Editor.ctrlKey+"+A"),this.addAction("selectNone",function(){n.clearSelection()},null,null,GE.Editor.ctrlKey+"+Shift+A"),this.addAction("lockUnlock",function(){if(!n.isSelectionEmpty()){n.getModel().beginUpdate();try{var t=n.isCellMovable(n.getSelectionCell())?1:0;n.toggleCellStyles(mxConstants.STYLE_MOVABLE,t),n.toggleCellStyles(mxConstants.STYLE_RESIZABLE,t),n.toggleCellStyles(mxConstants.STYLE_ROTATABLE,t),n.toggleCellStyles(mxConstants.STYLE_DELETABLE,t),n.toggleCellStyles(mxConstants.STYLE_EDITABLE,t),n.toggleCellStyles("connectable",t)}finally{n.getModel().endUpdate()}}},null,null,GE.Editor.ctrlKey+"+L"),this.addAction("home",function(){n.home()},null,null,"Shift+Home"),this.addAction("exitGroup",function(){n.exitGroup()},null,null,GE.Editor.ctrlKey+"+Shift+Home"),this.addAction("enterGroup",function(){n.enterGroup()},null,null,GE.Editor.ctrlKey+"+Shift+End"),this.addAction("collapse",function(){n.foldCells(!0)},null,null,GE.Editor.ctrlKey+"+Home"),this.addAction("expand",function(){n.foldCells(!1)},null,null,GE.Editor.ctrlKey+"+End"),this.addAction("toFront",function(){n.orderCells(!1)},null,null,GE.Editor.ctrlKey+"+Shift+F"),this.addAction("toBack",function(){n.orderCells(!0)},null,null,GE.Editor.ctrlKey+"+Shift+B"),this.addAction("group",function(){1==n.getSelectionCount()?n.setCellStyles("container","1"):n.setSelectionCell(n.groupCells(null,0))},null,null,GE.Editor.ctrlKey+"+G"),this.addAction("ungroup",function(){1==n.getSelectionCount()&&0==n.getModel().getChildCount(n.getSelectionCell())?n.setCellStyles("container","0"):n.setSelectionCells(n.ungroupCells())},null,null,GE.Editor.ctrlKey+"+Shift+U"),this.addAction("removeFromGroup",function(){n.removeCellsFromParent()}),this.addAction("edit",function(){n.isEnabled()&&n.startEditingAtCell()},null,null,"F2/Enter"),this.addAction("bindProperties...",function(){var e=n.getSelectionCell()||n.getModel().getRoot();e.isSub&&(e=n.getModel().getParent(e)),t.bindProperties?t.bindProperties(e):console.log("GE没有注册bindProperties接口")},null,null,GE.Editor.ctrlKey+"+M"),this.put("insertImage",new GE.Action(mxResources.get("image")+"...",function(){n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())&&(n.clearSelection(),t.actions.get("image").funct())})).isEnabled=l,this.addAction("autosize",function(){var t=n.getSelectionCells();if(null!=t){n.getModel().beginUpdate();try{for(var e=0;e<t.length;e++){var l=t[e];if(n.getModel().getChildCount(l))n.updateGroupBounds([l],20);else{var i=n.view.getState(l),o=n.getCellGeometry(l);n.getModel().isVertex(l)&&null!=i&&null!=i.text&&null!=o&&n.isWrapping(l)?((o=o.clone()).height=i.text.boundingBox.height/n.view.scale,n.getModel().setGeometry(l,o)):n.updateCellSize(l)}}}finally{n.getModel().endUpdate()}}},null,null,GE.Editor.ctrlKey+"+Shift+Y"),this.addAction("formattedText",function(){var e=n.getView().getState(n.getSelectionCell());if(null!=e){n.stopEditing();var l="1"==e.style.html?null:"1";n.getModel().beginUpdate();try{for(var i=n.getSelectionCells(),o=0;o<i.length;o++)if(state=n.getView().getState(i[o]),null!=state){var s=mxUtils.getValue(state.style,"html","0");if("1"==s&&null==l){var a=n.convertValueToString(state.cell);"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(a=a.replace(/\n/g,"").replace(/<br\s*.?>/g,"\n"));var d=document.createElement("div");d.innerHTML=n.sanitizeHtml(a),a=mxUtils.extractTextWithWhitespace(d.childNodes),n.cellLabelChanged(state.cell,a),n.setCellStyles("html",l,[i[o]])}else if("0"==s&&"1"==l){a=mxUtils.htmlEntities(n.convertValueToString(state.cell),!1);"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(a=a.replace(/\n/g,"<br/>")),n.cellLabelChanged(state.cell,n.sanitizeHtml(a)),n.setCellStyles("html",l,[i[o]])}}t.fireEvent(new mxEventObject("styleChanged","keys",["html"],"values",[null!=l?l:"0"],"cells",i))}finally{n.getModel().endUpdate()}}}),this.addAction("wordWrap",function(){var t=n.getView().getState(n.getSelectionCell()),e="wrap";n.stopEditing(),null!=t&&"wrap"==t.style[mxConstants.STYLE_WHITE_SPACE]&&(e=null),n.setCellStyles(mxConstants.STYLE_WHITE_SPACE,e)}),this.addAction("rotation",function(){var e="0",l=n.getView().getState(n.getSelectionCell());null!=l&&(e=l.style[mxConstants.STYLE_ROTATION]||e);var i=new GE.FilenameDialog(t,e,mxResources.get("apply"),function(t){null!=t&&t.length>0&&n.setCellStyles(mxConstants.STYLE_ROTATION,t)},mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)");t.showDialog(i.container,375,80,!0,!0),i.init()}),this.addAction("resetView",function(){n.zoomTo(1),t.resetScrollbars()},null,null,"Home"),this.addAction("zoomIn",function(e){n.isFastZoomEnabled()?n.lazyZoom(!0,!0,t.buttonZoomDelay):n.zoomIn()},null,null,GE.Editor.ctrlKey+" + (Numpad) / Alt+Mousewheel"),this.addAction("zoomOut",function(e){n.isFastZoomEnabled()?n.lazyZoom(!1,!0,t.buttonZoomDelay):n.zoomOut()},null,null,GE.Editor.ctrlKey+" - (Numpad) / Alt+Mousewheel"),this.addAction("fitWindow",function(){var t=n.isSelectionEmpty()?n.getGraphBounds():n.getBoundingBox(n.getSelectionCells()),e=n.view.translate,l=n.view.scale;t.width/=l,t.height/=l,t.x=t.x/l-e.x,t.y=t.y/l-e.y;var i=n.container.clientWidth-10,o=n.container.clientHeight-10,s=Math.floor(20*Math.min(i/t.width,o/t.height))/20;n.zoomTo(s),mxUtils.hasScrollbars(n.container)&&(n.container.scrollTop=(t.y+e.y)*s-Math.max((o-t.height*s)/2+5,0),n.container.scrollLeft=(t.x+e.x)*s-Math.max((i-t.width*s)/2+5,0))},null,null,GE.Editor.ctrlKey+"+Shift+H"),this.addAction("fitPage",mxUtils.bind(this,function(){var t=n.pageFormat,e=n.pageScale,l=n.container.clientWidth-10,i=n.container.clientHeight-10,o=Math.floor(20*Math.min(l/t.width/e,i/t.height/e))/20;if(n.zoomTo(o),mxUtils.hasScrollbars(n.container)){var s=n.getPagePadding();n.container.scrollTop=s.y*n.view.scale-1,n.container.scrollLeft=Math.min(s.x*n.view.scale,(n.container.scrollWidth-n.container.clientWidth)/2)-1}}),null,null,GE.Editor.ctrlKey+"+J"),this.addAction("fitTwoPages",mxUtils.bind(this,function(){var t=n.pageFormat,e=n.pageScale,l=n.container.clientWidth-10,i=n.container.clientHeight-10,o=Math.floor(20*Math.min(l/(2*t.width)/e,i/t.height/e))/20;if(n.zoomTo(o),mxUtils.hasScrollbars(n.container)){var s=n.getPagePadding();n.container.scrollTop=Math.min(s.y,(n.container.scrollHeight-n.container.clientHeight)/2),n.container.scrollLeft=Math.min(s.x,(n.container.scrollWidth-n.container.clientWidth)/2)}}),null,null,GE.Editor.ctrlKey+"+Shift+J"),this.addAction("fitPageWidth",mxUtils.bind(this,function(){var t=n.pageFormat,e=n.pageScale,l=n.container.clientWidth-10,i=Math.floor(20*l/t.width/e)/20;if(n.zoomTo(i),mxUtils.hasScrollbars(n.container)){var o=n.getPagePadding();n.container.scrollLeft=Math.min(o.x*n.view.scale,(n.container.scrollWidth-n.container.clientWidth)/2)}})),this.put("customZoom",new GE.Action(mxResources.get("custom")+"...",mxUtils.bind(this,function(){var t=new GE.FilenameDialog(this.editorUi,parseInt(100*n.getView().getScale()),mxResources.get("apply"),mxUtils.bind(this,function(t){var e=parseInt(t);!isNaN(e)&&e>0&&n.zoomTo(e/100)}),mxResources.get("zoom")+" (%)");this.editorUi.showDialog(t.container,300,80,!0,!0),t.init()}),null,null,GE.Editor.ctrlKey+"+0")),this.addAction("pageScale...",mxUtils.bind(this,function(){var e=new GE.FilenameDialog(this.editorUi,parseInt(100*n.pageScale),mxResources.get("apply"),mxUtils.bind(this,function(e){var l=parseInt(e);if(!isNaN(l)&&l>0){var i=new ChangePageSetup(t,null,null,null,l/100);i.ignoreColor=!0,i.ignoreImage=!0,n.model.execute(i)}}),mxResources.get("pageScale")+" (%)");this.editorUi.showDialog(e.container,300,80,!0,!0),e.init()}));var o=null;(o=this.addAction("grid",function(){n.setGridEnabled(!n.isGridEnabled()),t.fireEvent(new mxEventObject("gridEnabledChanged"))},null,null,GE.Editor.ctrlKey+"+Shift+G")).setToggleAction(!0),o.setSelectedCallback(function(){return n.isGridEnabled()}),o.setEnabled(!1),(o=this.addAction("guides",function(){n.graphHandler.guidesEnabled=!n.graphHandler.guidesEnabled,t.fireEvent(new mxEventObject("guidesEnabledChanged"))})).setToggleAction(!0),o.setSelectedCallback(function(){return n.graphHandler.guidesEnabled}),o.setEnabled(!1),(o=this.addAction("tooltips",function(){n.tooltipHandler.setEnabled(!n.tooltipHandler.isEnabled())})).setToggleAction(!0),o.setSelectedCallback(function(){return n.tooltipHandler.isEnabled()}),(o=this.addAction("collapseExpand",function(){var e=new ChangePageSetup(t);e.ignoreColor=!0,e.ignoreImage=!0,e.foldingEnabled=!n.foldingEnabled,n.model.execute(e)})).setToggleAction(!0),o.setSelectedCallback(function(){return n.foldingEnabled}),o.isEnabled=l,(o=this.addAction("scrollbars",function(){t.setScrollbars(!t.hasScrollbars())})).setToggleAction(!0),o.setSelectedCallback(function(){return n.scrollbars}),(o=this.addAction("splitWay",function(){n.splitEnabled=!n.splitEnabled,t.fireEvent(new mxEventObject("splitWayChanged"))},null,null,null)).setToggleAction(!0),o.setSelectedCallback(function(){return n.splitEnabled}),(o=this.addAction("connectionArrows",function(){n.connectionArrowsEnabled=!n.connectionArrowsEnabled,t.fireEvent(new mxEventObject("connectionArrowsChanged"))},null,null,"Alt+Shift+A")).setToggleAction(!0),o.setSelectedCallback(function(){return n.connectionArrowsEnabled}),(o=this.addAction("connectionPoints",function(){n.setConnectable(!n.connectionHandler.isEnabled()),t.fireEvent(new mxEventObject("connectionPointsChanged"))},null,null,"Alt+Shift+P")).setToggleAction(!0),o.setSelectedCallback(function(){return n.connectionHandler.isEnabled()}),(o=this.addAction("copyConnect",function(){n.connectionHandler.setCreateTarget(!n.connectionHandler.isCreateTarget()),t.fireEvent(new mxEventObject("copyConnectChanged"))})).setToggleAction(!0),o.setSelectedCallback(function(){return n.connectionHandler.isCreateTarget()}),o.isEnabled=l,(o=this.addAction("autosave",function(){t.editor.setAutosave(!t.editor.autosave)})).setToggleAction(!0),o.setSelectedCallback(function(){return t.editor.autosave}),o.isEnabled=l,o.visible=!1;var s=mxUtils.bind(this,function(t,e,l,i){return this.addAction(t,function(){if(null!=l&&n.cellEditor.isContentEditing())l();else{n.stopEditing(!1),n.getModel().beginUpdate();try{var t=n.getSelectionCells();n.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,e,t),(e&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?n.updateLabelElements(n.getSelectionCells(),function(t){t.style.fontWeight=null,"B"==t.nodeName&&n.replaceElement(t)}):(e&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?n.updateLabelElements(n.getSelectionCells(),function(t){t.style.fontStyle=null,"I"==t.nodeName&&n.replaceElement(t)}):(e&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&n.updateLabelElements(n.getSelectionCells(),function(t){t.style.textDecoration=null,"U"==t.nodeName&&n.replaceElement(t)});for(var i=0;i<t.length;i++)0==n.model.getChildCount(t[i])&&n.autoSizeCell(t[i],!1)}finally{n.getModel().endUpdate()}}},null,null,i)});s("bold",mxConstants.FONT_BOLD,function(){document.execCommand("bold",!1,null)},GE.Editor.ctrlKey+"+B"),s("italic",mxConstants.FONT_ITALIC,function(){document.execCommand("italic",!1,null)},GE.Editor.ctrlKey+"+I"),s("underline",mxConstants.FONT_UNDERLINE,function(){document.execCommand("underline",!1,null)},GE.Editor.ctrlKey+"+U"),this.addAction("fontColor...",function(){t.menus.pickColor(mxConstants.STYLE_FONTCOLOR,"forecolor","000000")}),this.addAction("strokeColor...",function(){t.menus.pickColor(mxConstants.STYLE_STROKECOLOR)}),this.addAction("fillColor...",function(){t.menus.pickColor(mxConstants.STYLE_FILLCOLOR)}),this.addAction("gradientColor...",function(){t.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)}),this.addAction("backgroundColor...",function(){t.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"backcolor")}),this.addAction("borderColor...",function(){t.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)}),this.addAction("vertical",function(){t.menus.toggleStyle(mxConstants.STYLE_HORIZONTAL,!0)}),this.addAction("shadow",function(){t.menus.toggleStyle(mxConstants.STYLE_SHADOW)}),this.addAction("solid",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_DASHED,null),n.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",[null,null],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("dashed",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_DASHED,"1"),n.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1",null],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("dotted",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_DASHED,"1"),n.setCellStyles(mxConstants.STYLE_DASH_PATTERN,"1 4"),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1","1 4"],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("sharp",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),n.setCellStyles(mxConstants.STYLE_CURVED,"0"),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","0"],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("rounded",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_ROUNDED,"1"),n.setCellStyles(mxConstants.STYLE_CURVED,"0"),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["1","0"],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("toggleRounded",function(){if(!n.isSelectionEmpty()&&n.isEnabled()){n.getModel().beginUpdate();try{var e=n.getSelectionCells(),l=n.getCurrentCellStyle(e[0]),i="1"==mxUtils.getValue(l,mxConstants.STYLE_ROUNDED,"0")?"0":"1";n.setCellStyles(mxConstants.STYLE_ROUNDED,i),n.setCellStyles(mxConstants.STYLE_CURVED,null),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",[i,"0"],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}}),this.addAction("curved",function(){n.getModel().beginUpdate();try{n.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),n.setCellStyles(mxConstants.STYLE_CURVED,"1"),t.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","1"],"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}}),this.addAction("collapsible",function(){var e=n.view.getState(n.getSelectionCell()),l="1";null!=e&&null!=n.getFoldingImage(e)&&(l="0"),n.setCellStyles("collapsible",l),t.fireEvent(new mxEventObject("styleChanged","keys",["collapsible"],"values",[l],"cells",n.getSelectionCells()))}),this.addAction("editStyle...",mxUtils.bind(this,function(){var t=n.getSelectionCells();if(null!=t&&t.length>0){var e=n.getModel(),l=new GE.TextareaDialog(this.editorUi,mxResources.get("editStyle")+":",e.getStyle(t[0])||"",function(e){null!=e&&n.setCellStyle(mxUtils.trim(e),t)},null,null,400,220);this.editorUi.showDialog(l.container,420,300,!0,!0),l.init()}}),null,null,GE.Editor.ctrlKey+"+E"),this.addAction("setAsDefaultStyle",function(){n.isEnabled()&&!n.isSelectionEmpty()&&t.setDefaultStyle(n.getSelectionCell())},null,null,GE.Editor.ctrlKey+"+Shift+D"),this.addAction("clearDefaultStyle",function(){n.isEnabled()&&t.clearDefaultStyle()},null,null,GE.Editor.ctrlKey+"+Shift+R"),this.addAction("addWaypoint",function(){var t=n.getSelectionCell();if(null!=t&&n.getModel().isEdge(t)){var l=e.graph.selectionCellsHandler.getHandler(t);if(l instanceof mxEdgeHandler){for(var i=n.view.translate,o=n.view.scale,s=i.x,a=i.y,d=n.getModel().getParent(t),c=n.getCellGeometry(d);n.getModel().isVertex(d)&&null!=c;)s+=c.x,a+=c.y,d=n.getModel().getParent(d),c=n.getCellGeometry(d);var r=Math.round(n.snap(n.popupMenuHandler.triggerX/o-s)),u=Math.round(n.snap(n.popupMenuHandler.triggerY/o-a));l.addPointAt(l.state,r,u)}}}),this.addAction("removeWaypoint",function(){var e=t.actions.get("removeWaypoint");null!=e.handler&&e.handler.removePoint(e.handler.state,e.index)}),this.addAction("clearWaypoints",function(){var t=n.getSelectionCells();if(null!=t){t=n.addAllEdges(t),n.getModel().beginUpdate();try{for(var e=0;e<t.length;e++){var l=t[e];if(n.getModel().isEdge(l)){var i=n.getCellGeometry(l);null!=i&&((i=i.clone()).points=null,n.getModel().setGeometry(l,i))}}}finally{n.getModel().endUpdate()}}},null,null,"Alt+Shift+C"),o=this.addAction("subscript",mxUtils.bind(this,function(){n.cellEditor.isContentEditing()&&document.execCommand("subscript",!1,null)}),null,null,GE.Editor.ctrlKey+"+,"),o=this.addAction("superscript",mxUtils.bind(this,function(){n.cellEditor.isContentEditing()&&document.execCommand("superscript",!1,null)}),null,null,GE.Editor.ctrlKey+"+."),o=this.addAction("indent",mxUtils.bind(this,function(){n.cellEditor.isContentEditing()&&document.execCommand("indent",!1,null)}),null,null,"Shift+Tab"),this.addAction("image...",function(){if(n.isEnabled()&&!n.isCellLocked(n.getDefaultParent())){var e=n.getView().getState(n.getSelectionCell()),l="";null!=e&&(l=e.style[mxConstants.STYLE_IMAGE]||l);var i=n.cellEditor.saveSelection();t.showImageDialog(l,function(t,e,l){if(n.cellEditor.isContentEditing())n.cellEditor.restoreSelection(i),n.insertImage(t,e,l);else{var o=n.getSelectionCells();if(null!=t&&(t.length>0||o.length>0)){var s=null;n.getModel().beginUpdate();try{if(0==o.length){var a=n.getFreeInsertPoint();s=o=[n.insertVertex(n.getDefaultParent(),null,"",a.x,a.y,e,l,"shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;")],n.fireEvent(new mxEventObject("cellsInserted","cells",s))}n.setCellStyles(mxConstants.STYLE_IMAGE,t.length>0?t:null,o);var d=n.getCurrentCellStyle(o[0]);if("image"!=d[mxConstants.STYLE_SHAPE]&&"label"!=d[mxConstants.STYLE_SHAPE]?n.setCellStyles(mxConstants.STYLE_SHAPE,"image",o):0==t.length&&n.setCellStyles(mxConstants.STYLE_SHAPE,null,o),1==n.getSelectionCount()&&null!=e&&null!=l){var c=o[0],r=n.getModel().getGeometry(c);null!=r&&((r=r.clone()).width=e,r.height=l,n.getModel().setGeometry(c,r))}}finally{n.getModel().endUpdate()}null!=s&&(n.setSelectionCells(s),n.scrollCellToVisible(s[0]))}}},n.cellEditor.isContentEditing(),!n.cellEditor.isContentEditing())}}).isEnabled=l,(o=this.addAction("layers",mxUtils.bind(this,function(){null==this.layersWindow?(this.layersWindow=new GE.LayersWindow(t,document.body.offsetWidth-280,120,220,196),this.layersWindow.window.addListener("show",function(){t.fireEvent(new mxEventObject("layers"))}),this.layersWindow.window.addListener("hide",function(){t.fireEvent(new mxEventObject("layers"))}),this.layersWindow.window.setVisible(!0),t.fireEvent(new mxEventObject("layers")),this.layersWindow.init()):this.layersWindow.window.setVisible(!this.layersWindow.window.isVisible())}),null,null,GE.Editor.ctrlKey+"+Shift+L")).setToggleAction(!0),o.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.layersWindow&&this.layersWindow.window.isVisible()})),(o=this.addAction("formatPanel",mxUtils.bind(this,function(){t.toggleFormatPanel()}),null,null,GE.Editor.ctrlKey+"+Shift+P")).setToggleAction(!0),o.setSelectedCallback(mxUtils.bind(this,function(){return t.formatWidth>0})),(o=this.addAction("outline",mxUtils.bind(this,function(){null==this.outlineWindow?(this.outlineWindow=new GE.OutlineWindow(t,document.body.offsetWidth-260,100,180,180),this.outlineWindow.window.addListener("show",function(){t.fireEvent(new mxEventObject("outline"))}),this.outlineWindow.window.addListener("hide",function(){t.fireEvent(new mxEventObject("outline"))}),this.outlineWindow.window.setVisible(!0),t.fireEvent(new mxEventObject("outline"))):this.outlineWindow.window.setVisible(!this.outlineWindow.window.isVisible())}),null,null,GE.Editor.ctrlKey+"+Shift+O")).setToggleAction(!0),o.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.outlineWindow&&this.outlineWindow.window.isVisible()}))},GE.Actions.prototype.addAction=function(t,e,n,l,i){var o;return"..."==t.substring(t.length-3)?(t=t.substring(0,t.length-3),o=mxResources.get(t)+"..."):o=mxResources.get(t),this.put(t,new GE.Action(o,e,n,l,i))},GE.Actions.prototype.put=function(t,e){return this.actions[t]=e,e},GE.Actions.prototype.get=function(t){return this.actions[t]},GE.Action=function(t,e,n,l,i){mxEventSource.call(this),this.label=t,this.funct=this.createFunction(e),this.enabled=null==n||n,this.iconCls=l,this.shortcut=i,this.visible=!0},mxUtils.extend(GE.Action,mxEventSource),GE.Action.prototype.createFunction=function(t){return t},GE.Action.prototype.setEnabled=function(t){this.enabled!=t&&(this.enabled=t,this.fireEvent(new mxEventObject("stateChanged")))},GE.Action.prototype.isEnabled=function(){return this.enabled},GE.Action.prototype.setToggleAction=function(t){this.toggleAction=t},GE.Action.prototype.setSelectedCallback=function(t){this.selectedCallback=t},GE.Action.prototype.isSelected=function(){return this.selectedCallback()};