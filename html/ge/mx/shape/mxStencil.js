function mxStencil(t){this.desc=t,this.parseDescription(),this.parseConstraints()}mxUtils.extend(mxStencil,mxShape),mxStencil.defaultLocalized=!1,mxStencil.allowEval=!1,mxStencil.prototype.desc=null,mxStencil.prototype.constraints=null,mxStencil.prototype.aspect=null,mxStencil.prototype.w0=null,mxStencil.prototype.h0=null,mxStencil.prototype.bgNode=null,mxStencil.prototype.fgNode=null,mxStencil.prototype.strokewidth=null,mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0],this.bgNode=this.desc.getElementsByTagName("background")[0],this.w0=Number(this.desc.getAttribute("w")||100),this.h0=Number(this.desc.getAttribute("h")||100);var t=this.desc.getAttribute("aspect");this.aspect=null!=t?t:"variable";var e=this.desc.getAttribute("strokewidth");this.strokewidth=null!=e?e:"1"},mxStencil.prototype.parseConstraints=function(){var t=this.desc.getElementsByTagName("connections")[0];if(null!=t){var e=mxUtils.getChildNodes(t);if(null!=e&&e.length>0){this.constraints=[];for(var i=0;i<e.length;i++)this.constraints.push(this.parseConstraint(e[i]))}}},mxStencil.prototype.parseConstraint=function(t){var e=Number(t.getAttribute("x")),i=Number(t.getAttribute("y")),r="1"==t.getAttribute("perimeter"),l=t.getAttribute("name");return new mxConnectionConstraint(new mxPoint(e,i),r,l)},mxStencil.prototype.evaluateTextAttribute=function(t,e,i){var r=this.evaluateAttribute(t,e,i),l=t.getAttribute("localized");return(mxStencil.defaultLocalized&&null==l||"1"==l)&&(r=mxResources.get(r)),r},mxStencil.prototype.evaluateAttribute=function(t,e,i){var r=t.getAttribute(e);if(null==r){var l=mxUtils.getTextContent(t);if(null!=l&&mxStencil.allowEval){var s=mxUtils.eval(l);"function"==typeof s&&(r=s(i))}}return r},mxStencil.prototype.drawShape=function(t,e,i,r,l,s){var u=t.states.slice(),n=mxUtils.getValue(e.style,mxConstants.STYLE_DIRECTION,null),o=this.computeAspect(e.style,i,r,l,s,n),a=Math.min(o.width,o.height),b="inherit"==this.strokewidth?Number(mxUtils.getNumber(e.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*a;t.setStrokeWidth(b),null!=e.style&&"1"==mxUtils.getValue(e.style,mxConstants.STYLE_POINTER_EVENTS,"0")&&(t.setStrokeColor(mxConstants.NONE),t.rect(i,r,l,s),t.stroke(),t.setStrokeColor(e.stroke)),this.drawChildren(t,e,i,r,l,s,this.bgNode,o,!1,!0),this.drawChildren(t,e,i,r,l,s,this.fgNode,o,!0,!e.outline||null==e.style||0==mxUtils.getValue(e.style,mxConstants.STYLE_BACKGROUND_OUTLINE,0)),t.states.length!=u.length&&(t.states=u)},mxStencil.prototype.drawChildren=function(t,e,i,r,l,s,u,n,o,a){if(null!=u&&l>0&&s>0)for(var b=u.firstChild;null!=b;)b.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(t,e,b,n,o,a),b=b.nextSibling},mxStencil.prototype.computeAspect=function(t,e,i,r,l,s){var u=e,n=i,o=r/this.w0,a=l/this.h0,b=s==mxConstants.DIRECTION_NORTH||s==mxConstants.DIRECTION_SOUTH;if(b){a=r/this.h0,o=l/this.w0;var m=(r-l)/2;u+=m,n-=m}return"fixed"==this.aspect&&(o=a=Math.min(o,a),b?(u+=(l-this.w0*o)/2,n+=(r-this.h0*a)/2):(u+=(r-this.w0*o)/2,n+=(l-this.h0*a)/2)),new mxRectangle(u,n,o,a)},mxStencil.prototype.drawNode=function(t,e,i,r,l,s){var u=i.nodeName,n=r.x,o=r.y,a=r.width,b=r.height,m=Math.min(a,b);if("save"==u)t.save();else if("restore"==u)t.restore();else if(s){if("path"==u){t.begin();var g=!0;if("1"==i.getAttribute("rounded")){g=!1;for(var h=Number(i.getAttribute("arcSize")),A=0,c=[],N=i.firstChild;null!=N;){if(N.nodeType==mxConstants.NODETYPE_ELEMENT){var p=N.nodeName;if("move"!=p&&"line"!=p){g=!0;break}"move"!=p&&0!=c.length||c.push([]),c[c.length-1].push(new mxPoint(n+Number(N.getAttribute("x"))*a,o+Number(N.getAttribute("y"))*b)),A++}N=N.nextSibling}if(!g&&A>0)for(var f=0;f<c.length;f++){var x=!1,d=c[f][0],y=c[f][c[f].length-1];d.x==y.x&&d.y==y.y&&(c[f].pop(),x=!0),this.addPoints(t,c[f],!0,h,x)}else g=!0}if(g)for(N=i.firstChild;null!=N;)N.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(t,e,N,r,l,s),N=N.nextSibling}else if("close"==u)t.close();else if("move"==u)t.moveTo(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b);else if("line"==u)t.lineTo(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b);else if("quad"==u)t.quadTo(n+Number(i.getAttribute("x1"))*a,o+Number(i.getAttribute("y1"))*b,n+Number(i.getAttribute("x2"))*a,o+Number(i.getAttribute("y2"))*b);else if("curve"==u)t.curveTo(n+Number(i.getAttribute("x1"))*a,o+Number(i.getAttribute("y1"))*b,n+Number(i.getAttribute("x2"))*a,o+Number(i.getAttribute("y2"))*b,n+Number(i.getAttribute("x3"))*a,o+Number(i.getAttribute("y3"))*b);else if("arc"==u)t.arcTo(Number(i.getAttribute("rx"))*a,Number(i.getAttribute("ry"))*b,Number(i.getAttribute("x-axis-rotation")),Number(i.getAttribute("large-arc-flag")),Number(i.getAttribute("sweep-flag")),n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b);else if("rect"==u)t.rect(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b,Number(i.getAttribute("w"))*a,Number(i.getAttribute("h"))*b);else if("roundrect"==u){var S=Number(i.getAttribute("arcsize"));0==S&&(S=100*mxConstants.RECTANGLE_ROUNDING_FACTOR);var v=Number(i.getAttribute("w"))*a,C=Number(i.getAttribute("h"))*b,T=Number(S)/100,w=Math.min(v*T,C*T);t.roundrect(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b,v,C,w,w)}else if("ellipse"==u)t.ellipse(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b,Number(i.getAttribute("w"))*a,Number(i.getAttribute("h"))*b);else if("image"==u){if(!e.outline){var E=this.evaluateAttribute(i,"src",e);t.image(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b,Number(i.getAttribute("w"))*a,Number(i.getAttribute("h"))*b,E,!1,"1"==i.getAttribute("flipH"),"1"==i.getAttribute("flipV"))}}else if("text"==u){if(!e.outline){var k=this.evaluateTextAttribute(i,"str",e),L="1"==i.getAttribute("vertical")?-90:0;if("0"==i.getAttribute("align-shape")){var O=e.rotation,_=1==mxUtils.getValue(e.style,mxConstants.STYLE_FLIPH,0),U=1==mxUtils.getValue(e.style,mxConstants.STYLE_FLIPV,0);_&&U?L-=O:_||U?L+=O:L-=O}L-=i.getAttribute("rotation"),t.text(n+Number(i.getAttribute("x"))*a,o+Number(i.getAttribute("y"))*b,0,0,k,i.getAttribute("align")||"left",i.getAttribute("valign")||"top",!1,"",null,!1,L)}}else if("include-shape"==u){var D=mxStencilRegistry.getStencil(i.getAttribute("name"));if(null!=D){var R=n+Number(i.getAttribute("x"))*a,I=o+Number(i.getAttribute("y"))*b;v=Number(i.getAttribute("w"))*a,C=Number(i.getAttribute("h"))*b;D.drawShape(t,e,R,I,v,C)}}else if("fillstroke"==u)t.fillAndStroke();else if("fill"==u)t.fill();else if("stroke"==u)t.stroke();else if("strokewidth"==u){var P="1"==i.getAttribute("fixed")?1:m;t.setStrokeWidth(Number(i.getAttribute("width"))*P)}else if("dashed"==u)t.setDashed("1"==i.getAttribute("dashed"));else if("dashpattern"==u){var F=i.getAttribute("pattern");if(null!=F){var Y=F.split(" "),z=[];for(f=0;f<Y.length;f++)Y[f].length>0&&z.push(Number(Y[f])*m);F=z.join(" "),t.setDashPattern(F)}}else"strokecolor"==u?t.setStrokeColor(i.getAttribute("color")):"linecap"==u?t.setLineCap(i.getAttribute("cap")):"linejoin"==u?t.setLineJoin(i.getAttribute("join")):"miterlimit"==u?t.setMiterLimit(Number(i.getAttribute("limit"))):"fillcolor"==u?t.setFillColor(i.getAttribute("color")):"alpha"==u?t.setAlpha(i.getAttribute("alpha")):"fillalpha"==u?t.setAlpha(i.getAttribute("alpha")):"strokealpha"==u?t.setAlpha(i.getAttribute("alpha")):"fontcolor"==u?t.setFontColor(i.getAttribute("color")):"fontstyle"==u?t.setFontStyle(i.getAttribute("style")):"fontfamily"==u?t.setFontFamily(i.getAttribute("family")):"fontsize"==u&&t.setFontSize(Number(i.getAttribute("size"))*m);!l||"fillstroke"!=u&&"fill"!=u&&"stroke"!=u||(l=!1,t.setShadow(!1))}};