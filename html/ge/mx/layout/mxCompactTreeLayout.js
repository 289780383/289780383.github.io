function mxCompactTreeLayout(t,e,o){mxGraphLayout.call(this,t),this.horizontal=null==e||e,this.invert=null!=o&&o}mxCompactTreeLayout.prototype=new mxGraphLayout,mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout,mxCompactTreeLayout.prototype.horizontal=null,mxCompactTreeLayout.prototype.invert=null,mxCompactTreeLayout.prototype.resizeParent=!0,mxCompactTreeLayout.prototype.maintainParentLocation=!1,mxCompactTreeLayout.prototype.groupPadding=10,mxCompactTreeLayout.prototype.groupPaddingTop=0,mxCompactTreeLayout.prototype.groupPaddingRight=0,mxCompactTreeLayout.prototype.groupPaddingBottom=0,mxCompactTreeLayout.prototype.groupPaddingLeft=0,mxCompactTreeLayout.prototype.parentsChanged=null,mxCompactTreeLayout.prototype.moveTree=!1,mxCompactTreeLayout.prototype.visited=null,mxCompactTreeLayout.prototype.levelDistance=10,mxCompactTreeLayout.prototype.nodeDistance=20,mxCompactTreeLayout.prototype.resetEdges=!0,mxCompactTreeLayout.prototype.prefHozEdgeSep=5,mxCompactTreeLayout.prototype.prefVertEdgeOff=4,mxCompactTreeLayout.prototype.minEdgeJetty=8,mxCompactTreeLayout.prototype.channelBuffer=4,mxCompactTreeLayout.prototype.edgeRouting=!0,mxCompactTreeLayout.prototype.sortEdges=!1,mxCompactTreeLayout.prototype.alignRanks=!1,mxCompactTreeLayout.prototype.maxRankHeight=null,mxCompactTreeLayout.prototype.root=null,mxCompactTreeLayout.prototype.node=null,mxCompactTreeLayout.prototype.isVertexIgnored=function(t){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(t).length},mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal},mxCompactTreeLayout.prototype.execute=function(t,e){this.parent=t;var o=this.graph.getModel();if(null==e)if(this.graph.getEdges(t,o.getParent(t),this.invert,!this.invert,!1).length>0)this.root=t;else{var i=this.graph.findTreeRoots(t,!0,this.invert);if(i.length>0)for(var r=0;r<i.length;r++)if(!this.isVertexIgnored(i[r])&&this.graph.getEdges(i[r],null,this.invert,!this.invert,!1).length>0){this.root=i[r];break}}else this.root=e;if(null!=this.root){if(this.resizeParent?this.parentsChanged=new Object:this.parentsChanged=null,this.parentX=null,this.parentY=null,t!=this.root&&null!=o.isVertex(t)&&this.maintainParentLocation)null!=(s=this.graph.getCellGeometry(t))&&(this.parentX=s.x,this.parentY=s.y);o.beginUpdate();try{if(this.visited=new Object,this.node=this.dfs(this.root,t),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);var a=this.graph.gridSize,n=a;if(!this.moveTree){var h=this.getVertexBounds(this.root);null!=h&&(a=h.x,n=h.y)}var s,l=null;if(null!=(l=this.isHorizontal()?this.horizontalLayout(this.node,a,n):this.verticalLayout(this.node,null,a,n))){var p=0,u=0;l.x<0&&(p=Math.abs(a-l.x)),l.y<0&&(u=Math.abs(n-l.y)),0==p&&0==u||this.moveNode(this.node,p,u),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY)null!=(s=this.graph.getCellGeometry(t))&&((s=s.clone()).x=this.parentX,s.y=this.parentY,o.setGeometry(t,s))}}finally{o.endUpdate()}}},mxCompactTreeLayout.prototype.moveNode=function(t,e,o){t.x+=e,t.y+=o,this.apply(t);for(var i=t.child;null!=i;)this.moveNode(i,e,o),i=i.next},mxCompactTreeLayout.prototype.sortOutgoingEdges=function(t,e){var o=new mxDictionary;e.sort(function(e,i){var r=e.getTerminal(e.getTerminal(!1)==t),a=o.get(r);null==a&&(a=mxCellPath.create(r).split(mxCellPath.PATH_SEPARATOR),o.put(r,a));var n=i.getTerminal(i.getTerminal(!1)==t),h=o.get(n);return null==h&&(h=mxCellPath.create(n).split(mxCellPath.PATH_SEPARATOR),o.put(n,h)),mxCellPath.compare(a,h)})},mxCompactTreeLayout.prototype.findRankHeights=function(t,e){(null==this.maxRankHeight[e]||this.maxRankHeight[e]<t.height)&&(this.maxRankHeight[e]=t.height);for(var o=t.child;null!=o;)this.findRankHeights(o,e+1),o=o.next},mxCompactTreeLayout.prototype.setCellHeights=function(t,e){null!=this.maxRankHeight[e]&&this.maxRankHeight[e]>t.height&&(t.height=this.maxRankHeight[e]);for(var o=t.child;null!=o;)this.setCellHeights(o,e+1),o=o.next},mxCompactTreeLayout.prototype.dfs=function(t,e){var o=mxCellPath.create(t),i=null;if(null!=t&&null==this.visited[o]&&!this.isVertexIgnored(t)){this.visited[o]=t,i=this.createNode(t);var r=this.graph.getModel(),a=null,n=this.graph.getEdges(t,e,this.invert,!this.invert,!1,!0),h=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(t,n);for(var s=0;s<n.length;s++){var l=n[s];if(!this.isEdgeIgnored(l)){this.resetEdges&&this.setEdgePoints(l,null),this.edgeRouting&&(this.setEdgeStyleEnabled(l,!1),this.setEdgePoints(l,null));var p=h.getState(l),u=null!=p?p.getVisibleTerminal(this.invert):h.getVisibleTerminal(l,this.invert),g=this.dfs(u,e);null!=g&&null!=r.getGeometry(u)&&(null==a?i.child=g:a.next=g,a=g)}}}return i},mxCompactTreeLayout.prototype.layout=function(t){if(null!=t){for(var e=t.child;null!=e;)this.layout(e),e=e.next;null!=t.child?this.attachParent(t,this.join(t)):this.layoutLeaf(t)}},mxCompactTreeLayout.prototype.horizontalLayout=function(t,e,o,i){t.x+=e+t.offsetX,t.y+=o+t.offsetY,i=this.apply(t,i);var r=t.child;if(null!=r){i=this.horizontalLayout(r,t.x,t.y,i);for(var a=t.y+r.offsetY,n=r.next;null!=n;)i=this.horizontalLayout(n,t.x+r.offsetX,a,i),a+=n.offsetY,n=n.next}return i},mxCompactTreeLayout.prototype.verticalLayout=function(t,e,o,i,r){t.x+=o+t.offsetY,t.y+=i+t.offsetX,r=this.apply(t,r);var a=t.child;if(null!=a){r=this.verticalLayout(a,t,t.x,t.y,r);for(var n=t.x+a.offsetY,h=a.next;null!=h;)r=this.verticalLayout(h,t,n,t.y+a.offsetX,r),n+=h.offsetY,h=h.next}return r},mxCompactTreeLayout.prototype.attachParent=function(t,e){var o=this.nodeDistance+this.levelDistance,i=(e-t.width)/2-this.nodeDistance,r=i+t.width+2*this.nodeDistance-e;t.child.offsetX=o+t.height,t.child.offsetY=r,t.contour.upperHead=this.createLine(t.height,0,this.createLine(o,r,t.contour.upperHead)),t.contour.lowerHead=this.createLine(t.height,0,this.createLine(o,i,t.contour.lowerHead))},mxCompactTreeLayout.prototype.layoutLeaf=function(t){var e=2*this.nodeDistance;t.contour.upperTail=this.createLine(t.height+e,0),t.contour.upperHead=t.contour.upperTail,t.contour.lowerTail=this.createLine(0,-t.width-e),t.contour.lowerHead=this.createLine(t.height+e,0,t.contour.lowerTail)},mxCompactTreeLayout.prototype.join=function(t){var e=2*this.nodeDistance,o=t.child;t.contour=o.contour;var i=o.width+e,r=i;for(o=o.next;null!=o;){var a=this.merge(t.contour,o.contour);o.offsetY=a+i,o.offsetX=0,r+=a+(i=o.width+e),o=o.next}return r},mxCompactTreeLayout.prototype.merge=function(t,e){for(var o=0,i=0,r=0,a=t.lowerHead,n=e.upperHead;null!=n&&null!=a;){var h=this.offset(o,i,n.dx,n.dy,a.dx,a.dy);i+=h,r+=h,o+n.dx<=a.dx?(o+=n.dx,i+=n.dy,n=n.next):(o-=a.dx,i-=a.dy,a=a.next)}if(null!=n){var s=this.bridge(t.upperTail,0,0,n,o,i);t.upperTail=null!=s.next?e.upperTail:s,t.lowerTail=e.lowerTail}else{null==(s=this.bridge(e.lowerTail,o,i,a,0,0)).next&&(t.lowerTail=s)}return t.lowerHead=e.lowerHead,r},mxCompactTreeLayout.prototype.offset=function(t,e,o,i,r,a){var n=0;if(r<=t||t+o<=0)return 0;if(r*i-o*a>0)if(t<0)n=t*i/o-e;else if(t>0){n=t*a/r-e}else n=-e;else if(r<t+o){n=a-(e+(r-t)*i/o)}else if(r>t+o){n=(o+t)*a/r-(e+i)}else n=a-(e+i);return n>0?n:0},mxCompactTreeLayout.prototype.bridge=function(t,e,o,i,r,a){var n=r+i.dx-e,h=0;h=0==i.dx?i.dy:n*i.dy/i.dx;var s=this.createLine(n,h,i.next);return t.next=this.createLine(0,a+i.dy-h-o,s),s},mxCompactTreeLayout.prototype.createNode=function(t){var e=new Object;e.cell=t,e.x=0,e.y=0,e.width=0,e.height=0;var o=this.getVertexBounds(t);return null!=o&&(this.isHorizontal()?(e.width=o.height,e.height=o.width):(e.width=o.width,e.height=o.height)),e.offsetX=0,e.offsetY=0,e.contour=new Object,e},mxCompactTreeLayout.prototype.apply=function(t,e){var o=this.graph.getModel(),i=t.cell,r=o.getGeometry(i);if(null!=i&&null!=r){if(this.isVertexMovable(i)&&(r=this.setVertexLocation(i,t.x,t.y),this.resizeParent)){var a=o.getParent(i),n=mxCellPath.create(a);null==this.parentsChanged[n]&&(this.parentsChanged[n]=a)}e=null==e?new mxRectangle(r.x,r.y,r.width,r.height):new mxRectangle(Math.min(e.x,r.x),Math.min(e.y,r.y),Math.max(e.x+e.width,r.x+r.width),Math.max(e.y+e.height,r.y+r.height))}return e},mxCompactTreeLayout.prototype.createLine=function(t,e,o){var i=new Object;return i.dx=t,i.dy=e,i.next=o,i},mxCompactTreeLayout.prototype.adjustParents=function(){var t=[];for(var e in this.parentsChanged)t.push(this.parentsChanged[e]);this.arrangeGroups(mxUtils.sortCells(t,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)},mxCompactTreeLayout.prototype.localEdgeProcessing=function(t){this.processNodeOutgoing(t);for(var e=t.child;null!=e;)this.localEdgeProcessing(e),e=e.next},mxCompactTreeLayout.prototype.processNodeOutgoing=function(t){for(var e=t.child,o=t.cell,i=0,r=[];null!=e;){i++;var a=e.x;this.horizontal&&(a=e.y),r.push(new WeightedCellSorter(e,a)),e=e.next}r.sort(WeightedCellSorter.prototype.compare);var n=t.width,h=(i+1)*this.prefHozEdgeSep;n>h+2*this.prefHozEdgeSep&&(n-=2*this.prefHozEdgeSep);var s=n/i,l=s/2;n>h+2*this.prefHozEdgeSep&&(l+=this.prefHozEdgeSep);var p=this.minEdgeJetty-this.prefVertEdgeOff,u=0,g=this.getVertexBounds(o);e=t.child;for(var d=0;d<r.length;d++){for(var c=r[d].cell.cell,y=this.getVertexBounds(c),m=this.graph.getEdgesBetween(o,c,!1),x=[],f=0,L=0,T=0;T<m.length;T++)this.horizontal?(f=g.x+g.width,L=g.y+l,x.push(new mxPoint(f,L)),f=g.x+g.width+p,x.push(new mxPoint(f,L)),L=y.y+y.height/2,x.push(new mxPoint(f,L)),this.setEdgePoints(m[T],x)):(f=g.x+l,L=g.y+g.height,x.push(new mxPoint(f,L)),L=g.y+g.height+p,x.push(new mxPoint(f,L)),f=y.x+y.width/2,x.push(new mxPoint(f,L)),this.setEdgePoints(m[T],x));d<i/2?p+=this.prefVertEdgeOff:d>i/2&&(p-=this.prefVertEdgeOff),l+=s,u=Math.max(u,p)}};