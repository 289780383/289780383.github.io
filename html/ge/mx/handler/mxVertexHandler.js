function mxVertexHandler(t){null!=t&&(this.state=t,this.init(),this.escapeHandler=mxUtils.bind(this,function(t,e){this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}mxVertexHandler.prototype.graph=null,mxVertexHandler.prototype.state=null,mxVertexHandler.prototype.singleSizer=!1,mxVertexHandler.prototype.index=null,mxVertexHandler.prototype.allowHandleBoundsCheck=!0,mxVertexHandler.prototype.handleImage=null,mxVertexHandler.prototype.tolerance=0,mxVertexHandler.prototype.rotationEnabled=!1,mxVertexHandler.prototype.parentHighlightEnabled=!1,mxVertexHandler.prototype.rotationRaster=!0,mxVertexHandler.prototype.rotationCursor="crosshair",mxVertexHandler.prototype.livePreview=!1,mxVertexHandler.prototype.manageSizers=!1,mxVertexHandler.prototype.constrainGroupByChildren=!1,mxVertexHandler.prototype.rotationHandleVSpacing=-16,mxVertexHandler.prototype.horizontalOffset=0,mxVertexHandler.prototype.verticalOffset=0,mxVertexHandler.prototype.init=function(){if(this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.selectionBorder.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX),mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var t=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){var e=0;t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",e++)),this.sizers.push(this.createSizer("n-resize",e++)),this.sizers.push(this.createSizer("ne-resize",e++)),this.sizers.push(this.createSizer("w-resize",e++)),this.sizers.push(this.createSizer("e-resize",e++)),this.sizers.push(this.createSizer("sw-resize",e++)),this.sizers.push(this.createSizer("s-resize",e++))),this.sizers.push(this.createSizer("se-resize",e++)));var s=this.graph.model.getGeometry(this.state.cell);null==s||s.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds()},mxVertexHandler.prototype.isRotationHandleVisible=function(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)},mxVertexHandler.prototype.isConstrainedEvent=function(t){return mxEvent.isShiftDown(t.getEvent())||"fixed"==this.state.style[mxConstants.STYLE_ASPECT]},mxVertexHandler.prototype.isCenteredEvent=function(t,e){return!1},mxVertexHandler.prototype.createCustomHandles=function(){return null},mxVertexHandler.prototype.updateMinBounds=function(){var t=this.graph.getChildCells(this.state.cell);if(t.length>0&&(this.minBounds=this.graph.view.getBounds(t),null!=this.minBounds)){var e=this.state.view.scale,s=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=e,this.minBounds.y/=e,this.minBounds.width/=e,this.minBounds.height/=e,this.x0=this.state.x/e-s.x,this.y0=this.state.y/e-s.y}},mxVertexHandler.prototype.getSelectionBounds=function(t){return new mxRectangle(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))},mxVertexHandler.prototype.createParentHighlightShape=function(t){return this.createSelectionShape(t)},mxVertexHandler.prototype.createSelectionShape=function(t){var e=new mxRectangleShape(mxRectangle.fromRectangle(t),null,this.getSelectionColor());return e.strokewidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e},mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR},mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH},mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED},mxVertexHandler.prototype.createSizer=function(t,e,s,i){s=s||mxConstants.HANDLE_SIZE;var n=new mxRectangle(0,0,s,s),h=this.createSizerShape(n,e,i);return h.isHtmlAllowed()&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(h.bounds.height-=1,h.bounds.width-=1,h.dialect=mxConstants.DIALECT_STRICTHTML,h.init(this.graph.container)):(h.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,h.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(h.node,this.graph,this.state),this.graph.isEnabled()&&h.setCursor(t),this.isSizerVisible(e)||(h.visible=!1),h},mxVertexHandler.prototype.isSizerVisible=function(t){return!0},mxVertexHandler.prototype.createSizerShape=function(t,e,s){if(null!=this.handleImage){t=new mxRectangle(t.x,t.y,this.handleImage.width,this.handleImage.height);var i=new mxImageShape(t,this.handleImage.src);return i.preserveImageAspect=!1,i}return e==mxEvent.ROTATION_HANDLE?new mxEllipse(t,s||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(t,s||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)},mxVertexHandler.prototype.moveSizerTo=function(t,e,s){null!=t&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(s-t.bounds.height/2),null!=t.node&&"none"!=t.node.style.display&&t.redraw())},mxVertexHandler.prototype.getHandleForEvent=function(t){var e=mxEvent.isMouseEvent(t.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&e>0?new mxRectangle(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null,i=mxUtils.bind(this,function(e){var i=null!=e&&e.constructor!=mxImageShape&&this.allowHandleBoundsCheck?new mxRectangle(t.getGraphX()-e.svgStrokeTolerance,t.getGraphY()-e.svgStrokeTolerance,2*e.svgStrokeTolerance,2*e.svgStrokeTolerance):s;return null!=e&&(t.isSource(e)||null!=i&&mxUtils.intersects(e.bounds,i)&&"none"!=e.node.style.display&&"hidden"!=e.node.style.visibility)});if(i(this.rotationShape))return mxEvent.ROTATION_HANDLE;if(i(this.labelShape))return mxEvent.LABEL_HANDLE;if(null!=this.sizers)for(var n=0;n<this.sizers.length;n++)if(i(this.sizers[n]))return n;if(null!=this.customHandles&&this.isCustomHandleEvent(t))for(n=this.customHandles.length-1;n>=0;n--)if(i(this.customHandles[n].shape))return mxEvent.CUSTOM_HANDLE-n;return null},mxVertexHandler.prototype.isCustomHandleEvent=function(t){return!0},mxVertexHandler.prototype.mouseDown=function(t,e){if(!e.isConsumed()&&this.graph.isEnabled()){var s=this.getHandleForEvent(e);null!=s&&(this.start(e.getGraphX(),e.getGraphY(),s),e.consume())}},mxVertexHandler.prototype.isLivePreviewBorder=function(){return null!=this.state.shape&&null==this.state.shape.fill&&null==this.state.shape.stroke},mxVertexHandler.prototype.start=function(t,e,s){if(null!=this.selectionBorder)if(this.livePreviewActive=this.livePreview&&0==this.graph.model.getChildCount(this.state.cell),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=s,this.startX=t,this.startY=e,this.index<=mxEvent.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{var i=this.state.view.graph.model,n=i.getParent(this.state.cell);if(this.state.view.currentRoot!=n&&(i.isVertex(n)||i.isEdge(n))&&(this.parentState=this.state.view.graph.view.getState(n)),this.selectionBorder.node.style.display=s==mxEvent.ROTATION_HANDLE?"inline":"none",this.livePreviewActive&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),GE.IS_SVG&&0!=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")||null==this.state.text||this.state.text.node.parentNode!=this.graph.container?(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container))),s==mxEvent.ROTATION_HANDLE){var h=this.getRotationHandlePosition(),r=h.x-this.state.getCenterX(),a=h.y-this.state.getCenterY();this.startAngle=0!=r?180*Math.atan(a/r)/Math.PI+90:a<0?180:0,this.startDist=Math.sqrt(r*r+a*a)}if(this.livePreviewActive){this.hideSizers(),s==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":s==mxEvent.LABEL_HANDLE?this.labelShape.node.style.display="":null!=this.sizers&&null!=this.sizers[s]?this.sizers[s].node.style.display="":s<=mxEvent.CUSTOM_HANDLE&&null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-s].setVisible(!0);var l=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(var o=0;o<l.length;o++){var d=this.graph.selectionCellsHandler.getHandler(l[o]);null!=d&&this.edgeHandlers.push(d)}}}},mxVertexHandler.prototype.createGhostPreview=function(){var t=this.graph.cellRenderer.createShape(this.state);return t.init(this.graph.view.getOverlayPane()),t.scale=this.state.view.scale,t.bounds=this.bounds,t.outline=!0,t},mxVertexHandler.prototype.setHandlesVisible=function(t){if(null!=this.sizers)for(var e=0;e<this.sizers.length;e++)this.sizers[e].node.style.display=t?"":"none";if(null!=this.customHandles)for(e=0;e<this.customHandles.length;e++)this.customHandles[e].setVisible(t)},mxVertexHandler.prototype.hideSizers=function(){this.setHandlesVisible(!1)},mxVertexHandler.prototype.checkTolerance=function(t){this.inTolerance&&null!=this.startX&&null!=this.startY&&(mxEvent.isMouseEvent(t.getEvent())||Math.abs(t.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(t.getGraphY()-this.startY)>this.graph.tolerance)&&(this.inTolerance=!1)},mxVertexHandler.prototype.updateHint=function(t){},mxVertexHandler.prototype.removeHint=function(){},mxVertexHandler.prototype.roundAngle=function(t){return Math.round(10*t)/10},mxVertexHandler.prototype.roundLength=function(t){return Math.round(100*t)/100},mxVertexHandler.prototype.mouseMove=function(t,e){e.isConsumed()||null==this.index?this.graph.isMouseDown||null==this.getHandleForEvent(e)||e.consume(!1):(this.checkTolerance(e),this.inTolerance||(this.index<=mxEvent.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokewidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.moveToFront(),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].positionChanged())):this.index==mxEvent.LABEL_HANDLE?this.moveLabel(e):this.index==mxEvent.ROTATION_HANDLE?this.rotateVertex(e):(this.resizeVertex(e),this.updateHint(e))),e.consume())},mxVertexHandler.prototype.isGhostPreview=function(){return this.state.view.graph.model.getChildCount(this.state.cell)>0},mxVertexHandler.prototype.moveLabel=function(t){var e=new mxPoint(t.getGraphX(),t.getGraphY()),s=this.graph.view.translate,i=this.graph.view.scale;this.graph.isGridEnabledEvent(t.getEvent())&&(e.x=(this.graph.snap(e.x/i-s.x)+s.x)*i,e.y=(this.graph.snap(e.y/i-s.y)+s.y)*i);var n=null!=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],e.x,e.y)},mxVertexHandler.prototype.rotateVertex=function(t){var e=new mxPoint(t.getGraphX(),t.getGraphY()),s=this.state.x+this.state.width/2-e.x,i=this.state.y+this.state.height/2-e.y;if(this.currentAlpha=0!=s?180*Math.atan(i/s)/Math.PI+90:i<0?180:0,s>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(t.getEvent())){s=e.x-this.state.getCenterX(),i=e.y-this.state.getCenterY();var n=Math.sqrt(s*s+i*i);n-this.startDist<2?raster=15:n-this.startDist<25?raster=5:raster=1,this.currentAlpha=Math.round(this.currentAlpha/raster)*raster}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()},mxVertexHandler.prototype.resizeVertex=function(t){var e=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),s=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),i=new mxPoint(t.getGraphX(),t.getGraphY()),n=this.graph.view.translate,h=this.graph.view.scale,r=Math.cos(-s),a=Math.sin(-s),l=a*(g=i.x-this.startX)+r*(c=i.y-this.startY);g=r*g-a*c,c=l;var o=this.graph.getCellGeometry(this.state.cell);if(this.unscaledBounds=this.union(o,g/h,c/h,this.index,this.graph.isGridEnabledEvent(t.getEvent()),1,new mxPoint(0,0),this.isConstrainedEvent(t),this.isCenteredEvent(this.state,t)),!o.relative){var d=this.graph.getMaximumGraphBounds();if(null!=d&&null!=this.parentState&&((d=mxRectangle.fromRectangle(d)).x-=(this.parentState.x-n.x*h)/h,d.y-=(this.parentState.y-n.y*h)/h),this.graph.isConstrainChild(this.state.cell)){var u=this.graph.getCellContainmentArea(this.state.cell);if(null!=u){var p=this.graph.getOverlap(this.state.cell);p>0&&((u=mxRectangle.fromRectangle(u)).x-=u.width*p,u.y-=u.height*p,u.width+=2*u.width*p,u.height+=2*u.height*p),null==d?d=u:(d=mxRectangle.fromRectangle(d)).intersect(u)}}null!=d&&(this.unscaledBounds.x<d.x&&(this.unscaledBounds.width-=d.x-this.unscaledBounds.x,this.unscaledBounds.x=d.x),this.unscaledBounds.y<d.y&&(this.unscaledBounds.height-=d.y-this.unscaledBounds.y,this.unscaledBounds.y=d.y),this.unscaledBounds.x+this.unscaledBounds.width>d.x+d.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-d.x-d.width),this.unscaledBounds.y+this.unscaledBounds.height>d.y+d.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-d.y-d.height))}var x=this.bounds;this.bounds=new mxRectangle((null!=this.parentState?this.parentState.x:n.x*h)+this.unscaledBounds.x*h,(null!=this.parentState?this.parentState.y:n.y*h)+this.unscaledBounds.y*h,this.unscaledBounds.width*h,this.unscaledBounds.height*h),o.relative&&null!=this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),r=Math.cos(s),a=Math.sin(s);var g,c,m=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY()),v=r*(g=m.x-e.x)-a*(c=m.y-e.y)-g,y=a*g+r*c-c,H=this.bounds.x-this.state.x,w=this.bounds.y-this.state.y,f=r*H-a*w,C=a*H+r*w;this.bounds.x+=v,this.bounds.y+=y,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+v/h),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+y/h),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.graph.isCellCollapsed(this.state.cell)||0==v&&0==y?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+f,this.childOffsetY=this.state.y-this.bounds.y+C),x.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(t),null!=this.preview?this.drawPreview():this.updateParentHighlight())},mxVertexHandler.prototype.updateLivePreview=function(t){var e=this.graph.view.scale,s=this.graph.view.translate,i=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new mxPoint(this.state.x/e-s.x,this.state.y/e-s.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;var n=this.state.absoluteOffset;n=new mxPoint(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;var h=this.graph.getCellGeometry(this.state.cell);if(null!=h){var r=h.offset||this.EMPTY_POINT;null==r||h.relative||(this.state.absoluteOffset.x=this.state.view.scale*r.x,this.state.absoluteOffset.y=this.state.view.scale*r.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(i)},mxVertexHandler.prototype.moveToFront=function(){(null!=this.state.text&&null!=this.state.text.node&&null!=this.state.text.node.nextSibling||null!=this.state.shape&&null!=this.state.shape.node&&null!=this.state.shape.node.nextSibling&&(null==this.state.text||this.state.shape.node.nextSibling!=this.state.text.node))&&(null!=this.state.shape&&null!=this.state.shape.node&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),null!=this.state.text&&null!=this.state.text.node&&this.state.text.node.parentNode.appendChild(this.state.text.node))},mxVertexHandler.prototype.mouseUp=function(t,e){if(null!=this.index&&null!=this.state){var s=new mxPoint(e.getGraphX(),e.getGraphY()),i=this.index;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.getModel().beginUpdate();try{if(i<=mxEvent.CUSTOM_HANDLE){if(null!=this.customHandles){var n=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[mxEvent.CUSTOM_HANDLE-i].active=!1,this.customHandles[mxEvent.CUSTOM_HANDLE-i].execute(e),null!=this.customHandles&&null!=this.customHandles[mxEvent.CUSTOM_HANDLE-i]&&(this.state.style=n,this.customHandles[mxEvent.CUSTOM_HANDLE-i].positionChanged())}}else if(i==mxEvent.ROTATION_HANDLE)if(null!=this.currentAlpha){var h=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);0!=h&&this.rotateCell(this.state.cell,h)}else this.rotateClick();else{var r=this.graph.isGridEnabledEvent(e.getEvent()),a=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),l=Math.cos(-a),o=Math.sin(-a),d=s.x-this.startX,u=s.y-this.startY,p=o*d+l*u;d=l*d-o*u,u=p;var x=this.graph.view.scale,g=this.isRecursiveResize(this.state,e);this.resizeCell(this.state.cell,this.roundLength(d/x),this.roundLength(u/x),i,r,this.isConstrainedEvent(e),g)}}finally{this.graph.getModel().endUpdate()}e.consume(),this.reset()}},mxVertexHandler.prototype.isRecursiveResize=function(t,e){return this.graph.isRecursiveResize(this.state)},mxVertexHandler.prototype.rotateClick=function(){},mxVertexHandler.prototype.rotateCell=function(t,e,s){if(0!=e){var i=this.graph.getModel();if(i.isVertex(t)||i.isEdge(t)){if(!i.isEdge(t)){var n=(this.graph.getCurrentCellStyle(t)[mxConstants.STYLE_ROTATION]||0)+e;this.graph.setCellStyles(mxConstants.STYLE_ROTATION,n,[t])}var h=this.graph.getCellGeometry(t);if(null!=h){var r=this.graph.getCellGeometry(s);if(null==r||i.isEdge(s)||((h=h.clone()).rotate(e,new mxPoint(r.width/2,r.height/2)),i.setGeometry(t,h)),i.isVertex(t)&&!h.relative||i.isEdge(t))for(var a=i.getChildCount(t),l=0;l<a;l++)this.rotateCell(i.getChildAt(t,l),e,t)}}}},mxVertexHandler.prototype.reset=function(){if(null!=this.sizers&&null!=this.index&&null!=this.sizers[this.index]&&"none"==this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.currentAlpha=null,this.inTolerance=null,this.index=null,null!=this.preview&&(this.preview.destroy(),this.preview=null),null!=this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive&&null!=this.sizers){for(var t=0;t<this.sizers.length;t++)null!=this.sizers[t]&&(this.sizers[t].node.style.display="");null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="")}if(null!=this.customHandles)for(t=0;t<this.customHandles.length;t++)this.customHandles[t].active?(this.customHandles[t].active=!1,this.customHandles[t].reset()):this.customHandles[t].setVisible(!0);null!=this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview()),this.removeHint(),this.redrawHandles(),this.edgeHandlers=null,this.unscaledBounds=null,this.livePreviewActive=null},mxVertexHandler.prototype.resizeCell=function(t,e,s,i,n,h,r){var a=this.graph.model.getGeometry(t);if(null!=a)if(i==mxEvent.LABEL_HANDLE){var l=-mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),o=Math.cos(l),d=Math.sin(l),u=this.graph.view.scale,p=mxUtils.getRotatedPoint(new mxPoint(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/u),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/u)),o,d);null==(a=a.clone()).offset?a.offset=p:(a.offset.x+=p.x,a.offset.y+=p.y),this.graph.model.setGeometry(t,a)}else if(null!=this.unscaledBounds){u=this.graph.view.scale;0==this.childOffsetX&&0==this.childOffsetY||this.moveChildren(t,Math.round(this.childOffsetX/u),Math.round(this.childOffsetY/u)),this.graph.resizeCell(t,this.unscaledBounds,r)}},mxVertexHandler.prototype.moveChildren=function(t,e,s){for(var i=this.graph.getModel(),n=i.getChildCount(t),h=0;h<n;h++){var r=i.getChildAt(t,h),a=this.graph.getCellGeometry(r);null!=a&&((a=a.clone()).translate(e,s),i.setGeometry(r,a))}},mxVertexHandler.prototype.union=function(t,e,s,i,n,h,r,a,l){if(n=null!=n?n&&this.graph.gridEnabled:this.graph.gridEnabled,this.singleSizer){var o=t.x+t.width+e,d=t.y+t.height+s;n&&(o=this.graph.snap(o/h)*h,d=this.graph.snap(d/h)*h);var u=new mxRectangle(t.x,t.y,0,0);return u.add(new mxRectangle(o,d,0,0)),u}var p=t.width,x=t.height,g=t.x-r.x*h,c=g+p,m=t.y-r.y*h,v=m+x,y=g+p/2,H=m+x/2;i>4?(v+=s,v=n?this.graph.snap(v/h)*h:Math.round(v/h)*h):i<3&&(m+=s,m=n?this.graph.snap(m/h)*h:Math.round(m/h)*h),0==i||3==i||5==i?(g+=e,g=n?this.graph.snap(g/h)*h:Math.round(g/h)*h):2!=i&&4!=i&&7!=i||(c+=e,c=n?this.graph.snap(c/h)*h:Math.round(c/h)*h);var w=c-g,f=v-m;if(a){var C=this.graph.getCellGeometry(this.state.cell);if(null!=C){var E=C.width/C.height;1==i||2==i||7==i||6==i?w=f*E:f=w/E,0==i&&(g=c-w,m=v-f)}}if(l){var S=y-(g+(w+=w-p)/2),z=H-(m+(f+=f-x)/2);g+=S,m+=z,c+=S,v+=z}w<0&&(g+=w,w=Math.abs(w)),f<0&&(m+=f,f=Math.abs(f));var T=new mxRectangle(g+r.x*h,m+r.y*h,w,f);return null!=this.minBounds&&(T.width=Math.max(T.width,this.minBounds.x*h+this.minBounds.width*h+Math.max(0,this.x0*h-T.x)),T.height=Math.max(T.height,this.minBounds.y*h+this.minBounds.height*h+Math.max(0,this.y0*h-T.y))),T},mxVertexHandler.prototype.redraw=function(t){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),t||this.redrawHandles()},mxVertexHandler.prototype.getHandlePadding=function(){var t=new mxPoint(0,0),e=this.tolerance;return null!=this.sizers&&this.sizers.length>0&&null!=this.sizers[0]&&(this.bounds.width<2*this.sizers[0].bounds.width+2*e||this.bounds.height<2*this.sizers[0].bounds.height+2*e)&&(e/=2,t.x=this.sizers[0].bounds.width+e,t.y=this.sizers[0].bounds.height+e),t},mxVertexHandler.prototype.getSizerBounds=function(){return this.bounds},mxVertexHandler.prototype.redrawHandles=function(){var t=this.getSizerBounds(),e=this.tolerance;if(this.horizontalOffset=0,this.verticalOffset=0,null!=this.customHandles)for(var s=0;s<this.customHandles.length;s++){var i=this.customHandles[s].shape.node.style.display;this.customHandles[s].redraw(),this.customHandles[s].shape.node.style.display=i,this.customHandles[s].shape.node.style.visibility=this.isCustomHandleVisible(this.customHandles[s])?"":"hidden"}if(null!=this.sizers&&this.sizers.length>0&&null!=this.sizers[0]){if(null==this.index&&this.manageSizers&&this.sizers.length>=8){var n=this.getHandlePadding();this.horizontalOffset=n.x,this.verticalOffset=n.y,0==this.horizontalOffset&&0==this.verticalOffset||((t=new mxRectangle(t.x,t.y,t.width,t.height)).x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}var h=t.x+t.width,r=t.y+t.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],h,r);else{var a=t.x+t.width/2,l=t.y+t.height/2;if(this.sizers.length>=8){var o=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],d=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),u=Math.cos(d),p=Math.sin(d),x=Math.round(4*d/Math.PI),g=new mxPoint(t.getCenterX(),t.getCenterY()),c=mxUtils.getRotatedPoint(new mxPoint(t.x,t.y),u,p,g);this.moveSizerTo(this.sizers[0],c.x,c.y),this.sizers[0].setCursor(o[mxUtils.mod(0+x,o.length)]),c.x=a,c.y=t.y,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[1],c.x,c.y),this.sizers[1].setCursor(o[mxUtils.mod(1+x,o.length)]),c.x=h,c.y=t.y,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[2],c.x,c.y),this.sizers[2].setCursor(o[mxUtils.mod(2+x,o.length)]),c.x=t.x,c.y=l,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[3],c.x,c.y),this.sizers[3].setCursor(o[mxUtils.mod(7+x,o.length)]),c.x=h,c.y=l,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[4],c.x,c.y),this.sizers[4].setCursor(o[mxUtils.mod(3+x,o.length)]),c.x=t.x,c.y=r,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[5],c.x,c.y),this.sizers[5].setCursor(o[mxUtils.mod(6+x,o.length)]),c.x=a,c.y=r,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[6],c.x,c.y),this.sizers[6].setCursor(o[mxUtils.mod(5+x,o.length)]),c.x=h,c.y=r,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[7],c.x,c.y),this.sizers[7].setCursor(o[mxUtils.mod(4+x,o.length)]),c.x=a+this.state.absoluteOffset.x,c.y=l+this.state.absoluteOffset.y,c=mxUtils.getRotatedPoint(c,u,p,g),this.moveSizerTo(this.sizers[8],c.x,c.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],a+this.state.absoluteOffset.x,l+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(null!=this.rotationShape){d=mxUtils.toRadians(null!=this.currentAlpha?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),u=Math.cos(d),p=Math.sin(d),g=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),c=mxUtils.getRotatedPoint(this.getRotationHandlePosition(),u,p,g);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,c.x,c.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),null!=this.edgeHandlers)for(s=0;s<this.edgeHandlers.length;s++)this.edgeHandlers[s].redraw()},mxVertexHandler.prototype.isCustomHandleVisible=function(t){return!this.graph.isEditing()&&1==this.state.view.graph.getSelectionCount()},mxVertexHandler.prototype.getRotationHandlePosition=function(){return new mxPoint(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)},mxVertexHandler.prototype.isParentHighlightVisible=function(){return!0},mxVertexHandler.prototype.updateParentHighlight=function(){if(null!=this.selectionBorder&&this.isParentHighlightVisible())if(null!=this.parentHighlight){var t=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(t)){var e=this.graph.view.getState(t),s=this.parentHighlight.bounds;null==e||s.x==e.x&&s.y==e.y&&s.width==e.width&&s.height==e.height||(this.parentHighlight.bounds=mxRectangle.fromRectangle(e),this.parentHighlight.redraw())}else this.parentHighlight.destroy(),this.parentHighlight=null}else if(this.parentHighlightEnabled){t=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(t))null!=(e=this.graph.view.getState(t))&&(this.parentHighlight=this.createParentHighlightShape(e),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(e.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw())}},mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()},mxVertexHandler.prototype.getSelectionBorderBounds=function(){return this.bounds},mxVertexHandler.prototype.destroy=function(){if(null!=this.escapeHandler&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),null!=this.preview&&(this.preview.destroy(),this.preview=null),null!=this.parentHighlight&&(this.parentHighlight.destroy(),this.parentHighlight=null),null!=this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),this.labelShape=null,this.removeHint(),null!=this.sizers){for(var t=0;t<this.sizers.length;t++)this.sizers[t].destroy();this.sizers=null}if(null!=this.customHandles){for(t=0;t<this.customHandles.length;t++)this.customHandles[t].destroy();this.customHandles=null}};