var mxVmlCanvas2D=function(t){mxAbstractCanvas2D.call(this),this.root=t};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D),mxVmlCanvas2D.prototype.node=null,mxVmlCanvas2D.prototype.textEnabled=!0,mxVmlCanvas2D.prototype.moveOp="m",mxVmlCanvas2D.prototype.lineOp="l",mxVmlCanvas2D.prototype.curveOp="c",mxVmlCanvas2D.prototype.closeOp="x",mxVmlCanvas2D.prototype.rotatedHtmlBackground="",mxVmlCanvas2D.prototype.vmlScale=1,mxVmlCanvas2D.prototype.createElement=function(t){return document.createElement(t)},mxVmlCanvas2D.prototype.createVmlElement=function(t){return this.createElement(GE.VML_PREFIX+":"+t)},mxVmlCanvas2D.prototype.addNode=function(t,e){var a=this.node,s=this.state;if(null!=a){if("shape"==a.nodeName){if(!(null!=this.path&&this.path.length>0))return;a.path=this.path.join(" ")+" e",a.style.width=this.root.style.width,a.style.height=this.root.style.height,a.coordsize=parseInt(a.style.width)+" "+parseInt(a.style.height)}a.strokeweight=this.format(Math.max(1,s.strokeWidth*s.scale/this.vmlScale))+"px",s.shadow&&this.root.appendChild(this.createShadow(a,t&&null!=s.fillColor,e&&null!=s.strokeColor)),e&&null!=s.strokeColor?(a.stroked="true",a.strokecolor=s.strokeColor):a.stroked="false",a.appendChild(this.createStroke()),t&&null!=s.fillColor?a.appendChild(this.createFill()):!this.pointerEvents||"shape"==a.nodeName&&this.path[this.path.length-1]!=this.closeOp?a.filled="false":a.appendChild(this.createTransparentFill()),this.root.appendChild(a)}},mxVmlCanvas2D.prototype.createTransparentFill=function(){var t=this.createVmlElement("fill");return t.src=GE.imageBasePath+"/transparent.gif",t.type="tile",t},mxVmlCanvas2D.prototype.createFill=function(){var t=this.state,e=this.createVmlElement("fill");if(e.color=t.fillColor,null!=t.gradientColor){e.type="gradient",e.method="none",e.color2=t.gradientColor;var a=180-t.rotation;t.gradientDirection==mxConstants.DIRECTION_WEST?a-=90+("x"==this.root.style.flip?180:0):t.gradientDirection==mxConstants.DIRECTION_EAST?a+=90+("x"==this.root.style.flip?180:0):t.gradientDirection==mxConstants.DIRECTION_NORTH?a-=180+("y"==this.root.style.flip?-180:0):a+="y"==this.root.style.flip?-180:0,"x"!=this.root.style.flip&&"y"!=this.root.style.flip||(a*=-1),e.angle=mxUtils.mod(a,360),e.opacity=t.alpha*t.gradientFillAlpha*100+"%",e.setAttribute(GE.OFFICE_PREFIX+":opacity2",t.alpha*t.gradientAlpha*100+"%")}else(t.alpha<1||t.fillAlpha<1)&&(e.opacity=t.alpha*t.fillAlpha*100+"%");return e},mxVmlCanvas2D.prototype.createStroke=function(){var t=this.state,e=this.createVmlElement("stroke");return e.endcap=t.lineCap||"flat",e.joinstyle=t.lineJoin||"miter",e.miterlimit=t.miterLimit||"10",(t.alpha<1||t.strokeAlpha<1)&&(e.opacity=t.alpha*t.strokeAlpha*100+"%"),t.dashed&&(e.dashstyle=this.getVmlDashStyle()),e},mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var t="dash";if("string"==typeof this.state.dashPattern){var e=this.state.dashPattern.split(" ");e.length>0&&1==e[0]&&(t="0 2")}return t},mxVmlCanvas2D.prototype.createShadow=function(t,e,a){var s=this.state,l=-s.rotation*(Math.PI/180),i=Math.cos(l),o=Math.sin(l),n=s.shadowDx*s.scale,r=s.shadowDy*s.scale;"x"==this.root.style.flip?n*=-1:"y"==this.root.style.flip&&(r*=-1);var h=t.cloneNode(!0);return h.style.marginLeft=Math.round(n*i-r*o)+"px",h.style.marginTop=Math.round(n*o+r*i)+"px",a?(h.strokecolor=s.shadowColor,h.appendChild(this.createShadowStroke())):h.stroked="false",e?h.appendChild(this.createShadowFill()):h.filled="false",h},mxVmlCanvas2D.prototype.createShadowFill=function(){var t=this.createVmlElement("fill");return t.color=this.state.shadowColor,t.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",t},mxVmlCanvas2D.prototype.createShadowStroke=function(){var t=this.createStroke();return t.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",t},mxVmlCanvas2D.prototype.rotate=function(t,e,a,s,l){e&&a?t+=180:e?this.root.style.flip="x":a&&(this.root.style.flip="y"),(e?!a:a)&&(t*=-1),this.root.style.rotation=t,this.state.rotation=this.state.rotation+t,this.state.rotationCx=s,this.state.rotationCy=l},mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments),this.node=this.createVmlElement("shape"),this.node.style.position="absolute"},mxVmlCanvas2D.prototype.quadTo=function(t,e,a,s){var l=this.state,i=(this.lastX+l.dx)*l.scale,o=(this.lastY+l.dy)*l.scale,n=(t+l.dx)*l.scale,r=(e+l.dy)*l.scale,h=(a+l.dx)*l.scale,p=(s+l.dy)*l.scale,d=i+2/3*(n-i),m=o+2/3*(r-o),y=h+2/3*(n-h),c=p+2/3*(r-p);this.path.push("c "+this.format(d)+" "+this.format(m)+" "+this.format(y)+" "+this.format(c)+" "+this.format(h)+" "+this.format(p)),this.lastX=h/l.scale-l.dx,this.lastY=p/l.scale-l.dy},mxVmlCanvas2D.prototype.createRect=function(t,e,a,s,l){var i=this.state,o=this.createVmlElement(t);return o.style.position="absolute",o.style.left=this.format((e+i.dx)*i.scale)+"px",o.style.top=this.format((a+i.dy)*i.scale)+"px",o.style.width=this.format(s*i.scale)+"px",o.style.height=this.format(l*i.scale)+"px",o},mxVmlCanvas2D.prototype.rect=function(t,e,a,s){this.node=this.createRect("rect",t,e,a,s)},mxVmlCanvas2D.prototype.roundrect=function(t,e,a,s,l,i){this.node=this.createRect("roundrect",t,e,a,s),this.node.setAttribute("arcsize",Math.max(100*l/a,100*i/s)+"%")},mxVmlCanvas2D.prototype.ellipse=function(t,e,a,s){this.node=this.createRect("oval",t,e,a,s)},mxVmlCanvas2D.prototype.image=function(t,e,a,s,l,i,o,n){var r=null;if(i){(r=this.createRect("rect",t,e,a,s)).stroked="false";var h=this.createVmlElement("fill");h.aspect=i?"atmost":"ignore",h.rotate="true",h.type="frame",h.src=l,r.appendChild(h)}else(r=this.createRect("image",t,e,a,s)).src=l;o&&n?r.style.rotation="180":o?r.style.flip="x":n&&(r.style.flip="y"),(this.state.alpha<1||this.state.fillAlpha<1)&&(r.style.filter+="alpha(opacity="+this.state.alpha*this.state.fillAlpha*100+")"),this.root.appendChild(r)},mxVmlCanvas2D.prototype.createDiv=function(t,e,a,s){var l=this.createElement("div"),i=this.state,o="";if(null!=i.fontBackgroundColor&&(o+="background-color:"+mxUtils.htmlEntities(i.fontBackgroundColor)+";"),null!=i.fontBorderColor&&(o+="border:1px solid "+mxUtils.htmlEntities(i.fontBorderColor)+";"),mxUtils.isNode(t))l.appendChild(t);else if("fill"!=s&&"width"!=s){var n=this.createElement("div");n.style.cssText=o,n.style.display="inline-block",n.style.zoom="1",n.style.textDecoration="inherit",n.innerHTML=t,l.appendChild(n)}else l.style.cssText=o,l.innerHTML=t;var r=l.style;return r.fontSize=i.fontSize/this.vmlScale+"px",r.fontFamily=i.fontFamily,r.color=i.fontColor,r.verticalAlign="top",r.textAlign=e||"left",r.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?i.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale+"px":mxConstants.LINE_HEIGHT,(i.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(r.fontWeight="bold"),(i.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(r.fontStyle="italic"),(i.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(r.textDecoration="underline"),l},mxVmlCanvas2D.prototype.text=function(t,e,a,s,l,i,o,n,r,h,p,d,m){if(this.textEnabled&&null!=l){var y=this.state;if("html"==r){if(null!=y.rotation){var c=this.rotatePoint(t,e,y.rotation,y.rotationCx,y.rotationCy);t=c.x,e=c.y}t*=y.scale,e*=y.scale;var f=this.createElement("div");f.style.position="absolute",f.style.display="inline",f.style.left=this.format(t)+"px",f.style.top=this.format(e)+"px",f.style.zoom=y.scale;var x=this.createElement("div");x.style.position="relative",x.style.display="inline";var C=mxUtils.getAlignmentAsPoint(i,o),v=C.x,u=C.y,D=this.createDiv(l,i,o,h),g=this.createElement("div");if(null!=m&&D.setAttribute("dir",m),n&&a>0){if(p||(D.style.width=Math.round(a)+"px"),D.style.wordWrap=mxConstants.WORD_WRAP,D.style.whiteSpace="normal","break-word"==D.style.wordWrap)null!=(k=D).firstChild&&"DIV"==k.firstChild.nodeName&&(k.firstChild.style.width="100%")}else D.style.whiteSpace="nowrap";var E=y.rotation+(d||0);if(this.rotateHtml&&0!=E?(g.style.display="inline",g.style.zoom="1",g.appendChild(D),f.appendChild(g)):(D.style.display="inline",f.appendChild(D)),"DIV"!=this.root.nodeName){var V=this.createVmlElement("rect");V.stroked="false",V.filled="false",V.appendChild(f),this.root.appendChild(V)}else this.root.appendChild(f);if(p?(D.style.overflow="hidden",D.style.width=Math.round(a)+"px",D.style.maxHeight=Math.round(s)+"px"):"fill"==h?(D.style.overflow="hidden",D.style.width=Math.max(0,a)+1+"px",D.style.height=Math.max(0,s)+1+"px"):"width"==h&&(D.style.overflow="hidden",D.style.width=Math.max(0,a)+1+"px",D.style.maxHeight=Math.max(0,s)+1+"px"),this.rotateHtml&&0!=E){var I=E*(Math.PI/180),N=parseFloat(parseFloat(Math.cos(I)).toFixed(8)),M=parseFloat(parseFloat(Math.sin(-I)).toFixed(8));(I%=2*Math.PI)<0&&(I+=2*Math.PI),(I%=Math.PI)>Math.PI/2&&(I=Math.PI-I);var T=Math.cos(I),S=Math.sin(I);D.style.visibility="hidden",D.style.position="absolute",document.body.appendChild(D);var w=D;null!=w.firstChild&&"DIV"==w.firstChild.nodeName&&(w=w.firstChild);var k=w.offsetWidth+3,F=w.offsetHeight;p?(a=Math.min(a,k),F=Math.min(F,s)):a=k,n&&(D.style.width=a+"px");var A=((s=F)-s*T+a*-S)/2-M*a*(v+.5)+N*s*(u+.5),O=(a-a*T+s*-S)/2+N*a*(v+.5)+M*s*(u+.5);if("group"==f.nodeName&&"DIV"==this.root.nodeName){var b=this.createElement("div");b.style.display="inline-block",b.style.position="absolute",b.style.left=this.format(t+(O-a/2)*y.scale)+"px",b.style.top=this.format(e+(A-s/2)*y.scale)+"px",f.parentNode.appendChild(b),b.appendChild(f)}else{var L=y.scale;f.style.left=this.format(t+(O-a/2)*L)+"px",f.style.top=this.format(e+(A-s/2)*L)+"px"}g.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+N+", M12="+M+", M21="+-M+", M22="+N+", sizingMethod='auto expand')",g.style.backgroundColor=this.rotatedHtmlBackground,this.state.alpha<1&&(g.style.filter+="alpha(opacity="+100*this.state.alpha+")"),g.appendChild(D),D.style.position="",D.style.visibility=""}else{D.style.verticalAlign="top",this.state.alpha<1&&(f.style.filter="alpha(opacity="+100*this.state.alpha+")");var _=D.parentNode;D.style.visibility="hidden",document.body.appendChild(D),a=D.offsetWidth,s=F=D.offsetHeight,D.style.visibility="",_.appendChild(D),f.style.left=this.format(t+a*v*this.state.scale)+"px",f.style.top=this.format(e+s*u*this.state.scale)+"px"}}else this.plainText(t,e,a,s,mxUtils.htmlEntities(l,!1),i,o,n,r,h,p,d,m)}},mxVmlCanvas2D.prototype.plainText=function(t,e,a,s,l,i,o,n,r,h,p,d,m){var y=this.state;t=(t+y.dx)*y.scale,e=(e+y.dy)*y.scale;var c=this.createVmlElement("shape");c.style.width="1px",c.style.height="1px",c.stroked="false";var f=this.createVmlElement("fill");f.color=y.fontColor,f.opacity=100*y.alpha+"%",c.appendChild(f);var x=this.createVmlElement("path");x.textpathok="true",x.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0),c.appendChild(x);var C=this.createVmlElement("textpath");C.style.cssText="v-text-align:"+i,C.style.align=i,C.style.fontFamily=y.fontFamily,C.string=l,C.on="true";var v=y.fontSize*y.scale/this.vmlScale;C.style.fontSize=v+"px",(y.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(C.style.fontWeight="bold"),(y.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(C.style.fontStyle="italic"),(y.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(C.style.textDecoration="underline");var u=v+(l.split("\n").length-1)*v*mxConstants.LINE_HEIGHT,D=0,g=0;if(o==mxConstants.ALIGN_BOTTOM?g=-u/2:o!=mxConstants.ALIGN_MIDDLE&&(g=u/2),null!=d){c.style.rotation=d;var E=d*(Math.PI/180);D=Math.sin(E)*g,g=Math.cos(E)*g}c.appendChild(C),c.style.left=this.format(t-D)+"px",c.style.top=this.format(e+g)+"px",this.root.appendChild(c)},mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)},mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)},mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};