function mxEdgeSegmentHandler(t){mxEdgeHandler.call(this,t)}mxUtils.extend(mxEdgeSegmentHandler,mxElbowEdgeHandler),mxEdgeSegmentHandler.prototype.getCurrentPoints=function(){var t=this.state.absolutePoints;if(null!=t){var e=Math.max(1,this.graph.view.scale);if(2==t.length||3==t.length&&(Math.abs(t[0].x-t[1].x)<e&&Math.abs(t[1].x-t[2].x)<e||Math.abs(t[0].y-t[1].y)<e&&Math.abs(t[1].y-t[2].y)<e)){var n=t[0].x+(t[t.length-1].x-t[0].x)/2,i=t[0].y+(t[t.length-1].y-t[0].y)/2;t=[t[0],new mxPoint(n,i),new mxPoint(n,i),t[t.length-1]]}}return t},mxEdgeSegmentHandler.prototype.getPreviewPoints=function(t){if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);var e=this.getCurrentPoints(),n=this.convertPoint(e[0].clone(),!1);t=this.convertPoint(t.clone(),!1);for(var i=[],r=1;r<e.length;r++){var s=this.convertPoint(e[r].clone(),!1);r==this.index&&(0==Math.round(n.x-s.x)&&(n.x=t.x,s.x=t.x),0==Math.round(n.y-s.y)&&(n.y=t.y,s.y=t.y)),r<e.length-1&&i.push(s),n=s}if(1==i.length){var a=this.state.getVisibleTerminalState(!0),o=this.state.getVisibleTerminalState(!1),l=this.state.view.getScale(),h=this.state.view.getTranslate(),d=i[0].x*l+h.x,g=i[0].y*l+h.y;(null!=a&&mxUtils.contains(a,d,g)||null!=o&&mxUtils.contains(o,d,g))&&(i=[t,t])}return i},mxEdgeSegmentHandler.prototype.updatePreviewState=function(t,e,n,i){if(mxEdgeHandler.prototype.updatePreviewState.apply(this,arguments),!this.isSource&&!this.isTarget){e=this.convertPoint(e.clone(),!1);for(var r=t.absolutePoints,s=r[0],a=r[1],o=[],l=2;l<r.length;l++){var h=r[l];0==Math.round(s.x-a.x)&&0==Math.round(a.x-h.x)||0==Math.round(s.y-a.y)&&0==Math.round(a.y-h.y)||o.push(this.convertPoint(a.clone(),!1)),s=a,a=h}var d=this.state.getVisibleTerminalState(!0),g=this.state.getVisibleTerminalState(!1),u=this.state.absolutePoints;if(0!=o.length||0!=Math.round(r[0].x-r[r.length-1].x)&&0!=Math.round(r[0].y-r[r.length-1].y)){if(5==r.length&&2==o.length&&null!=d&&null!=g&&null!=u&&0==Math.round(u[0].x-u[u.length-1].x)){var x=this.graph.getView(),p=x.getScale(),y=x.getTranslate(),m=x.getRoutingCenterY(d)/p-y.y,c=this.graph.getConnectionConstraint(t,d,!0);if(null!=c)null!=(v=this.graph.getConnectionPoint(d,c))&&(this.convertPoint(v,!1),m=v.y);var v,f=x.getRoutingCenterY(g)/p-y.y,P=this.graph.getConnectionConstraint(t,g,!1);if(P)null!=(v=this.graph.getConnectionPoint(g,P))&&(this.convertPoint(v,!1),f=v.y);o=[new mxPoint(e.x,m),new mxPoint(e.x,f)]}}else o=[e,e];this.points=o,t.view.updateFixedTerminalPoints(t,d,g),t.view.updatePoints(t,this.points,d,g),t.view.updateFloatingTerminalPoints(t,d,g)}},mxEdgeSegmentHandler.prototype.connect=function(t,e,n,i,r){var s=this.graph.getModel(),a=null;if(null!=(u=s.getGeometry(t))&&null!=u.points&&u.points.length>0){var o=this.abspoints,l=o[0],h=o[1];a=[];for(var d=2;d<o.length;d++){var g=o[d];0==Math.round(l.x-h.x)&&0==Math.round(h.x-g.x)||0==Math.round(l.y-h.y)&&0==Math.round(h.y-g.y)||a.push(this.convertPoint(h.clone(),!1)),l=h,h=g}}s.beginUpdate();try{var u;if(null!=a)null!=(u=s.getGeometry(t))&&((u=u.clone()).points=a,s.setGeometry(t,u));t=mxEdgeHandler.prototype.connect.apply(this,arguments)}finally{s.endUpdate()}return t},mxEdgeSegmentHandler.prototype.getTooltipForNode=function(t){return null},mxEdgeSegmentHandler.prototype.start=function(t,e,n){mxEdgeHandler.prototype.start.apply(this,arguments),null==this.bends||null==this.bends[n]||this.isSource||this.isTarget||mxUtils.setOpacity(this.bends[n].node,100)},mxEdgeSegmentHandler.prototype.createBends=function(){var t=[],e=this.createHandleShape(0);this.initBend(e),e.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),t.push(e);var n=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var i=0;i<n.length-1;i++){e=this.createVirtualBend(),t.push(e);var r=0==Math.round(n[i].x-n[i+1].x);0==Math.round(n[i].y-n[i+1].y)&&i<n.length-2&&(r=0==Math.round(n[i].x-n[i+2].x)),e.setCursor(r?"col-resize":"row-resize"),this.points.push(new mxPoint(0,0))}}e=this.createHandleShape(n.length);return this.initBend(e),e.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),t.push(e),t},mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh(),mxEdgeHandler.prototype.redraw.apply(this,arguments)},mxEdgeSegmentHandler.prototype.redrawInnerBends=function(t,e){if(this.graph.isCellBendable(this.state.cell)){var n=this.getCurrentPoints();if(null!=n&&n.length>1){var i=!1;if(4==n.length&&0==Math.round(n[1].x-n[2].x)&&0==Math.round(n[1].y-n[2].y))if(i=!0,0==Math.round(n[0].y-n[n.length-1].y)){var r=n[0].x+(n[n.length-1].x-n[0].x)/2;n[1]=new mxPoint(r,n[1].y),n[2]=new mxPoint(r,n[2].y)}else{var s=n[0].y+(n[n.length-1].y-n[0].y)/2;n[1]=new mxPoint(n[1].x,s),n[2]=new mxPoint(n[2].x,s)}for(var a=0;a<n.length-1;a++)if(null!=this.bends[a+1]){t=n[a],e=n[a+1];var o=new mxPoint(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2),l=this.bends[a+1].bounds;this.bends[a+1].bounds=new mxRectangle(Math.floor(o.x-l.width/2),Math.floor(o.y-l.height/2),l.width,l.height),this.bends[a+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[a+1].bounds)}i&&(mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity),mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity))}}};