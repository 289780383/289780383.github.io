function mxGraphModel(e){this.currentEdit=this.createUndoableEdit(),null!=e?this.setRoot(e):this.clear()}function mxRootChange(e,t){this.model=e,this.root=t,this.previous=t}function mxChildChange(e,t,i,n){this.model=e,this.parent=t,this.previous=t,this.child=i,this.index=n,this.previousIndex=n}function mxTerminalChange(e,t,i,n){this.model=e,this.cell=t,this.terminal=i,this.previous=i,this.source=n}function mxValueChange(e,t,i){this.model=e,this.cell=t,this.value=i,this.previous=i}function mxBindPropertiesChange(e,t,i){this.model=e,this.cell=t,this.bindProperties=i,this.previous=i}function mxStyleChange(e,t,i){this.model=e,this.cell=t,this.style=i,this.previous=i}function mxGeometryChange(e,t,i){this.model=e,this.cell=t,this.geometry=i,this.previous=i}function mxCollapseChange(e,t,i){this.model=e,this.cell=t,this.collapsed=i,this.previous=i}function mxVisibleChange(e,t,i){this.model=e,this.cell=t,this.visible=i,this.previous=i}function mxCellAttributeChange(e,t,i){this.cell=e,this.attribute=t,this.value=i,this.previous=i}mxGraphModel.prototype=new mxEventSource,mxGraphModel.prototype.constructor=mxGraphModel,mxGraphModel.prototype.root=null,mxGraphModel.prototype.cells=null,mxGraphModel.prototype.maintainEdgeParent=!0,mxGraphModel.prototype.ignoreRelativeEdgeParent=!0,mxGraphModel.prototype.createIds=!0,mxGraphModel.prototype.prefix="",mxGraphModel.prototype.postfix="",mxGraphModel.prototype.nextId=0,mxGraphModel.prototype.currentEdit=null,mxGraphModel.prototype.updateLevel=0,mxGraphModel.prototype.endingUpdate=!1,mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())},mxGraphModel.prototype.isCreateIds=function(){return this.createIds},mxGraphModel.prototype.setCreateIds=function(e){this.createIds=e},mxGraphModel.prototype.createRoot=function(){var e=new mxCell;return e.insert(new mxCell),e},mxGraphModel.prototype.getCell=function(e){return null!=this.cells?this.cells[e]:null},mxGraphModel.prototype.filterCells=function(e,t){var i=null;if(null!=e){i=[];for(var n=0;n<e.length;n++)t(e[n])&&i.push(e[n])}return i},mxGraphModel.prototype.getDescendants=function(e){return this.filterDescendants(null,e)},mxGraphModel.prototype.filterDescendants=function(e,t){var i=[];t=t||this.getRoot(),(null==e||e(t))&&i.push(t);for(var n=this.getChildCount(t),l=0;l<n;l++){var r=this.getChildAt(t,l);i=i.concat(this.filterDescendants(e,r))}return i},mxGraphModel.prototype.getRoot=function(e){var t=e||this.root;if(null!=e)for(;null!=e;)t=e,e=this.getParent(e);return t},mxGraphModel.prototype.setRoot=function(e){return this.execute(new mxRootChange(this,e)),e},mxGraphModel.prototype.rootChanged=function(e){var t=this.root;return this.root=e,this.nextId=0,this.cells=null,this.cellAdded(e),t},mxGraphModel.prototype.isRoot=function(e){return null!=e&&this.root==e},mxGraphModel.prototype.isLayer=function(e){return this.isRoot(this.getParent(e))},mxGraphModel.prototype.isAncestor=function(e,t){for(;null!=t&&t!=e;)t=this.getParent(t);return t==e},mxGraphModel.prototype.contains=function(e){return this.isAncestor(this.root,e)},mxGraphModel.prototype.getParent=function(e){return null!=e?e.getParent():null},mxGraphModel.prototype.add=function(e,t,i){if(t!=e&&null!=e&&null!=t){null==i&&(i=this.getChildCount(e));var n=e!=this.getParent(t);this.execute(new mxChildChange(this,e,t,i)),this.maintainEdgeParent&&n&&this.updateEdgeParents(t)}return t},mxGraphModel.prototype.cellAdded=function(e){if(null!=e){if(null==e.getId()&&this.createIds&&e.setId(this.createId(e)),null!=e.getId()){var t=this.getCell(e.getId());if(t!=e){for(;null!=t;)e.setId(this.createId(e)),t=this.getCell(e.getId());null==this.cells&&(this.cells=new Object),this.cells[e.getId()]=e}}mxUtils.isNumeric(e.getId())&&(this.nextId=Math.max(this.nextId,e.getId()));for(var i=this.getChildCount(e),n=0;n<i;n++)this.cellAdded(this.getChildAt(e,n))}},mxGraphModel.prototype.createId=function(e){var t=this.nextId;return this.nextId++,this.prefix+t+this.postfix},mxGraphModel.prototype.updateEdgeParents=function(e,t){t=t||this.getRoot(e);for(var i=this.getChildCount(e),n=0;n<i;n++){var l=this.getChildAt(e,n);this.updateEdgeParents(l,t)}var r=this.getEdgeCount(e),o=[];for(n=0;n<r;n++)o.push(this.getEdgeAt(e,n));for(n=0;n<o.length;n++){var s=o[n];this.isAncestor(t,s)&&this.updateEdgeParent(s,t)}},mxGraphModel.prototype.updateEdgeParent=function(e,t){for(var i=this.getTerminal(e,!0),n=this.getTerminal(e,!1),l=null;null!=i&&!this.isEdge(i)&&null!=i.geometry&&i.geometry.relative;)i=this.getParent(i);for(;null!=n&&this.ignoreRelativeEdgeParent&&!this.isEdge(n)&&null!=n.geometry&&n.geometry.relative;)n=this.getParent(n);if(this.isAncestor(t,i)&&this.isAncestor(t,n)&&null!=(l=i==n?this.getParent(i):this.getNearestCommonAncestor(i,n))&&(this.getParent(l)!=this.root||this.isAncestor(l,e))&&this.getParent(e)!=l){var r=this.getGeometry(e);if(null!=r){var o=this.getOrigin(this.getParent(e)),s=this.getOrigin(l),h=s.x-o.x,u=s.y-o.y;(r=r.clone()).translate(-h,-u),this.setGeometry(e,r)}this.add(l,e,this.getChildCount(l))}},mxGraphModel.prototype.getOrigin=function(e){var t=null;if(null!=e){if(t=this.getOrigin(this.getParent(e)),!this.isEdge(e)){var i=this.getGeometry(e);null!=i&&(t.x+=i.x,t.y+=i.y)}}else t=new mxPoint;return t},mxGraphModel.prototype.getNearestCommonAncestor=function(e,t){if(null!=e&&null!=t){var i=mxCellPath.create(t);if(null!=i&&i.length>0){var n=e,l=mxCellPath.create(n);if(i.length<l.length){n=t;var r=l;l=i,i=r}for(;null!=n;){var o=this.getParent(n);if(0==i.indexOf(l+mxCellPath.PATH_SEPARATOR)&&null!=o)return n;l=mxCellPath.getParentPath(l),n=o}}}return null},mxGraphModel.prototype.remove=function(e){return e==this.root?this.setRoot(null):null!=this.getParent(e)&&this.execute(new mxChildChange(this,null,e)),e},mxGraphModel.prototype.cellRemoved=function(e){if(null!=e&&null!=this.cells){for(var t=this.getChildCount(e)-1;t>=0;t--)this.cellRemoved(this.getChildAt(e,t));null!=this.cells&&null!=e.getId()&&delete this.cells[e.getId()]}},mxGraphModel.prototype.parentForCellChanged=function(e,t,i){var n=this.getParent(e);if(null!=t)t==n&&n.getIndex(e)==i||t.insert(e,i);else if(null!=n){var l=n.getIndex(e);n.remove(l)}var r=this.contains(t),o=this.contains(n);return r&&!o?this.cellAdded(e):o&&!r&&this.cellRemoved(e),n},mxGraphModel.prototype.getChildCount=function(e){return null!=e?e.getChildCount():0},mxGraphModel.prototype.getChildAt=function(e,t){return null!=e?e.getChildAt(t):null},mxGraphModel.prototype.getChildren=function(e){return null!=e?e.children:null},mxGraphModel.prototype.getChildVertices=function(e){return this.getChildCells(e,!0,!1)},mxGraphModel.prototype.getChildEdges=function(e){return this.getChildCells(e,!1,!0)},mxGraphModel.prototype.getChildCells=function(e,t,i){t=null!=t&&t,i=null!=i&&i;for(var n=this.getChildCount(e),l=[],r=0;r<n;r++){var o=this.getChildAt(e,r);(!i&&!t||i&&this.isEdge(o)||t&&this.isVertex(o))&&l.push(o)}return l},mxGraphModel.prototype.getTerminal=function(e,t){return null!=e?e.getTerminal(t):null},mxGraphModel.prototype.setTerminal=function(e,t,i){var n=t!=this.getTerminal(e,i);return this.execute(new mxTerminalChange(this,e,t,i)),this.maintainEdgeParent&&n&&this.updateEdgeParent(e,this.getRoot()),t},mxGraphModel.prototype.setTerminals=function(e,t,i){this.beginUpdate();try{this.setTerminal(e,t,!0),this.setTerminal(e,i,!1)}finally{this.endUpdate()}},mxGraphModel.prototype.terminalForCellChanged=function(e,t,i){var n=this.getTerminal(e,i);return null!=t?t.insertEdge(e,i):null!=n&&n.removeEdge(e,i),n},mxGraphModel.prototype.getEdgeCount=function(e){return null!=e?e.getEdgeCount():0},mxGraphModel.prototype.getEdgeAt=function(e,t){return null!=e?e.getEdgeAt(t):null},mxGraphModel.prototype.getDirectedEdgeCount=function(e,t,i){for(var n=0,l=this.getEdgeCount(e),r=0;r<l;r++){var o=this.getEdgeAt(e,r);o!=i&&this.getTerminal(o,t)==e&&n++}return n},mxGraphModel.prototype.getConnections=function(e){return this.getEdges(e,!0,!0,!1)},mxGraphModel.prototype.getIncomingEdges=function(e){return this.getEdges(e,!0,!1,!1)},mxGraphModel.prototype.getOutgoingEdges=function(e){return this.getEdges(e,!1,!0,!1)},mxGraphModel.prototype.getEdges=function(e,t,i,n){t=null==t||t,i=null==i||i,n=null==n||n;for(var l=this.getEdgeCount(e),r=[],o=0;o<l;o++){var s=this.getEdgeAt(e,o),h=this.getTerminal(s,!0),u=this.getTerminal(s,!1);(n&&h==u||h!=u&&(t&&u==e||i&&h==e))&&r.push(s)}return r},mxGraphModel.prototype.getEdgesBetween=function(e,t,i){i=null!=i&&i;var n=this.getEdgeCount(e),l=this.getEdgeCount(t),r=e,o=n;l<n&&(o=l,r=t);for(var s=[],h=0;h<o;h++){var u=this.getEdgeAt(r,h),a=this.getTerminal(u,!0),p=this.getTerminal(u,!1);(a==e&&p==t||!i&&(p==e&&a==t))&&s.push(u)}return s},mxGraphModel.prototype.getOpposites=function(e,t,i,n){i=null==i||i,n=null==n||n;var l=[];if(null!=e)for(var r=0;r<e.length;r++){var o=this.getTerminal(e[r],!0),s=this.getTerminal(e[r],!1);o==t&&null!=s&&s!=t&&n?l.push(s):s==t&&null!=o&&o!=t&&i&&l.push(o)}return l},mxGraphModel.prototype.getTopmostCells=function(e){for(var t=new mxDictionary,i=[],n=0;n<e.length;n++)t.put(e[n],!0);for(n=0;n<e.length;n++){for(var l=e[n],r=!0,o=this.getParent(l);null!=o;){if(t.get(o)){r=!1;break}o=this.getParent(o)}r&&i.push(l)}return i},mxGraphModel.prototype.isVertex=function(e){return null!=e&&e.isVertex()},mxGraphModel.prototype.isEdge=function(e){return null!=e&&e.isEdge()},mxGraphModel.prototype.isConnectable=function(e){return null!=e&&e.isConnectable()},mxGraphModel.prototype.getValue=function(e){return null!=e?e.getValue():null},mxGraphModel.prototype.setValue=function(e,t){return this.execute(new mxValueChange(this,e,t)),t},mxGraphModel.prototype.valueForCellChanged=function(e,t){return e.valueChanged(t)},mxGraphModel.prototype.getBindProperties=function(e){return null!=e?e.getBindProperties():null},mxGraphModel.prototype.setBindProperties=function(e,t){return this.execute(new mxBindPropertiesChange(this,e,t)),t},mxGraphModel.prototype.bindPropertiesForCellChanged=function(e,t){return e.bindPropertiesChanged(t)},mxGraphModel.prototype.getGeometry=function(e){return null!=e?e.getGeometry():null},mxGraphModel.prototype.setGeometry=function(e,t){return t!=this.getGeometry(e)&&this.execute(new mxGeometryChange(this,e,t)),t},mxGraphModel.prototype.geometryForCellChanged=function(e,t){var i=this.getGeometry(e);return e.setGeometry(t),i},mxGraphModel.prototype.getStyle=function(e){return null!=e?e.getStyle():null},mxGraphModel.prototype.setStyle=function(e,t){return t!=this.getStyle(e)&&this.execute(new mxStyleChange(this,e,t)),t},mxGraphModel.prototype.styleForCellChanged=function(e,t){var i=this.getStyle(e);return e.setStyle(t),i},mxGraphModel.prototype.isCollapsed=function(e){return null!=e&&e.isCollapsed()},mxGraphModel.prototype.setCollapsed=function(e,t){return t!=this.isCollapsed(e)&&this.execute(new mxCollapseChange(this,e,t)),t},mxGraphModel.prototype.collapsedStateForCellChanged=function(e,t){var i=this.isCollapsed(e);return e.setCollapsed(t),i},mxGraphModel.prototype.isVisible=function(e){return null!=e&&e.isVisible()},mxGraphModel.prototype.setVisible=function(e,t){return t!=this.isVisible(e)&&this.execute(new mxVisibleChange(this,e,t)),t},mxGraphModel.prototype.visibleStateForCellChanged=function(e,t){var i=this.isVisible(e);return e.setVisible(t),i},mxGraphModel.prototype.execute=function(e){e.execute(),this.beginUpdate(),this.currentEdit.add(e),this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",e)),this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",e)),this.endUpdate()},mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++,this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE)),1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))},mxGraphModel.prototype.endUpdate=function(){if(this.updateLevel--,0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT)),!this.endingUpdate){this.endingUpdate=0==this.updateLevel,this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var e=this.currentEdit;this.currentEdit=this.createUndoableEdit(),e.notify(),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",e))}}finally{this.endingUpdate=!1}}},mxGraphModel.prototype.createUndoableEdit=function(e){var t=new mxUndoableEdit(this,null==e||e);return t.notify=function(){t.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",t,"changes",t.changes)),t.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",t,"changes",t.changes))},t},mxGraphModel.prototype.mergeChildren=function(e,t,i){i=null==i||i,this.beginUpdate();try{var n=new Object;for(var l in this.mergeChildrenImpl(e,t,i,n),n){var r=n[l],o=this.getTerminal(r,!0);null!=o&&(o=n[mxCellPath.create(o)],this.setTerminal(r,o,!0)),null!=(o=this.getTerminal(r,!1))&&(o=n[mxCellPath.create(o)],this.setTerminal(r,o,!1))}}finally{this.endUpdate()}},mxGraphModel.prototype.mergeChildrenImpl=function(e,t,i,n){this.beginUpdate();try{for(var l=e.getChildCount(),r=0;r<l;r++){var o=e.getChildAt(r);if("function"==typeof o.getId){var s=o.getId(),h=null==s||this.isEdge(o)&&i?null:this.getCell(s);if(null==h){var u=o.clone();u.setId(s),u.setTerminal(o.getTerminal(!0),!0),u.setTerminal(o.getTerminal(!1),!1),h=t.insert(u),this.cellAdded(h)}n[mxCellPath.create(o)]=h,this.mergeChildrenImpl(o,h,i,n)}}}finally{this.endUpdate()}},mxGraphModel.prototype.getParents=function(e){var t=[];if(null!=e)for(var i=new mxDictionary,n=0;n<e.length;n++){var l=this.getParent(e[n]);null==l||i.get(l)||(i.put(l,!0),t.push(l))}return t},mxGraphModel.prototype.cloneCell=function(e,t){return null!=e?this.cloneCells([e],t)[0]:null},mxGraphModel.prototype.cloneCells=function(e,t,i){t=null==t||t,i=null!=i?i:new Object;for(var n=[],l=0;l<e.length;l++)null!=e[l]?n.push(this.cloneCellImpl(e[l],i,t)):n.push(null);for(l=0;l<n.length;l++)null!=n[l]&&this.restoreClone(n[l],e[l],i);return n},mxGraphModel.prototype.cloneCellImpl=function(e,t,i){var n=mxObjectIdentity.get(e),l=t[n];if(null==l&&(l=this.cellCloned(e),t[n]=l,i))for(var r=this.getChildCount(e),o=0;o<r;o++){var s=this.cloneCellImpl(this.getChildAt(e,o),t,!0);l.insert(s)}return l},mxGraphModel.prototype.cellCloned=function(e){return e.clone()},mxGraphModel.prototype.restoreClone=function(e,t,i){var n=this.getTerminal(t,!0);null!=n&&(null!=(l=i[mxObjectIdentity.get(n)])&&l.insertEdge(e,!0));var l,r=this.getTerminal(t,!1);null!=r&&(null!=(l=i[mxObjectIdentity.get(r)])&&l.insertEdge(e,!1));for(var o=this.getChildCount(e),s=0;s<o;s++)this.restoreClone(this.getChildAt(e,s),this.getChildAt(t,s),i)},mxRootChange.prototype.execute=function(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)},mxChildChange.prototype.execute=function(){if(null!=this.child){var e=this.model.getParent(this.child),t=null!=e?e.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1),e=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),null!=this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=e,this.index=this.previousIndex,this.previousIndex=t}},mxChildChange.prototype.connect=function(e,t){t=null==t||t;var i=e.getTerminal(!0),n=e.getTerminal(!1);null!=i&&(t?this.model.terminalForCellChanged(e,i,!0):this.model.terminalForCellChanged(e,null,!0)),null!=n&&(t?this.model.terminalForCellChanged(e,n,!1):this.model.terminalForCellChanged(e,null,!1)),e.setTerminal(i,!0),e.setTerminal(n,!1);for(var l=this.model.getChildCount(e),r=0;r<l;r++)this.connect(this.model.getChildAt(e,r),t)},mxTerminalChange.prototype.execute=function(){null!=this.cell&&(this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source))},mxValueChange.prototype.execute=function(){null!=this.cell&&(this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous))},mxBindPropertiesChange.prototype.execute=function(){null!=this.cell&&(this.mxBindPropertiesChange=this.previous,this.previous=this.model.bindPropertiesForCellChanged(this.cell,this.previous))},mxStyleChange.prototype.execute=function(){null!=this.cell&&(this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous))},mxGeometryChange.prototype.execute=function(){null!=this.cell&&(this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous))},mxCollapseChange.prototype.execute=function(){null!=this.cell&&(this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous))},mxVisibleChange.prototype.execute=function(){null!=this.cell&&(this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous))},mxCellAttributeChange.prototype.execute=function(){if(null!=this.cell){var e=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous),this.previous=e}};